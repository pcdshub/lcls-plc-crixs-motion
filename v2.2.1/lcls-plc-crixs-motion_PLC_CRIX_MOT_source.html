<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DUTs &mdash; pcdshub/lcls-plc-crixs-motion  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/tree.css?v=837a00b9" />
      <link rel="stylesheet" type="text/css" href="_static/width.css?v=ab210c7a" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/docs-versions-menu.js?v=3d6a1aea"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Data Types" href="lcls-plc-crixs-motion_PLC_CRIX_MOT_epics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pcdshub/lcls-plc-crixs-motion
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">lcls-plc-crixs-motion</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_pragmas.html">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_nc.html">NC Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_ethercat.html">EtherCAT Terminals</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_boxes.html">Boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_links.html">Links</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PLC_CRIX_MOT</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_PLC_CRIX_MOT_summary.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_PLC_CRIX_MOT_summary.html#pragmas">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_PLC_CRIX_MOT_summary.html#libraries">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_PLC_CRIX_MOT_summary.html#symbols">Symbols</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_PLC_CRIX_MOT_epics.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-crixs-motion_PLC_CRIX_MOT_epics.html#database-records">Database Records</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DUTs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#e-dpaddle-states">E_DPaddle_States</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enum-diagpaddle">ENUM_DiagPaddle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enum-dpx">ENUM_DPX</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enum-dpy">ENUM_DPY</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enum-dpz">ENUM_DPZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-bfsassemblystate">ST_BFSAssemblyState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-diagpaddleoutputs">ST_DiagPaddleOutputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-epslimits">ST_EPSLimits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-queue">ST_Queue</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#gvls">GVLs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#gvl">GVL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-diagnosticpaddle">GVL_DiagnosticPaddle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-fiberlite">GVL_FiberLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-illumination">GVL_Illumination</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-motoreps">GVL_MotorEPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-pointdetector">GVL_PointDetector</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-questar">GVL_Questar</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-sampledelivery">GVL_SampleDelivery</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main">Main</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#pous">POUs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#f-inrange">F_InRange</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-adjacentstates">FB_AdjacentStates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-assemblypositionstatemanager">FB_AssemblyPositionStateManager</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-bfs">FB_BFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-checkeps">FB_CheckEPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-dpx">FB_DPX</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-queue">FB_Queue</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-rci-analog-input">FB_RCI_Analog_Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-rci-analog-output">FB_RCI_Analog_Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-resttimer">FB_RestTimer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-slits">FB_SLITS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-slits-power">FB_SLITS_POWER</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-slits-scatter">FB_SLITS_SCATTER</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-beamblock">PRG_Beamblock</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-bfs">PRG_BFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-camera">PRG_Camera</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-cryopump">PRG_CryoPump</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-cryopumps">PRG_Cryopumps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-cryostat">PRG_CryoStat</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-diagnosticpaddle">PRG_DiagnosticPaddle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-diagnosticpaddlemotors">PRG_DiagnosticPaddleMotors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-dpl-x-eps">PRG_DPL_X_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-dpl-y-eps">PRG_DPL_Y_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-dpl-z-eps">PRG_DPL_Z_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-eps">PRG_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-fiberlite">PRG_FiberLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-illumination">PRG_Illumination</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-injectormotors">PRG_InjectorMotors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-main">PRG_Main</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-objectivesmotors">PRG_ObjectivesMotors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-pmps">PRG_PMPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-pointdetectormotors">PRG_PointDetectorMotors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-questarmotors">PRG_QuestarMotors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-queuetest">PRG_QueueTest</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-rcc">PRG_RCC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-rcc-y-eps">PRG_RCC_Y_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-rcc-z-eps">PRG_RCC_Z_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-rci">PRG_RCI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-sds-rx-eps">PRG_SDS_RX_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-sds-y-eps">PRG_SDS_Y_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-sds-zencoder-eps">PRG_SDS_ZENCODER_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-sl2k2-scatter">PRG_SL2K2_SCATTER</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-test-adjacentstates">PRG_Test_AdjacentStates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-vls">PRG_VLS</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pcdshub/lcls-plc-crixs-motion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">DUTs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/lcls-plc-crixs-motion_PLC_CRIX_MOT_source.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="duts">
<h1>DUTs<a class="headerlink" href="#duts" title="Link to this heading"></a></h1>
<section id="e-dpaddle-states">
<h2>E_DPaddle_States<a class="headerlink" href="#e-dpaddle-states" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_DPaddle_States</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">parked</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">diode</span><span class="p">,</span>
    <span class="n">L1</span><span class="p">,</span>
    <span class="n">L2</span><span class="p">,</span>
    <span class="n">L3</span><span class="p">,</span>
    <span class="n">L4</span><span class="p">,</span>
    <span class="n">R1</span><span class="p">,</span>
    <span class="n">R2</span><span class="p">,</span>
    <span class="n">R3</span><span class="p">,</span>
    <span class="n">R4</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-dpaddle-states">E_DPaddle_States</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="enum-diagpaddle">
<h2>ENUM_DiagPaddle<a class="headerlink" href="#enum-diagpaddle" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">ENUM_DiagPaddle</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">PARK</span> <span class="o">:=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">UP</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">CENTER</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">PINHOLE</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">DIODE</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">YAG1</span> <span class="o">:=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">YAG2</span> <span class="o">:=</span> <span class="mi">7</span><span class="p">,</span>
    <span class="n">YAG3</span> <span class="o">:=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">KNIFE</span> <span class="o">:=</span> <span class="mi">9</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="enum-dpx">
<h2>ENUM_DPX<a class="headerlink" href="#enum-dpx" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="o">//</span> <span class="n">EPICS</span> <span class="n">states</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">use</span> <span class="ow">in</span> <span class="n">FB_DPX</span> <span class="p">(</span><span class="n">diagnostic</span> <span class="n">paddle</span> <span class="n">X</span><span class="p">)</span>
<span class="o">//</span> <span class="n">Remove</span> <span class="n">strict</span> <span class="n">attribute</span> <span class="k">for</span> <span class="n">easier</span> <span class="n">handling</span>
<span class="n">TYPE</span> <span class="n">ENUM_DPX</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">//</span> <span class="n">UNKNOWN</span> <span class="n">must</span> <span class="n">be</span> <span class="ow">in</span> <span class="n">slot</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">FB</span> <span class="n">breaks</span>
    <span class="n">PARK</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span>    <span class="o">//</span> <span class="n">The</span> <span class="n">parked</span> <span class="n">position</span> <span class="k">for</span> <span class="n">the</span> <span class="n">diagnostic</span> <span class="n">paddle</span>
    <span class="n">CENTER</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">,</span>  <span class="o">//</span> <span class="n">center</span> <span class="n">positon</span> <span class="k">for</span> <span class="n">the</span> <span class="n">diagnostic</span> <span class="n">paddle</span><span class="o">.</span> <span class="n">This</span> <span class="n">should</span> <span class="n">be</span>
    <span class="n">KNIFE</span>   <span class="o">:=</span> <span class="mi">3</span>  <span class="o">//</span> <span class="n">Knife</span> <span class="n">edge</span> <span class="n">position</span> <span class="k">for</span> <span class="n">the</span> <span class="n">diagnostic</span> <span class="n">paddle</span><span class="o">.</span> <span class="n">Should</span> <span class="n">be</span> <span class="n">the</span> <span class="n">same</span> <span class="n">nominal</span> <span class="n">X</span> <span class="n">positon</span> <span class="k">as</span> <span class="n">the</span> <span class="s2">&quot;CENTER&quot;</span>
                  <span class="o">//</span> <span class="n">position</span><span class="p">,</span> <span class="n">but</span> <span class="n">will</span> <span class="n">use</span> <span class="n">a</span> <span class="n">different</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">soft</span> <span class="n">limits</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">scanning</span> <span class="n">of</span> <span class="n">the</span> <span class="n">knife</span> <span class="n">edge</span><span class="o">.</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-dpx">FB_DPX</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="enum-dpy">
<h2>ENUM_DPY<a class="headerlink" href="#enum-dpy" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="o">//</span> <span class="n">EPICS</span> <span class="n">states</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">use</span> <span class="ow">in</span> <span class="n">FB_DPY</span> <span class="p">(</span><span class="n">diagnostic</span> <span class="n">paddle</span> <span class="n">Y</span><span class="p">)</span>
<span class="o">//</span> <span class="n">Remove</span> <span class="n">strict</span> <span class="n">attribute</span> <span class="k">for</span> <span class="n">easier</span> <span class="n">handling</span>
<span class="n">TYPE</span> <span class="n">ENUM_DPY</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>   <span class="o">//</span> <span class="n">UNKNOWN</span> <span class="n">must</span> <span class="n">be</span> <span class="ow">in</span> <span class="n">slot</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">FB</span> <span class="n">breaks</span>
    <span class="n">PARK</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span>              <span class="o">//</span> <span class="n">The</span> <span class="n">parked</span> <span class="n">position</span> <span class="k">for</span> <span class="n">the</span> <span class="n">diagnostic</span> <span class="n">paddle</span>
    <span class="n">CENTER</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">,</span>    <span class="o">//</span> <span class="n">center</span> <span class="n">positon</span> <span class="k">for</span> <span class="n">the</span> <span class="n">diagnostic</span> <span class="n">paddle</span><span class="o">.</span> <span class="n">This</span> <span class="n">should</span> <span class="n">be</span>
    <span class="n">PINHOLE</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">,</span>   <span class="o">//</span> <span class="n">Pinhole</span> <span class="n">position</span> <span class="k">for</span> <span class="n">WFS</span>
    <span class="n">DIODE</span> <span class="o">:=</span><span class="mi">4</span><span class="p">,</span>              <span class="o">//</span> <span class="n">Diode</span> <span class="n">position</span>
    <span class="n">YAG1</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">,</span>              <span class="o">//</span> <span class="n">Yag</span> <span class="mi">1</span> <span class="n">position</span>
    <span class="n">YAG2</span> <span class="o">:=</span> <span class="mi">6</span><span class="p">,</span>              <span class="o">//</span> <span class="n">Yag</span> <span class="mi">2</span> <span class="n">position</span>
    <span class="n">YAG3</span> <span class="o">:=</span> <span class="mi">7</span><span class="p">,</span>              <span class="o">//</span> <span class="n">Yag</span> <span class="mi">3</span> <span class="n">position</span>
    <span class="n">KNIFE</span> <span class="o">:=</span> <span class="mi">8</span>          <span class="o">//</span> <span class="n">Knife</span> <span class="n">edge</span> <span class="n">position</span> <span class="k">for</span> <span class="n">the</span> <span class="n">diagnostic</span> <span class="n">paddle</span><span class="o">.</span> <span class="n">Should</span> <span class="n">be</span> <span class="n">the</span> <span class="n">same</span> <span class="n">nominal</span> <span class="n">X</span> <span class="n">positon</span> <span class="k">as</span> <span class="n">the</span> <span class="s2">&quot;CENTER&quot;</span>
                    <span class="o">//</span> <span class="n">position</span><span class="p">,</span> <span class="n">but</span> <span class="n">will</span> <span class="n">use</span> <span class="n">a</span> <span class="n">different</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">soft</span> <span class="n">limits</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">scanning</span> <span class="n">of</span> <span class="n">the</span> <span class="n">knife</span> <span class="n">edge</span><span class="o">.</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="enum-dpz">
<h2>ENUM_DPZ<a class="headerlink" href="#enum-dpz" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="o">//</span> <span class="n">EPICS</span> <span class="n">states</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">use</span> <span class="ow">in</span> <span class="n">FB_DPX</span> <span class="p">(</span><span class="n">diagnostic</span> <span class="n">paddle</span> <span class="n">X</span><span class="p">)</span>
<span class="o">//</span> <span class="n">Remove</span> <span class="n">strict</span> <span class="n">attribute</span> <span class="k">for</span> <span class="n">easier</span> <span class="n">handling</span>
<span class="n">TYPE</span> <span class="n">ENUM_DPZ</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">//</span> <span class="n">UNKNOWN</span> <span class="n">must</span> <span class="n">be</span> <span class="ow">in</span> <span class="n">slot</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">FB</span> <span class="n">breaks</span>
    <span class="n">PARK</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span>    <span class="o">//</span> <span class="n">The</span> <span class="n">parked</span> <span class="n">position</span> <span class="k">for</span> <span class="n">the</span> <span class="n">diagnostic</span> <span class="n">paddle</span>
    <span class="n">CENTER</span> <span class="o">:=</span> <span class="mi">2</span>  <span class="o">//</span> <span class="n">center</span> <span class="n">positon</span> <span class="k">for</span> <span class="n">the</span> <span class="n">diagnostic</span> <span class="n">paddle</span><span class="o">.</span> <span class="n">This</span> <span class="n">should</span> <span class="n">be</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-dpx">FB_DPX</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="st-bfsassemblystate">
<h2>ST_BFSAssemblyState<a class="headerlink" href="#st-bfsassemblystate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_BFSAssemblyState</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="n">iState</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>          <span class="o">//</span> <span class="n">state</span> <span class="n">index</span>
    <span class="n">bDiscovered</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>     <span class="o">//</span> <span class="n">BFS</span> <span class="n">search</span> <span class="n">discovery</span> <span class="n">status</span>
    <span class="n">iParent</span>         <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span> <span class="o">//</span> <span class="n">BFS</span> <span class="n">parent</span> <span class="n">state</span>

<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="st-diagpaddleoutputs">
<h2>ST_DiagPaddleOutputs<a class="headerlink" href="#st-diagpaddleoutputs" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_DiagPaddleOutputs</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="n">PARK</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">UP</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">CENTER</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">PINHOLE</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">DIODE</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">YAG1</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">YAG2</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">YAG3</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">KNIFE</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="st-epslimits">
<h2>ST_EPSLimits<a class="headerlink" href="#st-epslimits" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_EPSLimits</span> <span class="p">:</span>
    <span class="o">//</span> <span class="n">Defines</span> <span class="n">the</span> <span class="n">PLC</span> <span class="n">limits</span> <span class="ow">and</span> <span class="n">EPS</span> <span class="n">structure</span> <span class="n">where</span> <span class="n">these</span> <span class="n">limits</span> <span class="n">are</span> <span class="n">valid</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: FwdLimit&#39;</span><span class="p">}</span>
    <span class="o">//</span> <span class="n">Forward</span> <span class="n">Limit</span>
    <span class="n">fFwd_Limits</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: BwdLimit&#39;</span><span class="p">}</span>
    <span class="o">//</span> <span class="n">Backward</span> <span class="n">Limit</span>
    <span class="n">fBwd_Limits</span>     <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: ST&#39;</span><span class="p">}</span>
    <span class="o">//</span> <span class="n">EPS_OK</span> <span class="o">-</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">Use</span> <span class="n">limits</span> <span class="k">as</span> <span class="s1">&#39;plc limits&#39;</span><span class="p">;</span> <span class="n">EPS_OK</span> <span class="o">-</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">DO</span> <span class="ow">not</span> <span class="n">use</span> <span class="n">limits</span>
    <span class="n">stEPS</span>           <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="st-queue">
<h2>ST_Queue<a class="headerlink" href="#st-queue" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_Queue</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="n">iLength</span> <span class="p">:</span> <span class="n">DINT</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span> <span class="o">//</span> <span class="nb">max</span> <span class="n">number</span> <span class="n">of</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">queue</span>
    <span class="n">iFront</span>  <span class="p">:</span> <span class="n">DINT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">//</span> <span class="n">oldest</span> <span class="n">item</span> <span class="n">index</span>
    <span class="n">iBack</span>   <span class="p">:</span> <span class="n">DINT</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="o">//</span> <span class="n">newest</span> <span class="n">item</span> <span class="n">index</span>
    <span class="n">iCount</span>  <span class="p">:</span> <span class="n">DINT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">//</span> <span class="n">current</span> <span class="n">item</span> <span class="n">count</span>
    <span class="n">arrQueue</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">0..100</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span> <span class="o">//</span> <span class="n">array</span> <span class="n">to</span> <span class="n">hold</span> <span class="n">queued</span> <span class="n">items</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#st-bfsassemblystate">ST_BFSAssemblyState</a></p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="gvls">
<h1>GVLs<a class="headerlink" href="#gvls" title="Link to this heading"></a></h1>
<section id="gvl">
<h2>GVL<a class="headerlink" href="#gvl" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>
    <span class="n">xOverride</span>               <span class="p">:</span>       <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Global</span> <span class="n">override</span> <span class="n">of</span> <span class="n">motion</span> <span class="n">safety</span> <span class="n">settings</span><span class="o">.</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-diagnosticpaddle">
<h2>GVL_DiagnosticPaddle<a class="headerlink" href="#gvl-diagnosticpaddle" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>



    <span class="o">//</span> <span class="n">Define</span> <span class="n">axis</span> <span class="n">states</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span><span class="o">.</span> <span class="n">These</span> <span class="n">are</span> <span class="n">fed</span> <span class="n">to</span> <span class="n">a</span> <span class="n">FB_PositionState</span> <span class="n">manager</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span>
    <span class="o">//</span> <span class="n">X</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stDPXPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>             <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">stDPXPosCenter</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>   <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;CENTER&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">stDPXPosKnife</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>    <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;KNIFE&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">15.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>



    <span class="o">//</span> <span class="n">Y</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stDPYPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>             <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">stDPYPosCenter</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>   <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;CENTER&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">stDPYPosDiode</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>    <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;DIODE&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">15.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">stDPYPosPinhole</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>  <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PINHOLE&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">20.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">stDPYPosYAG1</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>             <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;YAG1&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">25.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">stDPYPosYAG2</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>             <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;YAG2&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">30.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">stDPYPosYAG3</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>             <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;YAG3&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">35.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">stDPYPosKnife</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>    <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;KNIFE&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">40.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Z</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stDPZPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>             <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="n">stDPZPosCenter</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>   <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;CENTER&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="n">stDPPark</span>        <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bDiscovered</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">iParent</span><span class="o">:=</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">stDPUp</span>          <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bDiscovered</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">iParent</span><span class="o">:=</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">stDPCenter</span>      <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="mi">3</span><span class="p">,</span> <span class="n">bDiscovered</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">iParent</span><span class="o">:=</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">stDPPinhole</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="mi">4</span><span class="p">,</span> <span class="n">bDiscovered</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">iParent</span><span class="o">:=</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">stDPDiode</span>       <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="mi">5</span><span class="p">,</span> <span class="n">bDiscovered</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">iParent</span><span class="o">:=</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">stDPYag1</span>        <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="mi">6</span><span class="p">,</span> <span class="n">bDiscovered</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">iParent</span><span class="o">:=</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">stDPYag2</span>        <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="mi">7</span><span class="p">,</span> <span class="n">bDiscovered</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">iParent</span><span class="o">:=</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">stDPYag3</span>        <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="mi">8</span><span class="p">,</span> <span class="n">bDiscovered</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">iParent</span><span class="o">:=</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">stDPKnife</span>       <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="mi">9</span><span class="p">,</span> <span class="n">bDiscovered</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">iParent</span><span class="o">:=</span><span class="mi">0</span><span class="p">);</span>

    <span class="n">arrDPStates</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..9</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span> <span class="o">:=</span> <span class="p">[</span><span class="n">stDPPark</span><span class="p">,</span> <span class="n">stDPUp</span><span class="p">,</span> <span class="n">stDPCenter</span><span class="p">,</span> <span class="n">stDPPinhole</span><span class="p">,</span> <span class="n">stDPDiode</span><span class="p">,</span>
                                                          <span class="n">stDPYag1</span><span class="p">,</span> <span class="n">stDPYag2</span><span class="p">,</span> <span class="n">stDPYag3</span><span class="p">,</span> <span class="n">stDPKnife</span><span class="p">];</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#st-bfsassemblystate">ST_BFSAssemblyState</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="gvl-fiberlite">
<h2>GVL_FiberLite<a class="headerlink" href="#gvl-fiberlite" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>
    <span class="o">//</span><span class="n">Fiber</span><span class="o">-</span><span class="n">Lite</span> <span class="n">Control</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.iIlluminatorINT := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ1 (EK1122)^CryoStat (EK1101)^Term 158 (EL4004)^AO Outputs Channel 1^Analog output&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">RIX</span><span class="p">:</span><span class="n">CRIX</span><span class="p">:</span><span class="n">LED</span><span class="p">:</span><span class="mi">01</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>

    <span class="n">bLedOutput1</span> <span class="p">:</span> <span class="n">FB_LED</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.iIlluminatorINT := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ1 (EK1122)^CryoStat (EK1101)^FiberLite (EL4004)^AO Outputs Channel 2^Analog output&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">RIX</span><span class="p">:</span><span class="n">CRIX</span><span class="p">:</span><span class="n">LED</span><span class="p">:</span><span class="mi">02</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>

    <span class="n">bLedOutput2</span> <span class="p">:</span> <span class="n">FB_LED</span><span class="p">;</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-illumination">
<h2>GVL_Illumination<a class="headerlink" href="#gvl-illumination" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>





    <span class="o">//</span> <span class="n">Define</span> <span class="n">axis</span> <span class="n">states</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span><span class="o">.</span> <span class="n">These</span> <span class="n">are</span> <span class="n">fed</span> <span class="n">to</span> <span class="n">a</span> <span class="n">FB_PositionState</span> <span class="n">manager</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span>
    <span class="o">//</span> <span class="n">X</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stILMXPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>   <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Y</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stILMYPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>   <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Z</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stILMZPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>   <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="n">fbILMXStage</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbILMYStage</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbILMZStage</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>


<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-motoreps">
<h2>GVL_MotorEPS<a class="headerlink" href="#gvl-motoreps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>

    <span class="n">fDPL_X</span>          <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fDPL_Z</span>          <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fDPL_Y</span>          <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">fSDS_RX</span>         <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fSDS_Y</span>          <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fSDS_Z_ENC</span>      <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">fRCC_Z</span>          <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fRCC_Y</span>          <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">tEPS_OVRD_RESET_TIME</span> <span class="p">:</span> <span class="n">TIME</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#5m; // Resets overide after this amount of time.</span>


     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">RIX</span><span class="p">:</span><span class="n">CRIX</span><span class="p">:</span><span class="n">EPS</span><span class="p">:</span><span class="n">fNozzleCatcherOffset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fNozzleCatcherOffset</span>    <span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-pmps">
<h2>GVL_PMPS<a class="headerlink" href="#gvl-pmps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>
    <span class="o">//</span><span class="n">MPS</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PLC</span><span class="p">:</span><span class="n">CRIX</span><span class="p">:</span><span class="n">MOT</span><span class="p">:</span><span class="n">FFO</span><span class="p">:</span><span class="mi">01</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.q_xFastFaultOut:=TIIB[PMPS_FFO]^Channel 1^Output&#39;</span><span class="p">}</span>
    <span class="n">g_FastFaultOutput1</span>  <span class="p">:</span>   <span class="n">FB_HardwareFFOutput</span> <span class="o">:=</span><span class="p">(</span><span class="n">i_sNetID</span><span class="o">:=</span><span class="s1">&#39;172.21.42.126.1.1&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PLC</span><span class="p">:</span><span class="n">CRIX</span><span class="p">:</span><span class="n">MOT</span><span class="p">:</span><span class="n">FFO</span><span class="p">:</span><span class="mi">02</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.q_xFastFaultOut:=TIIB[PMPS_FFO]^Channel 2^Output&#39;</span><span class="p">}</span>
    <span class="n">g_FastFaultOutput2</span>  <span class="p">:</span>   <span class="n">FB_HardwareFFOutput</span> <span class="o">:=</span><span class="p">(</span><span class="n">i_sNetID</span><span class="o">:=</span><span class="s1">&#39;172.21.42.126.1.1&#39;</span><span class="p">);</span>


        <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PLC</span><span class="p">:</span><span class="n">CRIX</span><span class="p">:</span><span class="n">MOT</span><span class="p">:</span><span class="n">ARB</span><span class="p">:</span><span class="mi">01</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbArbiter1</span>   <span class="p">:</span>   <span class="n">FB_Arbiter</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-pointdetector">
<h2>GVL_PointDetector<a class="headerlink" href="#gvl-pointdetector" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>
        <span class="o">//</span> <span class="n">Motor</span> <span class="n">axes</span>


    <span class="o">//</span> <span class="n">Define</span> <span class="n">axis</span> <span class="n">states</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span><span class="o">.</span> <span class="n">These</span> <span class="n">are</span> <span class="n">fed</span> <span class="n">to</span> <span class="n">a</span> <span class="n">FB_PositionState</span> <span class="n">manager</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span>
    <span class="o">//</span> <span class="n">Rotation</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stPDRotPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>           <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Y</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stPDYPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>             <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">21.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-questar">
<h2>GVL_Questar<a class="headerlink" href="#gvl-questar" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>
        <span class="o">//</span> <span class="n">Motor</span> <span class="n">axes</span>


    <span class="o">//</span> <span class="n">Define</span> <span class="n">axis</span> <span class="n">states</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span><span class="o">.</span> <span class="n">These</span> <span class="n">are</span> <span class="n">fed</span> <span class="n">to</span> <span class="n">a</span> <span class="n">FB_PositionState</span> <span class="n">manager</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span>
    <span class="o">//</span> <span class="n">X</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stQSTXPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>            <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Y</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stQSTYPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>            <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-sampledelivery">
<h2>GVL_SampleDelivery<a class="headerlink" href="#gvl-sampledelivery" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>
        <span class="o">//</span> <span class="n">Motor</span> <span class="n">axes</span>


    <span class="o">//</span> <span class="n">Define</span> <span class="n">axis</span> <span class="n">states</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span><span class="o">.</span> <span class="n">These</span> <span class="n">are</span> <span class="n">fed</span> <span class="n">to</span> <span class="n">a</span> <span class="n">FB_PositionState</span> <span class="n">manager</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span>
    <span class="o">//</span> <span class="n">X</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stSDSXPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>            <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Y</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stSDSYPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>            <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Z</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stSDSZPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>            <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="o">//</span> <span class="n">Rotation</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stSDSRotPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>          <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                                  <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
    <span class="o">//</span> <span class="n">Shroud</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stSDSShroudPosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>               <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                                     <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="main">
<h2>Main<a class="headerlink" href="#main" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>

    <span class="o">//</span> <span class="n">Motor</span> <span class="n">axes</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E1 (EL7031)^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E1</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="s1">&#39;}</span>
    <span class="n">M1</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span>
    <span class="o">//</span><span class="n">stDPXMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E3 (EL7031)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E3</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M2</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span>
    <span class="o">//</span><span class="n">stDPYMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E4 (EL7031)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E4</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M3</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span><span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span>
    <span class="o">//</span><span class="n">stDPZMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>




    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:OBJ:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E6 (EL7031)^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E6</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="s1">&#39;}</span>
    <span class="n">M4</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span> <span class="p">,</span><span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span>
    <span class="o">//</span><span class="n">stOBJXMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:OBJ:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E7 (EL7031)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E7</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M5</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span>
    <span class="o">//</span><span class="n">stOBJYMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:OBJ:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E9 (EL7031)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E9</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M6</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span>
    <span class="o">//</span><span class="n">stOBJZMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>



    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:PDET:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E11 (EL7031)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E11</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M7</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span>
    <span class="o">//</span><span class="n">stPDYMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:PDET:MMS:THETA&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E13 (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E13</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M8</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span>
    <span class="o">//</span><span class="n">stPDRotMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:ILM:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^Term 65 (EL1084)^Channel 1^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">65</span> <span class="p">(</span><span class="n">EL1084</span><span class="p">)</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M9</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">stILMXMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:ILM:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^Term 65 (EL1084)^Channel 3^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">65</span> <span class="p">(</span><span class="n">EL1084</span><span class="p">)</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M10</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">stILMYMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:ILM:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^Term 68 (EL1084)^Channel 1^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">68</span> <span class="p">(</span><span class="n">EL1084</span><span class="p">)</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M11</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">stILMZMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:QSTR:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E17 (EL7031)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E17</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M12</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span>
    <span class="o">//</span><span class="n">stQSTXMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:QSTR:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E19 (EL7031)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E19</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M13</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span>
    <span class="o">//</span><span class="n">stQSTYMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="n">M14</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span> <span class="o">//</span> <span class="n">SPARE</span> <span class="mi">1</span>
    <span class="n">M15</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span> <span class="o">//</span> <span class="n">SPARE</span> <span class="mi">2</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:X&#39;</span><span class="p">}</span>
    <span class="n">M16</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">stSDSXMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E26 (EL7031)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E26</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M17</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">stSDSYMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E27 (EL7031)^STM Status^Status^Digital input 1&#39;</span><span class="p">}</span>
    <span class="n">M18</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">stSDSZMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:RX&#39;</span><span class="p">}</span>
<span class="p">(</span><span class="o">*</span>  <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable := ;   // There are currently no limits on this stage</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="s1">&#39;} *)</span>
    <span class="n">M19</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">stSDSRotMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:RJET&#39;</span><span class="p">}</span>
<span class="p">(</span><span class="o">*</span>  <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable := ;  // There are currently no limits on this stage</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="s1">&#39;} *)</span>
    <span class="n">M20</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">stSDSShroudMotor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:ZENCODER&#39;</span><span class="p">}</span>
    <span class="n">M36</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span> <span class="o">//</span> <span class="n">SDS</span> <span class="n">Z</span> <span class="n">Encoder</span> <span class="n">Axis</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:CRYO:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ1 (EK1122)^CryoStat (EK1101)^Cryo X (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ1</span> <span class="p">(</span><span class="n">EK1122</span><span class="p">)</span><span class="o">^</span><span class="n">CryoStat</span> <span class="p">(</span><span class="n">EK1101</span><span class="p">)</span><span class="o">^</span><span class="n">Cryo</span> <span class="n">X</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M22</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">CryoStat</span> <span class="n">X</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:CRYO:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ1 (EK1122)^CryoStat (EK1101)^Cryo Y (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ1</span> <span class="p">(</span><span class="n">EK1122</span><span class="p">)</span><span class="o">^</span><span class="n">CryoStat</span> <span class="p">(</span><span class="n">EK1101</span><span class="p">)</span><span class="o">^</span><span class="n">Cryo</span> <span class="n">Y</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M23</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">CryoStat</span> <span class="n">Y</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:CRYO:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ1 (EK1122)^CryoStat (EK1101)^Cryo Z (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ1</span> <span class="p">(</span><span class="n">EK1122</span><span class="p">)</span><span class="o">^</span><span class="n">CryoStat</span> <span class="p">(</span><span class="n">EK1101</span><span class="p">)</span><span class="o">^</span><span class="n">Cryo</span> <span class="n">Z</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M24</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">CryoStat</span> <span class="n">Z</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:CRYO:MMS:RY&#39;</span><span class="p">}</span>
    <span class="n">M25</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">CryoStat</span> <span class="n">rY</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCI:MMS:X&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ0 (EK1122-0080)^RCI (EK1101-0080)^RCI X (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ0</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">RCI</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">RCI</span> <span class="n">X</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M26</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">RCI</span> <span class="n">X</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCI:MMS:Y&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ0 (EK1122-0080)^RCI (EK1101-0080)^RCI Y (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ0</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">RCI</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">RCI</span> <span class="n">Y</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M27</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">RCI</span> <span class="n">Y</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCI:MMS:Z&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ0 (EK1122-0080)^RCI (EK1101-0080)^RCI Z (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ0</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">RCI</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">RCI</span> <span class="n">Z</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M28</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">RCI</span> <span class="n">Z</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCI:MMS:RX&#39;</span><span class="p">}</span>
    <span class="n">M29</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">RCI</span> <span class="n">rX</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:BEAM:MMS:X&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ0 (EK1122-0080)^Term 113 (EK1101-0080)^Beamblock X (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ0</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">113</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Beamblock</span> <span class="n">X</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M30</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">BEAM</span> <span class="n">X</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:BEAM:MMS:Y&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ0 (EK1122-0080)^Term 113 (EK1101-0080)^Beamblock Y (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ0</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">113</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Beamblock</span> <span class="n">Y</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M31</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">BEAM</span> <span class="n">Y</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:BEAM:MMS:Z&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ0 (EK1122-0080)^Term 113 (EK1101-0080)^Beamblock Z (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ0</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">113</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Beamblock</span> <span class="n">Z</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M32</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">BEAM</span> <span class="n">Z</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:CAM:MMS:X&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ0 (EK1122-0080)^Term 109 (EK1101-0080)^Camera X (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ0</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">109</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Camera</span> <span class="n">X</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M33</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">CAM</span> <span class="n">X</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:CAM:MMS:Y&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-ECJ0 (EK1122-0080)^Term 109 (EK1101-0080)^Camera Y (EL7041)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">ECJ0</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">109</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">Camera</span> <span class="n">Y</span> <span class="p">(</span><span class="n">EL7041</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M34</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">CAM</span> <span class="n">Z</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:OUTCOUP:MMS:Y&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E31 (EL7031)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E31</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M35</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">OUTCOUP</span> <span class="n">LENS</span> <span class="n">Y</span>

<span class="p">(</span><span class="o">*</span>
    <span class="n">M21</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span> <span class="o">//</span> <span class="n">Out</span><span class="o">-</span><span class="n">coupling</span> <span class="n">y</span>
 <span class="o">*</span><span class="p">)</span>

 <span class="p">(</span><span class="o">*</span> <span class="ow">not</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">now</span><span class="p">;</span> <span class="n">it</span> <span class="n">has</span> <span class="n">a</span> <span class="n">manual</span> <span class="n">knob</span>
 <span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">Questar</span> <span class="ow">is</span> <span class="n">M21</span><span class="p">,</span> <span class="n">even</span> <span class="n">though</span> <span class="n">Outcoupling</span> <span class="n">Y</span> <span class="n">stage</span> <span class="ow">is</span> <span class="n">before</span> <span class="n">it</span> <span class="n">on</span> <span class="n">the</span> <span class="n">DIN</span> <span class="n">rail</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:QSTR:MMS:FOCUS&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E33 (EL7031)^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">1</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">5</span> <span class="p">(</span><span class="n">EK1200</span><span class="p">)</span><span class="o">^</span><span class="n">Term</span> <span class="mi">6</span> <span class="p">(</span><span class="n">EK1122</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">EK0</span> <span class="p">(</span><span class="n">EK1101</span><span class="o">-</span><span class="mi">0080</span><span class="p">)</span><span class="o">^</span><span class="n">DRL02</span><span class="o">-</span><span class="n">E33</span> <span class="p">(</span><span class="n">EL7031</span><span class="p">)</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M21</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span> <span class="o">//</span> <span class="n">Questar</span> <span class="n">Focus</span>
<span class="o">*</span><span class="p">)</span>
    <span class="o">//</span><span class="n">Catcher</span> <span class="n">Axes</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCC:MMS:X&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[Catcher_E1_EL7041]^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Catcher_E1_EL7041</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="s1">&#39;}</span>
    <span class="n">M37</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">RCC</span> <span class="n">X</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCC:MMS:Y&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[Catcher_E3_EL7041]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Catcher_E3_EL7041</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="n">M38</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">RCC</span> <span class="n">Y</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCC:MMS:Z&#39;</span><span class="p">}</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[Catcher_E4_EL7041]^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Catcher_E4_EL7041</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="s1">&#39;}</span>
    <span class="n">M39</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bPowerSelf</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">nEnableMode</span><span class="o">:=</span><span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">);</span> <span class="o">//</span><span class="n">RCC</span> <span class="n">Z</span>

     <span class="o">//</span> <span class="n">VLS</span> <span class="n">SLIT</span> <span class="n">TOP</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable:=TIIB[VLS_EP6_EP7041-1002]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP6_EP7041</span><span class="o">-</span><span class="mi">1002</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">CRIX</span><span class="p">:</span><span class="n">VLS</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">SLTOP</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">VLS</span> <span class="n">Slit</span> <span class="n">TOP</span> <span class="n">Blade</span>
    <span class="s1">&#39;}</span>
    <span class="n">M40</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

     <span class="o">//</span> <span class="n">VLS</span> <span class="n">SLIT</span> <span class="n">BOTTOM</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable:=TIIB[VLS_EP7_EP7041-1002]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP7_EP7041</span><span class="o">-</span><span class="mi">1002</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">CRIX</span><span class="p">:</span><span class="n">VLS</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">SLBOTTOM</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">VLS</span> <span class="n">Slit</span> <span class="n">BOTTOM</span> <span class="n">Blade</span>
    <span class="s1">&#39;}</span>
    <span class="n">M41</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">VLS</span> <span class="n">SLIT</span> <span class="n">RIGHT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable:=TIIB[VLS_EP8_EP7041-1002]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP8_EP7041</span><span class="o">-</span><span class="mi">1002</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">CRIX</span><span class="p">:</span><span class="n">VLS</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">SLRIGHT</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">VLS</span> <span class="n">Slit</span> <span class="n">RIGHT</span> <span class="n">Blade</span>
    <span class="s1">&#39;}</span>
    <span class="n">M42</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>


    <span class="o">//</span> <span class="n">VLS</span> <span class="n">SLIT</span> <span class="n">LEFT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable:=TIIB[VLS_EP9_EP7041-1002]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP9_EP7041</span><span class="o">-</span><span class="mi">1002</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">CRIX</span><span class="p">:</span><span class="n">VLS</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">SLLEFT</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">VLS</span> <span class="n">Slit</span> <span class="n">LEFT</span> <span class="n">Blade</span>
    <span class="s1">&#39;}</span>
    <span class="n">M43</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>



    <span class="o">//</span> <span class="n">VLS</span> <span class="n">focusing</span> <span class="n">mirror</span> <span class="n">pitch</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable:=TIIB[VLS_EP10_EP7041-3102]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP10_EP7041</span><span class="o">-</span><span class="mi">3102</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderUINT</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP10_EP7041</span><span class="o">-</span><span class="mi">3102</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Counter</span> <span class="n">value</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">bHome</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP10_EP7041</span><span class="o">-</span><span class="mi">3102</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Status</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">C</span><span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span>  <span class="n">CRIX</span><span class="p">:</span><span class="n">VLS</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">MP</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">VLS</span> <span class="n">Focus</span> <span class="n">Mirror</span>
    <span class="s1">&#39;}</span>
    <span class="n">M44</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">VLS</span> <span class="n">grating</span> <span class="n">pitch</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable:=TIIB[VLS_EP11_EP7041-3102]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP11_EP7041</span><span class="o">-</span><span class="mi">3102</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderUINT</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP11_EP7041</span><span class="o">-</span><span class="mi">3102</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Counter</span> <span class="n">value</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">bHome</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP11_EP7041</span><span class="o">-</span><span class="mi">3102</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Status</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">C</span><span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span>  <span class="n">CRIX</span><span class="p">:</span><span class="n">VLS</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">GP</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">VLS</span> <span class="n">Grating</span>
    <span class="s1">&#39;}</span>
    <span class="n">M45</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">VLS</span> <span class="n">camera</span> <span class="n">Pitch</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable:=TIIB[VLS_EP12_EP7041-3102]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP12_EP7041</span><span class="o">-</span><span class="mi">3102</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">bHome</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP12_EP7041</span><span class="o">-</span><span class="mi">3102</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Status</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">C</span><span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span>  <span class="n">CRIX</span><span class="p">:</span><span class="n">VLS</span><span class="p">:</span><span class="n">CAM</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">PITCH</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">VLS</span> <span class="n">Camera</span> <span class="n">Pitch</span>
    <span class="s1">&#39;}</span>
    <span class="n">M46</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">VLS</span> <span class="n">camera</span> <span class="n">Distance</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable:=TIIB[VLS_EP13_EP7041-3102]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP13_EP7041</span><span class="o">-</span><span class="mi">3102</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">bHome</span><span class="o">:=</span><span class="n">TIIB</span><span class="p">[</span><span class="n">VLS_EP13_EP7041</span><span class="o">-</span><span class="mi">3102</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Status</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">C</span><span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span>  <span class="n">CRIX</span><span class="p">:</span><span class="n">VLS</span><span class="p">:</span><span class="n">CAM</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">DIST</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">VLS</span> <span class="n">Camera</span> <span class="n">Translation</span>
    <span class="s1">&#39;}</span>
    <span class="n">M47</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="o">//</span><span class="n">Cryo</span> <span class="n">pump</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable:=TIIB[DRL02-E23 (EL7041)]^STM Status^Status^Digital input 2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span>  <span class="n">CRIX</span><span class="p">:</span><span class="n">PTC</span><span class="p">:</span><span class="n">Y</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="mi">10</span>
        <span class="n">field</span><span class="p">:</span><span class="n">Cryo</span> <span class="n">Pump</span> <span class="n">Y</span> <span class="n">stage</span> <span class="mi">10</span>
    <span class="s1">&#39;}</span>
    <span class="n">M48</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable:=TIIB[DRL02-E21 (EL7041)]^STM Status^Status^Digital input 2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span>  <span class="n">CRIX</span><span class="p">:</span><span class="n">PTC</span><span class="p">:</span><span class="n">Y</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="mi">11</span>
        <span class="n">field</span><span class="p">:</span><span class="n">Cryo</span> <span class="n">Pump</span> <span class="n">Y</span> <span class="n">stage</span> <span class="mi">11</span>
    <span class="s1">&#39;}</span>
    <span class="n">M49</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">SL2K2</span><span class="o">-</span><span class="n">SCATTER</span><span class="p">:</span> <span class="mi">4</span> <span class="n">Axes</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: SL2K2:SCATTER:MMS:BOTTOM&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[SL2K2-EL7031-E1]^STM Status^Status^Digital input 2;</span>
                             <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SL2K2</span><span class="o">-</span><span class="n">EL7031</span><span class="o">-</span><span class="n">E1</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderUINT</span>      <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SL2K2</span><span class="o">-</span><span class="n">EL5101</span><span class="o">-</span><span class="n">E2</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Counter</span> <span class="n">value</span><span class="s1">&#39;}</span>
    <span class="n">M50</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;SL2K2:SCATTER:MMS:BOTTOM&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: SL2K2:SCATTER:MMS:TOP&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[SL2K2-EL7031-E3]^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SL2K2</span><span class="o">-</span><span class="n">EL7031</span><span class="o">-</span><span class="n">E3</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderUINT</span>      <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SL2K2</span><span class="o">-</span><span class="n">EL5101</span><span class="o">-</span><span class="n">E4</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Counter</span> <span class="n">value</span><span class="s1">&#39;}</span>
    <span class="n">M51</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;SL2K2:SCATTER:MMS:TOP&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: SL2K2:SCATTER:MMS:NORTH&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[SL2K2-EL7031-E5]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SL2K2</span><span class="o">-</span><span class="n">EL7031</span><span class="o">-</span><span class="n">E5</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderUINT</span>      <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SL2K2</span><span class="o">-</span><span class="n">EL5101</span><span class="o">-</span><span class="n">E6</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Counter</span> <span class="n">value</span><span class="s1">&#39;}</span>
    <span class="n">M52</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;SL2K2:SCATTER:MMS:NORTH&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: SL2K2:SCATTER:MMS:SOUTH&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[SL2K2-EL7031-E7]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SL2K2</span><span class="o">-</span><span class="n">EL7031</span><span class="o">-</span><span class="n">E7</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderUINT</span>      <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SL2K2</span><span class="o">-</span><span class="n">EL5101</span><span class="o">-</span><span class="n">E8</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Counter</span> <span class="n">value</span><span class="s1">&#39;}</span>
    <span class="n">M53</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;SL2K2:SCATTER:MMS:SOUTH&#39;</span><span class="p">);</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
</section>
<section id="pous">
<h1>POUs<a class="headerlink" href="#pous" title="Link to this heading"></a></h1>
<section id="f-inrange">
<h2>F_InRange<a class="headerlink" href="#f-inrange" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_InRange</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="o">//</span> <span class="n">Determine</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">between</span> <span class="n">the</span> <span class="n">lower</span> <span class="ow">and</span> <span class="n">upper</span> <span class="n">limit</span>
<span class="n">VAR_INPUT</span>
    <span class="n">value</span>           <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">lower_limit</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">upper_limit</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">F_InRange</span> <span class="o">:=</span> <span class="p">(</span><span class="n">lower_limit</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">upper_limit</span><span class="p">);</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
</section>
<section id="fb-adjacentstates">
<h2>FB_AdjacentStates<a class="headerlink" href="#fb-adjacentstates" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_AdjacentStates</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">arrTransitionMatrix</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">adjacency</span> <span class="n">matrix</span> <span class="n">of</span> <span class="n">allowed</span> <span class="n">transitions</span>
    <span class="n">arrAdjacentStates</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span> <span class="o">//</span> <span class="n">output</span> <span class="n">array</span> <span class="n">of</span> <span class="n">found</span> <span class="n">adjacent</span> <span class="n">states</span>
    <span class="n">arrStates</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span> <span class="o">//</span> <span class="n">array</span> <span class="n">of</span> <span class="n">assembly</span> <span class="n">states</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="n">iRootState</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">nAdjacentStates</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">nStates</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">iCounter</span> <span class="p">:</span> <span class="n">INT</span><span class="p">;</span>
    <span class="n">iState</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">iTransition</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">iCounter</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">nStates</span> <span class="o">:=</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrStates</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">FOR</span> <span class="n">iTransition</span> <span class="o">:=</span> <span class="mi">1</span> <span class="n">TO</span> <span class="n">nStates</span> <span class="n">DO</span>
    <span class="n">iState</span> <span class="o">:=</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">iTransition</span><span class="p">]</span><span class="o">.</span><span class="n">iState</span><span class="p">;</span> <span class="o">//</span> <span class="n">pick</span> <span class="n">out</span> <span class="n">the</span> <span class="n">state</span> <span class="n">index</span> <span class="n">of</span> <span class="n">the</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">question</span>
    <span class="n">IF</span> <span class="n">iState</span> <span class="o">&lt;&gt;</span> <span class="n">iRootState</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">only</span> <span class="n">look</span> <span class="n">at</span> <span class="n">transitions</span> <span class="n">away</span> <span class="kn">from</span> <span class="nn">root</span> <span class="n">state</span>
        <span class="n">IF</span> <span class="n">arrTransitionMatrix</span><span class="p">[</span><span class="n">iRootState</span><span class="p">,</span> <span class="n">iTransition</span><span class="p">]</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">the</span> <span class="n">transition</span> <span class="ow">is</span> <span class="n">allowed</span>
            <span class="n">iCounter</span> <span class="o">:=</span> <span class="n">iCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">arrAdjacentStates</span><span class="p">[</span><span class="n">iCounter</span><span class="p">]</span> <span class="o">:=</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">iTransition</span><span class="p">];</span> <span class="o">//</span> <span class="n">save</span> <span class="n">this</span> <span class="n">adjacent</span> <span class="n">state</span>
        <span class="n">END_IF</span>
    <span class="n">END_IF</span>
<span class="n">END_FOR</span>
<span class="n">nAdjacentStates</span> <span class="o">:=</span> <span class="n">iCounter</span><span class="p">;</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#st-bfsassemblystate">ST_BFSAssemblyState</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-assemblypositionstatemanager">
<h2>FB_AssemblyPositionStateManager<a class="headerlink" href="#fb-assemblypositionstatemanager" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_AssemblyPositionStateManager</span>
<span class="p">(</span><span class="o">*</span>
    <span class="n">Handles</span> <span class="n">EPICS</span> <span class="n">moves</span> <span class="n">between</span> <span class="n">multiple</span> <span class="n">states</span> <span class="k">for</span> <span class="n">multiple</span> <span class="n">axes</span><span class="o">.</span>
    <span class="n">See</span> <span class="n">FB_XXXX</span> <span class="k">for</span> <span class="n">an</span> <span class="n">example</span><span class="o">.</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">VAR_IN_OUT</span>

    <span class="o">//</span> <span class="n">Array</span> <span class="n">of</span> <span class="n">bMoveEnables</span> <span class="n">to</span><span class="p">,</span> <span class="n">well</span><span class="p">,</span> <span class="n">enable</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">assembly</span> <span class="n">state</span><span class="o">.</span>
    <span class="n">arrOutputs</span><span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Array</span> <span class="n">of</span> <span class="n">allowed</span> <span class="n">position</span> <span class="n">state</span> <span class="n">transitions</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">adjacency</span> <span class="n">matrix</span>
    <span class="n">arrTransitions</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Array</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">axes</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">assembly</span>
    <span class="n">arrAxes</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Array</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">assembly</span> <span class="n">states</span>
    <span class="n">arrAssemblyStates</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">STRING</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">nAssemblyStates</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">nAxes</span> <span class="p">:</span><span class="n">DINT</span><span class="p">;</span>
    <span class="n">nOutputs</span> <span class="p">:</span><span class="n">DINT</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bAtState</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">iAxis</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">stAxis</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stState</span> <span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>

    <span class="n">currState</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">nextState</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">//</span><span class="n">nAssemblyStates</span> <span class="o">:=</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrAssemblyStates</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">nAssemblyStates</span> <span class="o">:=</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrTransitions</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="o">//</span> <span class="n">take</span> <span class="kn">from</span> <span class="c1"># of columns in transition matrix</span>
    <span class="n">nAxes</span> <span class="o">:=</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrAxes</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">nOutputs</span> <span class="o">:=</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrOutputs</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Determine</span> <span class="n">current</span> <span class="n">assembly</span> <span class="n">state</span>
<span class="n">currState</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">//</span> <span class="n">Start</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">unknown</span> <span class="n">state</span>
<span class="n">FOR</span> <span class="n">nextState</span> <span class="o">:=</span> <span class="mi">1</span> <span class="n">TO</span> <span class="n">nOutputs</span> <span class="n">DO</span> <span class="o">//</span> <span class="n">For</span> <span class="n">each</span> <span class="n">defined</span> <span class="n">output</span> <span class="n">state</span>
    <span class="n">bAtState</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">FOR</span> <span class="n">iAxis</span> <span class="o">:=</span> <span class="mi">1</span> <span class="n">TO</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrAxes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="n">DO</span> <span class="o">//</span> <span class="n">check</span> <span class="n">each</span> <span class="n">axis</span> <span class="k">for</span> <span class="n">a</span> <span class="n">match</span> <span class="k">with</span> <span class="n">the</span> <span class="n">assembly</span> <span class="n">position</span> <span class="n">state</span>
        <span class="n">bAtState</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bAtState</span> <span class="n">AND</span> <span class="n">F_AtPositionState</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">arrAxes</span><span class="p">[</span><span class="n">iAxis</span><span class="p">],</span> <span class="n">stPositionState</span><span class="o">:=</span><span class="n">arrOutputs</span><span class="p">[</span><span class="n">nextState</span><span class="p">,</span> <span class="n">iAxis</span><span class="p">]));</span>
    <span class="n">END_FOR</span>
    <span class="n">IF</span> <span class="n">bAtState</span> <span class="n">THEN</span>
        <span class="n">currState</span> <span class="o">:=</span> <span class="n">nextState</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="n">END_FOR</span>

<span class="o">//</span> <span class="n">Reset</span> <span class="n">logic</span> <span class="n">before</span> <span class="n">determining</span> <span class="n">allowed</span> <span class="n">moves</span>
<span class="n">FOR</span> <span class="n">nextState</span> <span class="o">:=</span> <span class="mi">1</span> <span class="n">TO</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrAssemblyStates</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">DO</span>
    <span class="n">FOR</span> <span class="n">iAxis</span> <span class="o">:=</span> <span class="mi">1</span> <span class="n">TO</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrAxes</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">DO</span>
        <span class="n">arrOutputs</span><span class="p">[</span><span class="n">nextState</span><span class="p">,</span> <span class="n">iAxis</span><span class="p">]</span><span class="o">.</span><span class="n">bMoveOk</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">END_FOR</span>
<span class="n">END_FOR</span>

<span class="o">//</span> <span class="n">Update</span> <span class="n">motion</span> <span class="n">logic</span> <span class="k">for</span> <span class="nb">next</span> <span class="n">state</span> <span class="n">based</span> <span class="n">on</span> <span class="n">current</span> <span class="n">state</span>
<span class="n">FOR</span> <span class="n">nextState</span> <span class="o">:=</span> <span class="mi">1</span> <span class="n">TO</span> <span class="n">nAssemblyStates</span> <span class="n">DO</span>
    <span class="n">IF</span> <span class="n">arrTransitions</span><span class="p">[</span><span class="n">currState</span><span class="p">,</span> <span class="n">nextState</span><span class="p">]</span> <span class="n">THEN</span>
        <span class="n">FOR</span> <span class="n">iAxis</span> <span class="o">:=</span><span class="mi">1</span> <span class="n">TO</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrAxes</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">DO</span>
            <span class="n">arrOutputs</span><span class="p">[</span><span class="n">nextState</span><span class="p">,</span> <span class="n">iAxis</span><span class="p">]</span><span class="o">.</span><span class="n">bMoveOk</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">END_FOR</span>
    <span class="n">END_IF</span>
<span class="n">END_FOR</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-bfs">
<h2>FB_BFS<a class="headerlink" href="#fb-bfs" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_BFS</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">fbAdjacent</span> <span class="p">:</span> <span class="n">FB_AdjacentStates</span><span class="p">;</span>
    <span class="n">arrTransitions</span><span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">arrAdjStates</span><span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
    <span class="o">//</span><span class="n">arrAdjStates</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">nAdjacentStates</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">arrStates</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
    <span class="n">arrPath</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
    <span class="n">stQueue</span> <span class="p">:</span> <span class="n">ST_Queue</span><span class="p">;</span>
    <span class="n">fbQueue</span> <span class="p">:</span> <span class="n">FB_Queue</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="n">RootState</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
    <span class="n">Target</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">bError</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">an</span> <span class="n">error</span> <span class="n">occured</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">we</span> <span class="n">didn</span><span class="s1">&#39;t find the requested state</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">Current</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
    <span class="n">Root</span>    <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
    <span class="n">Adjacent</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
    <span class="n">iCounter</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">nStates</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="o">//</span>
    <span class="n">iState</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">iTransition</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">bFound</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Next</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
    <span class="n">iLower</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">iUpper</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">bFirst</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">THIS</span><span class="o">^.</span><span class="n">ClearStates</span><span class="p">();</span>
<span class="n">Root</span> <span class="o">:=</span> <span class="n">THIS</span><span class="o">^.</span><span class="n">GetState</span><span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="n">RootState</span><span class="o">.</span><span class="n">iState</span><span class="p">,</span> <span class="n">bDiscover</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
<span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="n">Root</span><span class="p">);</span>
<span class="n">WHILE</span> <span class="n">NOT</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Queue_Is_Empty</span><span class="p">()</span> <span class="n">DO</span>
    <span class="n">Current</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span>
    <span class="n">IF</span> <span class="n">Current</span><span class="o">.</span><span class="n">iState</span> <span class="o">=</span> <span class="n">Target</span><span class="o">.</span><span class="n">iState</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">found</span> <span class="n">destination</span>
        <span class="n">bFound</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">EXIT</span><span class="p">;</span>
    <span class="n">ELSE</span>
        <span class="o">//</span> <span class="n">Put</span> <span class="n">adjacent</span> <span class="n">states</span> <span class="n">into</span> <span class="n">arrAdjStates</span><span class="p">,</span> <span class="n">count</span> <span class="c1"># of adjacent states</span>
        <span class="n">THIS</span><span class="o">^.</span><span class="n">GetAdjacentStates</span><span class="p">(</span><span class="n">Current</span><span class="o">.</span><span class="n">iState</span><span class="p">);</span>
        <span class="o">//</span> <span class="n">Mark</span> <span class="nb">any</span> <span class="n">undiscovered</span> <span class="n">states</span> <span class="ow">in</span> <span class="n">arrAdjStates</span><span class="p">,</span> <span class="n">add</span> <span class="n">them</span> <span class="n">to</span> <span class="n">the</span> <span class="n">queue</span><span class="p">,</span> <span class="ow">and</span> <span class="n">label</span> <span class="n">their</span> <span class="n">parent</span> <span class="n">state</span>
        <span class="n">THIS</span><span class="o">^.</span><span class="n">DiscoverStates</span><span class="p">();</span>
    <span class="n">END_IF</span>
<span class="n">END_WHILE</span>

<span class="o">//</span> <span class="n">Stuff</span> <span class="n">the</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">first</span>
<span class="o">//</span><span class="n">arrPath</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">Target</span><span class="o">.</span><span class="n">iState</span><span class="p">];</span>
<span class="n">arrPath</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="n">THIS</span><span class="o">^.</span><span class="n">GetState</span><span class="p">(</span><span class="n">iState</span><span class="o">:=</span><span class="n">Target</span><span class="o">.</span><span class="n">iState</span><span class="p">,</span> <span class="n">bDiscover</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Get</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">state</span> <span class="n">before</span> <span class="n">starting</span> <span class="n">loop</span>
<span class="n">Current</span> <span class="o">:=</span> <span class="n">THIS</span><span class="o">^.</span><span class="n">GetNextState</span><span class="p">(</span><span class="n">PrevState</span><span class="o">:=</span><span class="n">Target</span><span class="p">);</span>
<span class="n">iCounter</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">WHILE</span> <span class="n">Current</span><span class="o">.</span><span class="n">iParent</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span> <span class="n">DO</span>
    <span class="o">//</span> <span class="n">Stuff</span> <span class="n">state</span> <span class="n">into</span> <span class="n">path</span> <span class="n">array</span>
    <span class="n">arrPath</span><span class="p">[</span><span class="n">iCounter</span><span class="p">]</span> <span class="o">:=</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">Current</span><span class="o">.</span><span class="n">iState</span><span class="p">];</span>
    <span class="o">//</span> <span class="n">Locate</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">child</span> <span class="n">state</span>
    <span class="n">Current</span> <span class="o">:=</span> <span class="n">THIS</span><span class="o">^.</span><span class="n">GetNextState</span><span class="p">(</span><span class="n">PrevState</span><span class="o">:=</span><span class="n">Current</span><span class="p">);</span>
    <span class="n">iCounter</span> <span class="o">:=</span> <span class="n">iCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">iCounter</span> <span class="o">&gt;=</span> <span class="n">nStates</span> <span class="n">THEN</span>
        <span class="n">EXIT</span><span class="p">;</span> <span class="o">//</span> <span class="n">Something</span> <span class="n">bad</span> <span class="n">happened</span><span class="o">.</span> <span class="n">We</span> <span class="n">exceeded</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">possible</span> <span class="n">states</span><span class="o">.</span>
    <span class="n">END_IF</span>
<span class="n">END_WHILE</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">METHOD</span> <span class="n">ClearStates</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">Counter</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">FOR</span> <span class="n">Counter</span> <span class="o">:=</span> <span class="n">LOWER_BOUND</span><span class="p">(</span><span class="n">arrStates</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrStates</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="n">DO</span> <span class="o">//</span> <span class="nb">set</span> <span class="nb">all</span> <span class="n">states</span> <span class="n">to</span> <span class="n">undiscovered</span><span class="p">,</span> <span class="n">clear</span> <span class="n">parent</span> <span class="n">states</span>
    <span class="n">arrStates</span><span class="p">[</span><span class="n">Counter</span><span class="p">]</span><span class="o">.</span><span class="n">bDiscovered</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">arrStates</span><span class="p">[</span><span class="n">Counter</span><span class="p">]</span><span class="o">.</span><span class="n">iParent</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">END_FOR</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">DiscoverStates</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">Counter</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">FOR</span> <span class="n">Counter</span> <span class="o">:=</span> <span class="n">LOWER_BOUND</span><span class="p">(</span><span class="n">arrAdjStates</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">nAdjacentStates</span> <span class="n">DO</span> <span class="o">//</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">adjacent</span> <span class="n">states</span>
    <span class="n">Adjacent</span> <span class="o">:=</span> <span class="n">arrAdjStates</span><span class="p">[</span><span class="n">Counter</span><span class="p">];</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">Adjacent</span><span class="o">.</span><span class="n">iState</span><span class="p">]</span><span class="o">.</span><span class="n">bDiscovered</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">check</span> <span class="n">that</span> <span class="n">we</span> <span class="n">haven</span><span class="s1">&#39;t visited this one yet</span>
        <span class="n">arrStates</span><span class="p">[</span><span class="n">Adjacent</span><span class="o">.</span><span class="n">iState</span><span class="p">]</span><span class="o">.</span><span class="n">bDiscovered</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">mark</span> <span class="n">state</span> <span class="k">as</span> <span class="n">discovered</span>
        <span class="n">arrStates</span><span class="p">[</span><span class="n">Adjacent</span><span class="o">.</span><span class="n">iState</span><span class="p">]</span><span class="o">.</span><span class="n">iParent</span> <span class="o">:=</span> <span class="n">Current</span><span class="o">.</span><span class="n">iState</span><span class="p">;</span>
        <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="n">arrStates</span><span class="p">[</span><span class="n">Adjacent</span><span class="o">.</span><span class="n">iState</span><span class="p">]);</span> <span class="o">//</span> <span class="n">add</span> <span class="n">state</span> <span class="n">to</span> <span class="n">queue</span> <span class="n">to</span> <span class="k">continue</span> <span class="n">search</span>
    <span class="n">END_IF</span>
<span class="n">END_FOR</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">GetAdjacentStates</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">iStartState</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span> <span class="o">//</span> <span class="n">Node</span> <span class="n">to</span> <span class="n">expand</span> <span class="n">find</span> <span class="n">adjacent</span> <span class="n">nodes</span> <span class="kn">from</span>
<span class="nn">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">stateCounter</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">transitionCounter</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">transitionCounter</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="o">//</span> <span class="n">Loop</span> <span class="n">over</span> <span class="nb">all</span> <span class="n">states</span> <span class="n">to</span> <span class="n">find</span> <span class="n">states</span> <span class="n">adjacent</span> <span class="n">to</span> <span class="n">the</span> <span class="n">current</span> <span class="n">state</span>
<span class="n">FOR</span> <span class="n">stateCounter</span> <span class="o">:=</span> <span class="n">LOWER_BOUND</span><span class="p">(</span><span class="n">arrStates</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrStates</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="n">DO</span> <span class="o">//</span> <span class="n">start</span> <span class="n">at</span> <span class="n">zero</span> <span class="n">due</span> <span class="n">to</span> <span class="n">arrStates</span> <span class="n">index</span>
    <span class="n">iState</span> <span class="o">:=</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">stateCounter</span><span class="p">]</span><span class="o">.</span><span class="n">iState</span><span class="p">;</span> <span class="o">//</span> <span class="n">pick</span> <span class="n">out</span> <span class="n">the</span> <span class="n">state</span> <span class="n">index</span> <span class="n">of</span> <span class="n">the</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">question</span>
    <span class="n">IF</span> <span class="n">iState</span> <span class="o">&lt;&gt;</span> <span class="n">iStartState</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">only</span> <span class="n">look</span> <span class="n">at</span> <span class="n">transitions</span> <span class="n">away</span> <span class="kn">from</span> <span class="nn">root</span> <span class="n">state</span>
        <span class="n">IF</span> <span class="n">arrTransitions</span><span class="p">[</span><span class="n">iStartState</span><span class="p">,</span> <span class="n">stateCounter</span><span class="p">]</span> <span class="n">THEN</span> <span class="o">//</span> <span class="n">the</span> <span class="n">transition</span> <span class="ow">is</span> <span class="n">allowed</span>
            <span class="n">transitionCounter</span> <span class="o">:=</span> <span class="n">transitionCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">arrAdjStates</span><span class="p">[</span><span class="n">transitionCounter</span><span class="p">]</span> <span class="o">:=</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">stateCounter</span><span class="p">];</span> <span class="o">//</span> <span class="n">save</span> <span class="n">this</span> <span class="n">adjacent</span> <span class="n">state</span>
        <span class="n">END_IF</span>
    <span class="n">END_IF</span>
<span class="n">END_FOR</span>
<span class="n">nAdjacentStates</span> <span class="o">:=</span> <span class="n">transitionCounter</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">GetNextState</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span>
<span class="n">VAR_INPUT</span>
    <span class="n">PrevState</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">Counter</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Find</span> <span class="nb">next</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">path</span> <span class="n">by</span> <span class="n">following</span> <span class="n">parent</span> <span class="n">attribute</span>
<span class="n">FOR</span> <span class="n">Counter</span> <span class="o">:=</span> <span class="n">LOWER_BOUND</span><span class="p">(</span><span class="n">arrStates</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrStates</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">DO</span>
    <span class="n">IF</span> <span class="n">PrevState</span><span class="o">.</span><span class="n">iParent</span> <span class="o">=</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">Counter</span><span class="p">]</span><span class="o">.</span><span class="n">iState</span> <span class="n">THEN</span>
        <span class="n">GetNextState</span> <span class="o">:=</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">Counter</span><span class="p">];</span>
        <span class="n">EXIT</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="n">END_FOR</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">GetState</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span>
<span class="n">VAR_INPUT</span>
    <span class="n">iState</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">bDiscover</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">Counter</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">FOR</span> <span class="n">Counter</span> <span class="o">:=</span> <span class="n">LOWER_BOUND</span><span class="p">(</span><span class="n">arrStates</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">arrStates</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="n">DO</span>
    <span class="n">IF</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">Counter</span><span class="p">]</span><span class="o">.</span><span class="n">iState</span> <span class="o">=</span> <span class="n">iState</span> <span class="n">THEN</span>
        <span class="n">arrStates</span><span class="p">[</span><span class="n">Counter</span><span class="p">]</span><span class="o">.</span><span class="n">bDiscovered</span> <span class="o">:=</span> <span class="n">bDiscover</span><span class="p">;</span> <span class="o">//</span> <span class="nb">set</span> <span class="n">state</span> <span class="n">to</span> <span class="n">discovered</span>
        <span class="n">GetState</span> <span class="o">:=</span> <span class="n">arrStates</span><span class="p">[</span><span class="n">Counter</span><span class="p">];</span>
    <span class="n">END_IF</span>
<span class="n">END_FOR</span>
<span class="n">END_METHOD</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-adjacentstates">FB_AdjacentStates</a></p></li>
<li><p><a class="reference internal" href="#fb-queue">FB_Queue</a></p></li>
<li><p><a class="reference internal" href="#st-bfsassemblystate">ST_BFSAssemblyState</a></p></li>
<li><p><a class="reference internal" href="#st-queue">ST_Queue</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-checkeps">
<h2>FB_CheckEPS<a class="headerlink" href="#fb-checkeps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_CheckEPS</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stMotor</span> <span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">aEPSLimits</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_EPSLimits</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Allows</span> <span class="k">for</span> <span class="n">user</span> <span class="n">to</span> <span class="n">define</span> <span class="n">what</span> <span class="ow">is</span> <span class="s1">&#39;forward&#39;</span> <span class="ow">and</span> <span class="n">what</span> <span class="ow">is</span> <span class="s1">&#39;backward&#39;</span><span class="o">.</span> <span class="n">In</span> <span class="n">most</span> <span class="n">cases</span><span class="p">,</span> <span class="n">use</span> <span class="n">the</span> <span class="n">in_out</span> <span class="n">stMotor</span> <span class="k">as</span> <span class="n">default</span><span class="o">.</span>
    <span class="n">stForwardMotorEPS</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">stBackwardMotorEPS</span><span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="o">//</span> <span class="n">Encoder</span> <span class="n">Position</span><span class="p">,</span> <span class="n">Current</span> <span class="n">position</span> <span class="n">of</span> <span class="n">motor</span><span class="o">.</span> <span class="n">Needed</span> <span class="k">for</span> <span class="n">the</span> <span class="n">case</span> <span class="n">where</span> <span class="n">the</span> <span class="n">motor</span> <span class="ow">and</span> <span class="n">encoders</span> <span class="n">are</span> <span class="n">seperate</span><span class="o">.</span> <span class="n">Default</span> <span class="n">use</span> <span class="n">stMotor</span> <span class="n">Position</span>
    <span class="n">fPosition</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Ignores</span> <span class="n">EPS</span>
    <span class="n">bEPS_Override</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">nPreviousState</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">nIndex</span><span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">nEPSIndex</span><span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">bUnknownState</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fbBwdEPS</span><span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbFwdEPS</span><span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">fbBwdEps</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">stBackwardMotorEPS</span><span class="p">);</span>
<span class="n">fbFwdEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">stForwardMotorEPS</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Look</span> <span class="n">through</span> <span class="n">possible</span> <span class="n">states</span> <span class="n">to</span> <span class="n">see</span> <span class="n">which</span> <span class="n">state</span> <span class="n">we</span> <span class="n">are</span> <span class="ow">in</span>
<span class="n">bUnknownState</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">FOR</span> <span class="n">nIndex</span> <span class="o">:=</span> <span class="n">LOWER_BOUND</span><span class="p">(</span><span class="n">aEPSLimits</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">UPPER_BOUND</span><span class="p">(</span><span class="n">aEPSLimits</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">BY</span> <span class="mi">1</span> <span class="n">DO</span>
    <span class="n">IF</span> <span class="n">aEPSLimits</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span> <span class="n">THEN</span>
        <span class="n">nEPSIndex</span> <span class="o">:=</span> <span class="n">nIndex</span><span class="p">;</span>
        <span class="n">bUnknownState</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Known</span> <span class="n">State</span>
        <span class="n">exit</span><span class="p">;</span> <span class="o">//</span> <span class="n">stop</span> <span class="n">when</span> <span class="n">found</span> <span class="n">state</span>
    <span class="n">END_IF</span>
<span class="n">END_FOR</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">nPreviousState</span> <span class="o">&lt;&gt;</span> <span class="n">nEPSIndex</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">only</span> <span class="n">clear</span> <span class="n">stMotor</span> <span class="n">eps</span> <span class="kn">from</span> <span class="nn">previous</span> <span class="n">state</span><span class="o">.</span>
    <span class="n">fbBwdEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">DINT_TO_BYTE</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">TRUE</span><span class="p">);</span>
    <span class="n">fbFwdEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">DINT_TO_BYTE</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">plc</span> <span class="n">limit</span> <span class="n">rage</span><span class="p">,</span> <span class="n">Stop</span> <span class="n">motor</span> <span class="k">if</span> <span class="n">out</span> <span class="n">of</span> <span class="n">Upper</span><span class="o">/</span><span class="n">Lower</span> <span class="n">bounds</span>
<span class="n">IF</span> <span class="n">fPosition</span> <span class="o">&gt;</span> <span class="n">aEPSLimits</span><span class="p">[</span><span class="n">nEPSIndex</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="n">THEN</span>
    <span class="n">fbBwdEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">DINT_TO_BYTE</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">fbBwdEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">DINT_TO_BYTE</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">FALSE</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">fPosition</span> <span class="o">&lt;</span> <span class="n">aEPSLimits</span><span class="p">[</span><span class="n">nEPSIndex</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="n">THEN</span>
    <span class="n">fbFwdEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">DINT_TO_BYTE</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">fbFwdEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">DINT_TO_BYTE</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">FALSE</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">bUnknownState</span> <span class="n">THEN</span>
    <span class="n">stBackwardMotorEPS</span><span class="o">.</span><span class="n">bEPS_OK</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stForwardMotorEPS</span><span class="o">.</span><span class="n">bEPS_OK</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">stBackwardMotorEPS</span><span class="o">.</span><span class="n">sMessage</span> <span class="o">:=</span> <span class="s1">&#39;UNKNOWN STATE&#39;</span><span class="p">;</span>
    <span class="n">stForwardMotorEPS</span><span class="o">.</span><span class="n">sMessage</span> <span class="o">:=</span> <span class="s1">&#39;UNKNOWN STATE&#39;</span><span class="p">;</span>
    <span class="n">ELSE</span>
    <span class="o">//</span> <span class="n">Update</span> <span class="n">Labels</span>
    <span class="n">stBackwardMotorEPS</span><span class="o">.</span><span class="n">sMessage</span> <span class="o">:=</span> <span class="n">aEPSLimits</span><span class="p">[</span><span class="n">nEPSIndex</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">sMessage</span><span class="p">;</span>
    <span class="n">stForwardMotorEPS</span><span class="o">.</span><span class="n">sMessage</span> <span class="o">:=</span> <span class="n">aEPSLimits</span><span class="p">[</span><span class="n">nEPSIndex</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">sMessage</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">bEPS_Override</span> <span class="n">THEN</span>
    <span class="n">stBackwardMotorEPS</span><span class="o">.</span><span class="n">bEPS_OK</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stForwardMotorEPS</span><span class="o">.</span><span class="n">bEPS_OK</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">nPreviousState</span> <span class="o">:=</span> <span class="n">nEPSIndex</span><span class="p">;</span> <span class="o">//</span> <span class="n">Update</span> <span class="n">Previous</span> <span class="n">State</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#st-epslimits">ST_EPSLimits</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-dpx">
<h2>FB_DPX<a class="headerlink" href="#fb-dpx" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_DPX</span>

<span class="n">VAR_IN_OUT</span>
    <span class="o">//</span> <span class="n">Motor</span> <span class="n">to</span> <span class="n">apply</span> <span class="n">states</span> <span class="n">to</span>
    <span class="n">stMotionStage</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Information</span> <span class="n">about</span> <span class="n">the</span> <span class="n">park</span> <span class="n">position</span>
    <span class="n">stPark</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Information</span> <span class="n">about</span> <span class="n">the</span> <span class="n">center</span> <span class="n">parameter</span>
    <span class="n">stCenter</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Information</span> <span class="n">about</span> <span class="n">the</span> <span class="n">knife</span> <span class="n">edge</span> <span class="n">parameter</span>
    <span class="n">stKnife</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="o">//</span> <span class="n">If</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">the</span> <span class="n">motor</span> <span class="n">will</span> <span class="n">be</span> <span class="n">moved</span> <span class="n">when</span> <span class="n">enumSet</span> <span class="ow">is</span> <span class="n">changed</span>
    <span class="n">bEnable</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">When</span> <span class="n">changed</span><span class="p">,</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">destination</span> <span class="ow">and</span> <span class="n">starts</span> <span class="n">a</span> <span class="n">move</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">SET</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">enumSet</span><span class="p">:</span> <span class="n">ENUM_DPX</span><span class="p">;</span>
    <span class="n">bOverride</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Override</span> <span class="k">for</span> <span class="n">state</span> <span class="n">locking</span><span class="o">.</span> <span class="n">If</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">lock</span> <span class="n">states</span><span class="o">.</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="o">//</span> <span class="n">If</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">we</span> <span class="n">are</span> <span class="ow">in</span> <span class="n">an</span> <span class="n">error</span> <span class="n">state</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">pragma</span> <span class="n">these</span><span class="p">,</span> <span class="n">already</span> <span class="n">has</span> <span class="n">pragma</span> <span class="ow">in</span> <span class="n">manager</span>
    <span class="o">//</span> <span class="n">Error</span> <span class="n">code</span>
    <span class="n">nErrorId</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Message</span> <span class="n">associated</span> <span class="k">with</span> <span class="n">bError</span> <span class="o">=</span> <span class="n">TRUE</span>
    <span class="n">sErrorMessage</span><span class="p">:</span> <span class="n">STRING</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">If</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">we</span> <span class="n">are</span> <span class="n">currently</span> <span class="n">moving</span> <span class="n">between</span> <span class="n">states</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">If</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">we</span> <span class="n">asked</span> <span class="k">for</span> <span class="n">a</span> <span class="n">move</span> <span class="n">between</span> <span class="n">states</span><span class="p">,</span> <span class="n">it</span> <span class="n">completed</span> <span class="n">successfully</span><span class="p">,</span> <span class="ow">and</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">ongoing</span> <span class="n">move</span>
    <span class="n">bDone</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">current</span> <span class="n">state</span> <span class="n">readback</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GET</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">enumGet</span><span class="p">:</span> <span class="n">ENUM_DPX</span><span class="p">;</span> <span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">Please</span> <span class="n">copy</span> <span class="n">this</span> <span class="n">pragma</span> <span class="n">exactly</span> <span class="n">on</span> <span class="n">your</span> <span class="n">enumGet</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">arrStates</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..15</span><span class="p">]</span> <span class="n">OF</span> <span class="n">DUT_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbStateManager</span><span class="p">:</span> <span class="n">FB_PositionStateManager</span><span class="p">;</span> <span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">Please</span> <span class="n">copy</span> <span class="n">this</span> <span class="n">pragma</span> <span class="n">exactly</span> <span class="n">to</span> <span class="n">pick</span> <span class="n">up</span> <span class="n">the</span> <span class="n">standard</span> <span class="n">PVs</span>
    <span class="n">fbLockPark</span><span class="p">:</span>     <span class="n">FB_PositionStateLock</span><span class="p">;</span>
    <span class="n">fbLockCenter</span><span class="p">:</span>   <span class="n">FB_PositionStateLock</span><span class="p">;</span>
    <span class="n">fbLockKnife</span><span class="p">:</span>    <span class="n">FB_PositionStateLock</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Fist</span> <span class="n">cycle</span> <span class="n">setup</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">stPark</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">;</span>
    <span class="n">stCenter</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;CENTER&#39;</span><span class="p">;</span>
    <span class="n">stKnife</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;KNIFE&#39;</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">If</span> <span class="nb">any</span> <span class="n">of</span> <span class="n">these</span> <span class="n">have</span> <span class="n">bLocked</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">allow</span> <span class="n">user</span> <span class="n">to</span> <span class="n">change</span> <span class="n">them</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">bOverride</span> <span class="n">THEN</span>
    <span class="n">fbLockPark</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stPark</span><span class="p">);</span>
    <span class="n">fbLockCenter</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stCenter</span><span class="p">);</span>
    <span class="n">fbLockKnife</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stKnife</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Stuff</span> <span class="n">values</span> <span class="n">into</span> <span class="n">the</span> <span class="mi">15</span> <span class="n">element</span> <span class="n">array</span> <span class="k">for</span> <span class="n">the</span> <span class="n">manager</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stPark</span><span class="p">;</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stCenter</span><span class="p">;</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stKnife</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Call</span> <span class="n">the</span> <span class="n">function</span> <span class="n">block</span> <span class="n">every</span> <span class="n">cycle</span>
<span class="n">fbStateManager</span><span class="p">(</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="p">,</span>
    <span class="n">arrStates</span> <span class="o">:=</span> <span class="n">arrStates</span><span class="p">,</span>
    <span class="n">setState</span> <span class="o">:=</span> <span class="n">enumSet</span><span class="p">,</span>
    <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">bEnable</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">bError</span><span class="p">,</span>
    <span class="n">nErrorId</span> <span class="o">=&gt;</span> <span class="n">nErrorId</span><span class="p">,</span>
    <span class="n">sErrorMessage</span> <span class="o">=&gt;</span> <span class="n">sErrorMessage</span><span class="p">,</span>
    <span class="n">bBusy</span> <span class="o">=&gt;</span> <span class="n">bBusy</span><span class="p">,</span>
    <span class="n">bDone</span> <span class="o">=&gt;</span> <span class="n">bDone</span><span class="p">,</span>
    <span class="n">getState</span> <span class="o">=&gt;</span> <span class="n">enumGet</span><span class="p">);</span> <span class="o">//</span> <span class="n">Cannot</span> <span class="n">do</span> <span class="n">this</span> <span class="n">assignment</span> <span class="k">if</span> <span class="n">enumGet</span> <span class="n">has</span> <span class="n">attribute</span> <span class="n">strict</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#enum-dpx">ENUM_DPX</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-queue">
<h2>FB_Queue<a class="headerlink" href="#fb-queue" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_Queue</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stQ</span> <span class="p">:</span> <span class="n">ST_Queue</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>


<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">METHOD</span> <span class="n">PUBLIC</span> <span class="n">Dequeue</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span>
<span class="n">VAR_INPUT</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">THIS</span><span class="o">^.</span><span class="n">Queue_Is_Empty</span><span class="p">()</span> <span class="n">THEN</span>
    <span class="n">Dequeue</span> <span class="o">:=</span> <span class="n">stQ</span><span class="o">.</span><span class="n">arrQueue</span><span class="p">[</span><span class="n">stQ</span><span class="o">.</span><span class="n">iFront</span><span class="p">];</span>
    <span class="n">stQ</span><span class="o">.</span><span class="n">iFront</span> <span class="o">:=</span> <span class="n">stQ</span><span class="o">.</span><span class="n">iFront</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">stQ</span><span class="o">.</span><span class="n">iCount</span> <span class="o">:=</span> <span class="n">stQ</span><span class="o">.</span><span class="n">iCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">Empty_Queue</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Reset</span> <span class="n">queue</span> <span class="n">to</span> <span class="n">ST_Queue</span> <span class="n">initial</span> <span class="n">values</span>
<span class="n">stQ</span><span class="o">.</span><span class="n">iCount</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">stQ</span><span class="o">.</span><span class="n">iBack</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="n">stQ</span><span class="o">.</span><span class="n">iFront</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PUBLIC</span> <span class="n">Enqueue</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">element</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span>  <span class="n">NOT</span> <span class="n">THIS</span><span class="o">^.</span><span class="n">Queue_Is_Full</span><span class="p">()</span> <span class="n">THEN</span>
    <span class="n">IF</span> <span class="n">stQ</span><span class="o">.</span><span class="n">iBack</span> <span class="o">=</span> <span class="n">stQ</span><span class="o">.</span><span class="n">iLength</span> <span class="n">THEN</span>
        <span class="n">stQ</span><span class="o">.</span><span class="n">iBack</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="n">stQ</span><span class="o">.</span><span class="n">iBack</span> <span class="o">:=</span> <span class="n">stQ</span><span class="o">.</span><span class="n">iBack</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">stQ</span><span class="o">.</span><span class="n">arrQueue</span><span class="p">[</span><span class="n">stQ</span><span class="o">.</span><span class="n">iBack</span><span class="p">]</span> <span class="o">:=</span> <span class="n">element</span><span class="p">;</span>
    <span class="n">stQ</span><span class="o">.</span><span class="n">iCount</span> <span class="o">:=</span> <span class="n">stQ</span><span class="o">.</span><span class="n">iCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">Enqueue</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">Enqueue</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">Queue_Is_Empty</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">stQ</span><span class="o">.</span><span class="n">iCount</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">THEN</span>
    <span class="n">Queue_Is_Empty</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">Queue_Is_Empty</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">Queue_Is_Full</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">stQ</span><span class="o">.</span><span class="n">iCount</span> <span class="o">=</span> <span class="n">stQ</span><span class="o">.</span><span class="n">iLength</span> <span class="n">THEN</span>
    <span class="n">Queue_Is_Full</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">Queue_Is_Full</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#st-bfsassemblystate">ST_BFSAssemblyState</a></p></li>
<li><p><a class="reference internal" href="#st-queue">ST_Queue</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-rci-analog-input">
<h2>FB_RCI_Analog_Input<a class="headerlink" href="#fb-rci-analog-input" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_RCI_Analog_Input</span>
<span class="n">VAR_INPUT</span>
    <span class="o">//</span> <span class="n">Connect</span> <span class="n">this</span> <span class="nb">input</span> <span class="n">to</span> <span class="n">the</span> <span class="n">terminal</span>
    <span class="n">iRaw</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">INT</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">bits</span> <span class="n">correlated</span> <span class="k">with</span> <span class="n">the</span> <span class="n">terminal</span><span class="s1">&#39;s max value. This is not necessarily the resolution parameter.</span>
    <span class="n">iTermBits</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">fReal</span> <span class="n">value</span> <span class="n">correlated</span> <span class="k">with</span> <span class="n">the</span> <span class="n">terminal</span><span class="s1">&#39;s max value</span>
    <span class="n">fTermMax</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">fReal</span> <span class="n">value</span> <span class="n">correlated</span> <span class="k">with</span> <span class="n">the</span> <span class="n">terminal</span><span class="s1">&#39;s min value</span>
    <span class="n">fTermMin</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">real</span> <span class="n">value</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">output</span>
    <span class="n">fReal</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fScale</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">fScale</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">AND</span> <span class="n">fTermMax</span> <span class="o">&gt;</span> <span class="n">fTermMin</span> <span class="n">THEN</span>
    <span class="n">fScale</span> <span class="o">:=</span> <span class="p">(</span><span class="n">EXPT</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">iTermBits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">fTermMax</span> <span class="o">-</span> <span class="n">fTermMin</span><span class="p">);</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="n">fScale</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span> <span class="n">THEN</span>
    <span class="n">fReal</span> <span class="o">:=</span> <span class="n">iRaw</span> <span class="o">/</span> <span class="p">(</span><span class="n">fScale</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-rci-analog-output">
<h2>FB_RCI_Analog_Output<a class="headerlink" href="#fb-rci-analog-output" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_RCI_Analog_Output</span>
<span class="n">VAR_INPUT</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">real</span> <span class="n">value</span> <span class="n">to</span> <span class="n">send</span> <span class="n">to</span> <span class="n">the</span> <span class="n">output</span>
    <span class="n">fReal</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">maximum</span> <span class="n">allowed</span> <span class="n">real</span> <span class="n">value</span> <span class="k">for</span> <span class="n">the</span> <span class="n">connected</span> <span class="n">hardware</span>
    <span class="n">fSafeMax</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">minimum</span> <span class="n">allowed</span> <span class="n">real</span> <span class="n">value</span> <span class="k">for</span> <span class="n">the</span> <span class="n">connected</span> <span class="n">hardware</span>
    <span class="n">fSafeMin</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">bits</span> <span class="n">correlated</span> <span class="k">with</span> <span class="n">the</span> <span class="n">terminal</span><span class="s1">&#39;s max output. This is not necessarily the resolution parameter.</span>
    <span class="n">iTermBits</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">fReal</span> <span class="n">value</span> <span class="n">correlated</span> <span class="k">with</span> <span class="n">the</span> <span class="n">terminal</span><span class="s1">&#39;s max output</span>
    <span class="n">fTermMax</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">fReal</span> <span class="n">value</span> <span class="n">correlated</span> <span class="k">with</span> <span class="n">the</span> <span class="n">terminal</span><span class="s1">&#39;s min output</span>
    <span class="n">fTermMin</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="o">//</span> <span class="n">Connect</span> <span class="n">this</span> <span class="n">output</span> <span class="n">to</span> <span class="n">the</span> <span class="n">terminal</span>
    <span class="n">iRaw</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">INT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fScale</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">scaling</span> <span class="kn">from</span> <span class="nn">real</span> <span class="n">to</span> <span class="n">raw</span>
<span class="n">IF</span> <span class="n">fScale</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">AND</span> <span class="n">fTermMax</span> <span class="o">&gt;</span> <span class="n">fTermMin</span> <span class="n">THEN</span>
    <span class="n">fScale</span> <span class="o">:=</span> <span class="p">(</span><span class="n">EXPT</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">iTermBits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">fTermMax</span> <span class="o">-</span> <span class="n">fTermMin</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Adjust</span> <span class="n">real</span> <span class="n">value</span> <span class="n">to</span> <span class="n">be</span> <span class="n">within</span> <span class="n">the</span> <span class="n">limits</span>
<span class="n">fReal</span> <span class="o">:=</span> <span class="n">MIN</span><span class="p">(</span><span class="n">fReal</span><span class="p">,</span> <span class="n">fSafeMax</span><span class="p">,</span> <span class="n">fTermMax</span><span class="p">);</span>
<span class="n">fReal</span> <span class="o">:=</span> <span class="n">MAX</span><span class="p">(</span><span class="n">fReal</span><span class="p">,</span> <span class="n">fSafeMin</span><span class="p">,</span> <span class="n">fTermMin</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Scale</span> <span class="n">the</span> <span class="n">output</span> <span class="n">accordingly</span>
<span class="n">iRaw</span> <span class="o">:=</span> <span class="n">LREAL_TO_INT</span><span class="p">((</span><span class="n">fReal</span><span class="p">)</span> <span class="o">*</span> <span class="n">fScale</span><span class="p">);</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-resttimer">
<h2>FB_RestTimer<a class="headerlink" href="#fb-resttimer" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_RestTimer</span>
<span class="o">//</span> <span class="n">Resets</span> <span class="n">value</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">after</span> <span class="n">some</span> <span class="n">time</span>
<span class="o">//</span> <span class="n">bInput</span>   <span class="p">:</span> <span class="n">Value</span> <span class="n">that</span> <span class="n">will</span> <span class="n">reset</span> <span class="n">when</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">true</span> <span class="n">after</span> <span class="n">some</span> <span class="n">time</span> <span class="n">passes</span>
<span class="o">//</span> <span class="n">tCountdown</span> <span class="p">:</span> <span class="n">count</span> <span class="n">down</span> <span class="n">when</span> <span class="nb">input</span> <span class="n">will</span> <span class="n">be</span> <span class="n">rest</span>
<span class="o">//</span> <span class="n">tElapseTime</span> <span class="p">:</span> <span class="n">Time</span> <span class="n">before</span> <span class="nb">input</span> <span class="ow">is</span> <span class="n">reset</span>

<span class="n">VAR_IN_OUT</span>
    <span class="n">bInput</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">tCountDown</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="n">tElapseTime</span> <span class="p">:</span> <span class="n">TIME</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbTimer</span> <span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">fbTimer</span><span class="p">(</span><span class="n">IN</span> <span class="o">:=</span> <span class="n">bInput</span><span class="p">,</span> <span class="n">PT</span><span class="o">:=</span> <span class="n">tElapseTime</span><span class="p">);</span>

<span class="n">IF</span> <span class="n">bInput</span> <span class="n">THEN</span>
    <span class="n">tCountDown</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">tElapseTime</span> <span class="o">-</span> <span class="n">fbTimer</span><span class="o">.</span><span class="n">ET</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">fbTimer</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">bInput</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">tCountDown</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">T</span><span class="c1">#0s);</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-slits">
<h2>FB_SLITS<a class="headerlink" href="#fb-slits" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_SLITS</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stTopBlade</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stNorthBlade</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stSouthBlade</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span><span class="n">BOOL</span> <span class="p">;</span>
    <span class="n">io_fbFFHWO</span>    <span class="p">:</span>    <span class="n">FB_HardwareFFOutput</span><span class="p">;</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">();</span>
<span class="n">END_VAR</span>

<span class="n">VAR_INPUT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PMPS_OK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveOk</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

        <span class="p">(</span><span class="o">*</span><span class="n">Offsets</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Offset_Top</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetTop</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Bottom</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetBottom</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_North</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetNorth</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_South</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetSouth</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">i_DevName</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span> <span class="o">//</span><span class="n">device</span> <span class="n">name</span> <span class="k">for</span> <span class="n">FFO</span> <span class="ow">and</span> <span class="n">PMPS</span> <span class="n">diagnostics</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Home</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHome</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
    <span class="n">fbTopBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbBottomBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbNorthBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbSouthBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fPosTopBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosBottomBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosNorthBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosSouthBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Motion</span> <span class="n">Parameters</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fSmallDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="n">fBigDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">fMaxVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.2</span><span class="p">;</span>
    <span class="n">fHighAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.8</span><span class="p">;</span>
    <span class="n">fLowAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">stTop</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stBOTTOM</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stNorth</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stSouth</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: TOP&#39;</span><span class="p">}</span>
    <span class="n">fbTop</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: BOTTOM&#39;</span><span class="p">}</span>
    <span class="n">fbBottom</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: NORTH&#39;</span><span class="p">}</span>
    <span class="n">fbNorth</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: SOUTH&#39;</span><span class="p">}</span>
    <span class="n">fbSouth</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">EPICS</span> <span class="n">pvs</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">XWID_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqApertureSizeX</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">YWID_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqApertureSizeY</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">XCEN_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqCenterX</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">YCEN_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqCenterY</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_XWIDTH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActApertureSizeX</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_YWIDTH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActApertureSizeY</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_XCENTER</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActCenterX</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_YCENTER</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActCenterY</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">XCEN_SETZERO</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rSetCenterX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">YCEN_SETZERO</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rSetCenterY</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">OPEN</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bOpen</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">CLOSE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bClose</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">BLOCK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bBlock</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_READY</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeReady</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>


        <span class="o">//</span><span class="n">Local</span> <span class="n">variables</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">true</span><span class="p">;</span>
    <span class="n">rTrig_Block</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Open</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Close</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="o">//</span><span class="n">old</span> <span class="n">values</span>
    <span class="n">rOldReqApertureSizeX</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqApertureSizeY</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqCenterX</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqCenterY</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">bExecuteMotionX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecuteMotionY</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="n">fPosBlock</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosClose</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosOpen</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">stSetPositionOptions</span><span class="p">:</span><span class="n">ST_SetPositionOptions</span><span class="p">;</span>
    <span class="n">fbSetPosition_TOP</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Bottom</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_North</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_South</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">For</span> <span class="n">logging</span>
    <span class="n">fbLogger</span> <span class="p">:</span> <span class="n">FB_LogMessage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">eSubsystem</span><span class="o">:=</span><span class="n">E_SubSystem</span><span class="o">.</span><span class="n">MOTION</span><span class="p">);</span>
    <span class="n">tErrorPresent</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tAction</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tOverrideActivated</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
        <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;Slits&#39;</span><span class="p">,</span>
        <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when center is greated than that requested&#39;</span><span class="p">,</span>
        <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#1010);</span>


    <span class="n">bTest</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">AptArrayStatus</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
    <span class="n">AptArrayReq</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">ACT_init</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">ACT_Motion</span><span class="p">();</span>
<span class="o">//</span><span class="n">SET</span> <span class="ow">and</span> <span class="n">GET</span> <span class="n">the</span> <span class="n">requested</span> <span class="ow">and</span> <span class="n">Actual</span> <span class="n">values</span>
<span class="n">ACT_CalculatePositions</span><span class="p">();</span>
<span class="o">//</span><span class="n">ACT_BLOCK</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_BLOCK</span><span class="p">:</span>
<span class="n">rTrig_Block</span> <span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bBlock</span><span class="p">);</span>
<span class="n">rTrig_Open</span> <span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bOpen</span><span class="p">);</span>
<span class="n">rTrig_Close</span> <span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bClose</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rTrig_Block</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="o">//</span><span class="n">BLOCK</span>

    <span class="n">bBlock</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rTrig_Open</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>


    <span class="n">bOpen</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rTrig_Close</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>


    <span class="n">bClose</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_CalculatePositions</span><span class="p">:</span>
<span class="o">//</span><span class="n">check</span> <span class="k">if</span> <span class="n">requested</span> <span class="n">center</span> <span class="ow">or</span> <span class="n">gap</span> <span class="n">has</span> <span class="n">changed</span>
<span class="o">//</span><span class="n">check</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">values</span> <span class="n">are</span> <span class="n">within</span> <span class="n">acceptable</span> <span class="n">motion</span> <span class="nb">range</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqApertureSizeX</span> <span class="o">&lt;&gt;</span> <span class="n">rReqApertureSizeX</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqApertureSizeX</span> <span class="o">:=</span> <span class="n">rReqApertureSizeX</span><span class="p">;</span>
        <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new X gap.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqCenterX</span> <span class="o">&lt;&gt;</span> <span class="n">rReqCenterX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqCenterX</span> <span class="o">:=</span> <span class="n">rReqCenterX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new X center&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
   <span class="o">//</span> <span class="n">ELSE</span>
      <span class="o">//</span>  <span class="n">rReqCenterX</span> <span class="o">:=</span> <span class="n">rActCenterX</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqApertureSizeY</span> <span class="o">&lt;&gt;</span> <span class="n">rReqApertureSizeY</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqApertureSizeY</span> <span class="o">:=</span> <span class="n">rReqApertureSizeY</span><span class="p">;</span>
        <span class="n">bExecuteMotionY</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Y gap.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>

<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqCenterY</span> <span class="o">&lt;&gt;</span> <span class="n">rReqCenterY</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqCenterY</span> <span class="o">:=</span> <span class="n">rReqCenterY</span><span class="p">;</span>
    <span class="n">bExecuteMotionY</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Y center.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
   <span class="o">//</span> <span class="n">ELSE</span>
      <span class="o">//</span>  <span class="n">rReqCenterY</span> <span class="o">:=</span> <span class="n">rActCenterY</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">requested</span> <span class="n">target</span> <span class="n">positions</span> <span class="kn">from</span> <span class="nn">requested</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span>
<span class="n">fPosTopBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="n">rReqApertureSizeY</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterY</span> <span class="o">+</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="p">;</span>
<span class="n">fPosBottomBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">rReqApertureSizeY</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterY</span><span class="o">+</span><span class="n">rEncoderOffsetBottom</span><span class="p">);</span>

<span class="n">fPosNorthBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="n">rReqApertureSizeX</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterX</span> <span class="o">+</span> <span class="n">rEncoderOffsetNorth</span><span class="p">);</span>
<span class="n">fPosSouthBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">rReqApertureSizeX</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterX</span> <span class="o">+</span> <span class="n">rEncoderOffsetSouth</span><span class="p">);</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">actual</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span> <span class="kn">from</span> <span class="nn">actual</span> <span class="n">stages</span> <span class="n">positions</span>
<span class="n">rActApertureSizeX</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((</span><span class="n">stNorthBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetNorth</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stSouthBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="o">-</span> <span class="n">rEncoderOffsetSouth</span><span class="p">));</span>

<span class="n">rActApertureSizeY</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((</span><span class="n">stTopBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stBottomBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetBottom</span><span class="p">));</span>

<span class="n">rActCenterX</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((((</span><span class="n">stNorthBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetNorth</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="n">stSouthBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetSouth</span> <span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>

<span class="n">rActCenterY</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((((</span><span class="n">stTopBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">stBottomBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetBottom</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>



<span class="o">//</span><span class="n">Update</span> <span class="n">PMPS</span> <span class="n">Arbiter</span> <span class="k">with</span> <span class="n">the</span> <span class="n">Actual</span> <span class="n">Size</span> <span class="ow">and</span> <span class="n">Center</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Aperture</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Home</span><span class="p">:</span>

<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Init</span><span class="p">:</span>
<span class="o">//</span>  <span class="n">init</span> <span class="n">the</span> <span class="n">motion</span> <span class="n">stages</span> <span class="n">parameters</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stNorthBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSouthBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stNorthBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSouthBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stTopBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stNorthBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stSouthBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">FFO</span><span class="o">.</span><span class="n">i_DevName</span> <span class="o">:=</span> <span class="n">i_DevName</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Motion</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">fbTopBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stTopBlade</span><span class="p">);</span>
<span class="n">fbBottomBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stBottomBlade</span><span class="p">);</span>
<span class="n">fbNorthBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stNorthBlade</span><span class="p">);</span>
<span class="n">fbSouthBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSouthBlade</span><span class="p">);</span>

<span class="o">//</span> <span class="n">PTP</span> <span class="n">Motion</span> <span class="k">for</span> <span class="n">each</span> <span class="n">blade</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Top&#39;</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosTopBlade</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Bottom&#39;</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosBottomBlade</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stNorth</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;North&#39;</span><span class="p">;</span>
<span class="n">stNorth</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosNorthBlade</span><span class="p">;</span>
<span class="n">stNorth</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stNorth</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stNorth</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stNorth</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stSouth</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;South&#39;</span><span class="p">;</span>
<span class="n">stSouth</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosSouthBlade</span><span class="p">;</span>
<span class="n">stSouth</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stSouth</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stSouth</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stSouth</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionY</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbTop</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbBottom</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionY</span><span class="p">;</span>
    <span class="n">bExecuteMotionY</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbNorth</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbSouth</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">fbTop</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stTop</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stTopBlade</span><span class="p">);</span>

<span class="n">fbBottom</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stBOTTOM</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stBottomBlade</span><span class="p">);</span>

<span class="n">fbNorth</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stNorth</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stNorthBlade</span><span class="p">);</span>

<span class="n">fbSouth</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSouth</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSouthBlade</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Zero</span><span class="p">:</span>
<span class="o">//</span><span class="n">ZERO</span> <span class="n">BIAS</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">Y</span> <span class="n">center</span> <span class="n">to</span> <span class="n">zero</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">X</span> <span class="n">center</span> <span class="n">to</span> <span class="n">zero</span>
<span class="p">(</span><span class="o">*</span>
<span class="k">if</span> <span class="p">(</span><span class="n">rSetCenterY</span><span class="p">)</span><span class="n">THEN</span>
        <span class="n">rSetCenterY</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
        <span class="o">//</span> <span class="n">Set</span> <span class="n">Current</span> <span class="n">Position</span>
        <span class="n">fbSetPosition_TOP</span><span class="o">.</span><span class="n">Position</span> <span class="o">:=</span>  <span class="n">stTopBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rActCenterY</span> <span class="p">;</span>
        <span class="n">fbSetPosition_TOP</span><span class="o">.</span><span class="n">Execute</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbSetPosition_Bottom</span><span class="o">.</span><span class="n">Position</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rActCenterY</span><span class="p">;</span>
        <span class="n">fbSetPosition_Bottom</span><span class="o">.</span><span class="n">Execute</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rSetCenterX</span><span class="p">)</span><span class="n">THEN</span>
        <span class="n">rSetCenterX</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
        <span class="o">//</span> <span class="n">Set</span> <span class="n">Current</span> <span class="n">Position</span>
        <span class="n">fbSetPosition_North</span><span class="o">.</span><span class="n">Position</span> <span class="o">:=</span> <span class="n">stNorthBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rActCenterX</span> <span class="p">;</span>
        <span class="n">fbSetPosition_North</span><span class="o">.</span><span class="n">Execute</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbSetPosition_South</span><span class="o">.</span><span class="n">Position</span> <span class="o">:=</span> <span class="n">stSouthBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rActCenterX</span> <span class="p">;</span> <span class="p">;</span>
        <span class="n">fbSetPosition_South</span><span class="o">.</span><span class="n">Execute</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Reset</span>
<span class="k">if</span> <span class="p">(</span><span class="n">fbSetPosition_TOP</span><span class="o">.</span><span class="n">Done</span> <span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbSetPosition_TOP</span><span class="o">.</span><span class="n">Execute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="k">if</span> <span class="p">(</span><span class="n">fbSetPosition_Bottom</span><span class="o">.</span><span class="n">Done</span> <span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbSetPosition_Bottom</span><span class="o">.</span><span class="n">Execute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="k">if</span> <span class="p">(</span><span class="n">fbSetPosition_North</span><span class="o">.</span><span class="n">Done</span> <span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbSetPosition_North</span><span class="o">.</span><span class="n">Execute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="k">if</span> <span class="p">(</span><span class="n">fbSetPosition_South</span><span class="o">.</span><span class="n">Done</span> <span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbSetPosition_South</span><span class="o">.</span><span class="n">Execute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">Encoder</span> <span class="n">Position</span>
<span class="o">//</span><span class="n">Clear</span> <span class="n">position</span> <span class="n">lag</span> <span class="n">error</span>
<span class="n">stSetPositionOptions</span><span class="o">.</span><span class="n">ClearPositionLag</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbSetPosition_TOP</span><span class="p">(</span>
    <span class="n">Axis</span><span class="o">:=</span>  <span class="n">stTopBlade</span><span class="o">.</span><span class="n">Axis</span> <span class="p">,</span>
    <span class="n">Execute</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Position</span><span class="o">:=</span> <span class="mi">0</span> <span class="p">,</span>
    <span class="n">Mode</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">,</span>
    <span class="n">Options</span><span class="o">:=</span> <span class="n">stSetPositionOptions</span><span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">fbSetPosition_Bottom</span><span class="p">(</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">Axis</span> <span class="p">,</span>
    <span class="n">Execute</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Position</span><span class="o">:=</span> <span class="mi">0</span> <span class="p">,</span>
    <span class="n">Mode</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">,</span>
    <span class="n">Options</span><span class="o">:=</span> <span class="n">stSetPositionOptions</span><span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">fbSetPosition_North</span><span class="p">(</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">stNorthBlade</span><span class="o">.</span><span class="n">Axis</span> <span class="p">,</span>
    <span class="n">Execute</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Position</span><span class="o">:=</span> <span class="mi">0</span> <span class="p">,</span>
    <span class="n">Mode</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">,</span>
    <span class="n">Options</span><span class="o">:=</span> <span class="n">stSetPositionOptions</span><span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">fbSetPosition_South</span><span class="p">(</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">stSouthBlade</span><span class="o">.</span><span class="n">Axis</span> <span class="p">,</span>
    <span class="n">Execute</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">Position</span><span class="o">:=</span> <span class="mi">0</span> <span class="p">,</span>
    <span class="n">Mode</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">,</span>
    <span class="n">Options</span><span class="o">:=</span> <span class="n">stSetPositionOptions</span><span class="p">,</span>
    <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

    <span class="o">*</span><span class="p">)</span>
<span class="n">END_ACTION</span>

<span class="n">METHOD</span> <span class="n">M_CheckPMPS</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
     <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span><span class="p">(</span><span class="n">rActApertureSizeX</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">Width</span><span class="p">)</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="n">OR</span> <span class="p">(</span><span class="n">rActApertureSizeY</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">Height</span><span class="p">)</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">FFO</span><span class="o">.</span><span class="n">i_xOK</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">ELSE</span>
        <span class="n">FFO</span><span class="o">.</span><span class="n">i_xOK</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*</span><span class="n">FAST</span> <span class="n">FAULT</span><span class="o">*</span><span class="p">)</span>
<span class="n">FFO</span><span class="p">(</span><span class="n">i_xOK</span> <span class="o">:=</span> <span class="p">,</span>
    <span class="n">i_xReset</span> <span class="o">:=</span> <span class="p">,</span>
    <span class="n">i_xAutoReset</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
    <span class="n">io_fbFFHWO</span> <span class="o">:=</span> <span class="n">this</span><span class="o">^.</span><span class="n">io_fbFFHWO</span><span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">M_UpdatePMPS</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span><span class="n">Keep</span> <span class="n">updating</span> <span class="n">the</span> <span class="n">status</span> <span class="n">of</span> <span class="n">the</span> <span class="n">apertures</span> <span class="n">PMPS</span>
<span class="n">This</span><span class="o">^.</span><span class="n">AptArrayStatus</span><span class="o">.</span><span class="n">Height</span> <span class="o">:=</span> <span class="n">This</span><span class="o">^.</span><span class="n">rActApertureSizeY</span><span class="p">;</span>
<span class="n">This</span><span class="o">^.</span><span class="n">AptArrayStatus</span><span class="o">.</span><span class="n">Width</span> <span class="o">:=</span> <span class="n">This</span><span class="o">^.</span><span class="n">rActApertureSizeX</span><span class="p">;</span>
<span class="n">This</span><span class="o">^.</span><span class="n">AptArrayStatus</span><span class="o">.</span><span class="n">xOK</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">This</span><span class="o">^.</span><span class="n">stTopBlade</span><span class="o">.</span><span class="n">bError</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">This</span><span class="o">^.</span><span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bError</span><span class="p">)</span>
                                 <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">This</span><span class="o">^.</span><span class="n">stNorthBlade</span><span class="o">.</span><span class="n">bError</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">This</span><span class="o">^.</span><span class="n">stNorthBlade</span><span class="o">.</span><span class="n">bError</span><span class="p">);</span>

<span class="o">//</span><span class="n">Evaluate</span> <span class="n">that</span> <span class="n">the</span> <span class="n">current</span> <span class="n">center</span> <span class="n">on</span> <span class="n">the</span> <span class="n">X</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">y</span> <span class="n">direction</span> <span class="n">didn</span><span class="s1">&#39;t exceed limits</span>
<span class="o">//</span><span class="n">Fast</span> <span class="n">fault</span> <span class="n">when</span> <span class="n">it</span> <span class="n">does</span><span class="o">.</span>
<span class="n">IF</span><span class="p">(</span><span class="n">rActCenterX</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">Width</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">OR</span> <span class="p">(</span><span class="n">rActCenterY</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">Height</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="n">THEN</span>
        <span class="n">FFO</span><span class="o">.</span><span class="n">i_xOK</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">ELSE</span>
        <span class="n">FFO</span><span class="o">.</span><span class="n">i_xOK</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Evaluate</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">gaps</span> <span class="n">on</span> <span class="n">the</span> <span class="n">X</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">y</span> <span class="n">direction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">larger</span> <span class="n">than</span> <span class="n">the</span> <span class="n">current</span> <span class="n">gap</span>
<span class="o">//</span> <span class="n">narrow</span>  <span class="n">the</span> <span class="n">gap</span> <span class="k">if</span> <span class="n">the</span> <span class="n">requested</span> <span class="ow">is</span> <span class="n">larger</span>
<span class="n">IF</span><span class="p">(</span><span class="n">bTest</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">This</span><span class="o">^.</span><span class="n">rActApertureSizeX</span> <span class="o">&gt;</span> <span class="n">AptArrayReq</span><span class="o">.</span><span class="n">Width</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rReqApertureSizeX</span> <span class="o">:=</span> <span class="n">AptArrayReq</span><span class="o">.</span><span class="n">Width</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">This</span><span class="o">^.</span><span class="n">rActApertureSizeY</span> <span class="o">&gt;</span> <span class="n">AptArrayReq</span><span class="o">.</span><span class="n">Height</span><span class="p">)</span> <span class="n">THEN</span>
         <span class="n">rReqApertureSizeY</span> <span class="o">:=</span> <span class="n">AptArrayReq</span><span class="o">.</span><span class="n">Height</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>


<span class="p">(</span><span class="o">*</span><span class="n">FAST</span> <span class="n">FAULT</span><span class="o">*</span><span class="p">)</span>
<span class="n">FFO</span><span class="p">(</span><span class="n">i_xOK</span> <span class="o">:=</span> <span class="p">,</span>
    <span class="n">i_xReset</span> <span class="o">:=</span> <span class="p">,</span>
    <span class="n">i_xAutoReset</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
    <span class="n">io_fbFFHWO</span> <span class="o">:=</span> <span class="n">io_fbFFHWO</span><span class="p">);</span>
<span class="n">END_METHOD</span>
</pre></div>
</div>
</section>
<section id="fb-slits-power">
<h2>FB_SLITS_POWER<a class="headerlink" href="#fb-slits-power" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_SLITS_POWER</span> <span class="n">EXTENDS</span> <span class="n">FB_SLITS</span>
<span class="n">VAR_INPUT</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">FSW</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbFlowSwitch</span><span class="p">:</span> <span class="n">FB_XTES_Flowswitch</span><span class="p">;</span>



    <span class="o">//</span><span class="n">RTDs</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">TOP</span><span class="p">:</span><span class="n">RTD</span><span class="p">:</span><span class="mi">01</span>
    <span class="s1">&#39;}</span>
    <span class="n">RTD_TOP_1</span><span class="p">:</span> <span class="n">FB_TempSensor</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">TOP</span><span class="p">:</span><span class="n">RTD</span><span class="p">:</span><span class="mi">02</span>
    <span class="s1">&#39;}</span>
    <span class="n">RTD_TOP_2</span><span class="p">:</span> <span class="n">FB_TempSensor</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">BOTTOM</span><span class="p">:</span><span class="n">RTD</span><span class="p">:</span><span class="mi">01</span>
    <span class="s1">&#39;}</span>
    <span class="n">RTD_Bottom_1</span><span class="p">:</span> <span class="n">FB_TempSensor</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">BOTTOM</span><span class="p">:</span><span class="n">RTD</span><span class="p">:</span><span class="mi">02</span>
    <span class="s1">&#39;}</span>
    <span class="n">RTD_Bottom_2</span><span class="p">:</span> <span class="n">FB_TempSensor</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">NORTH</span><span class="p">:</span><span class="n">RTD</span><span class="p">:</span><span class="mi">01</span>
    <span class="s1">&#39;}</span>
    <span class="n">RTD_North_1</span><span class="p">:</span> <span class="n">FB_TempSensor</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">NORTH</span><span class="p">:</span><span class="n">RTD</span><span class="p">:</span><span class="mi">02</span>
    <span class="s1">&#39;}</span>
    <span class="n">RTD_North_2</span><span class="p">:</span> <span class="n">FB_TempSensor</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">SOUTH</span><span class="p">:</span><span class="n">RTD</span><span class="p">:</span><span class="mi">01</span>
    <span class="s1">&#39;}</span>
    <span class="n">RTD_South_1</span><span class="p">:</span> <span class="n">FB_TempSensor</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">SOUTH</span><span class="p">:</span><span class="n">RTD</span><span class="p">:</span><span class="mi">02</span>
    <span class="s1">&#39;}</span>
    <span class="n">RTD_South_2</span><span class="p">:</span> <span class="n">FB_TempSensor</span><span class="p">;</span>



<span class="n">END_VAR</span>
<span class="n">ACT_RTDs</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_CalculatePositions</span><span class="p">:</span>
<span class="o">//</span><span class="n">check</span> <span class="k">if</span> <span class="n">requested</span> <span class="n">center</span> <span class="ow">or</span> <span class="n">gap</span> <span class="n">has</span> <span class="n">changed</span>
<span class="o">//</span><span class="n">check</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">values</span> <span class="n">are</span> <span class="n">within</span> <span class="n">acceptable</span> <span class="n">motion</span> <span class="nb">range</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqApertureSizeX</span> <span class="o">&lt;&gt;</span> <span class="n">rReqApertureSizeX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">rReqApertureSizeX</span> <span class="o">&lt;=</span> <span class="n">AptArrayReq</span><span class="o">.</span><span class="n">Width</span><span class="p">)</span>  <span class="n">THEN</span>
        <span class="n">rOldReqApertureSizeX</span> <span class="o">:=</span> <span class="n">rReqApertureSizeX</span><span class="p">;</span>
        <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new X gap.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
    <span class="n">ELSE</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new X gap is larger than PMPS request.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
    <span class="n">END_IF</span>
  <span class="o">//</span>  <span class="n">ELSE</span>
    <span class="o">//</span>    <span class="n">rReqApertureSizeX</span> <span class="o">:=</span> <span class="n">rActApertureSizeX</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqCenterX</span> <span class="o">&lt;&gt;</span> <span class="n">rReqCenterX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqCenterX</span> <span class="o">:=</span> <span class="n">rReqCenterX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new X center&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
   <span class="o">//</span> <span class="n">ELSE</span>
      <span class="o">//</span>  <span class="n">rReqCenterX</span> <span class="o">:=</span> <span class="n">rActCenterX</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqApertureSizeY</span> <span class="o">&lt;&gt;</span> <span class="n">rReqApertureSizeY</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">IF</span> <span class="n">rReqApertureSizeY</span> <span class="o">&lt;=</span> <span class="n">AptArrayReq</span><span class="o">.</span><span class="n">Height</span> <span class="n">THEN</span>
        <span class="n">rOldReqApertureSizeY</span> <span class="o">:=</span> <span class="n">rReqApertureSizeY</span><span class="p">;</span>
        <span class="n">bExecuteMotionY</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Y gap.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
    <span class="n">ELSE</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Y gap is larger than PMPS request.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
    <span class="n">END_IF</span>
   <span class="o">//</span> <span class="n">ELSE</span>
       <span class="o">//</span> <span class="n">rReqApertureSizeY</span> <span class="o">:=</span> <span class="n">rActApertureSizeY</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqCenterY</span> <span class="o">&lt;&gt;</span> <span class="n">rReqCenterY</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqCenterY</span> <span class="o">:=</span> <span class="n">rReqCenterY</span><span class="p">;</span>
    <span class="n">bExecuteMotionY</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Y center.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
   <span class="o">//</span> <span class="n">ELSE</span>
      <span class="o">//</span>  <span class="n">rReqCenterY</span> <span class="o">:=</span> <span class="n">rActCenterY</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">requested</span> <span class="n">target</span> <span class="n">positions</span> <span class="kn">from</span> <span class="nn">requested</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span>
<span class="n">fPosTopBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="n">rReqApertureSizeY</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterY</span> <span class="o">+</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="p">;</span>
<span class="n">fPosBottomBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">rReqApertureSizeY</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterY</span><span class="o">+</span><span class="n">rEncoderOffsetBottom</span><span class="p">);</span>

<span class="n">fPosNorthBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="n">rReqApertureSizeX</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterX</span> <span class="o">+</span> <span class="n">rEncoderOffsetNorth</span><span class="p">);</span>
<span class="n">fPosSouthBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">rReqApertureSizeX</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterX</span> <span class="o">+</span> <span class="n">rEncoderOffsetSouth</span><span class="p">);</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">actual</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span> <span class="kn">from</span> <span class="nn">actual</span> <span class="n">stages</span> <span class="n">positions</span>
<span class="n">rActApertureSizeX</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((</span><span class="n">stNorthBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetNorth</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stSouthBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="o">-</span> <span class="n">rEncoderOffsetSouth</span><span class="p">));</span>

<span class="n">rActApertureSizeY</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((</span><span class="n">stTopBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stBottomBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetBottom</span><span class="p">));</span>

<span class="n">rActCenterX</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((((</span><span class="n">stNorthBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetNorth</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="n">stSouthBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetSouth</span> <span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>

<span class="n">rActCenterY</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((((</span><span class="n">stTopBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">stBottomBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetBottom</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>



<span class="o">//</span><span class="n">Update</span> <span class="n">PMPS</span> <span class="n">Arbiter</span> <span class="k">with</span> <span class="n">the</span> <span class="n">Actual</span> <span class="n">Size</span> <span class="ow">and</span> <span class="n">Center</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Aperture</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_RTDs</span><span class="p">:</span>
<span class="o">////</span><span class="n">RTDs</span>
<span class="n">RTD_TOP_1</span><span class="p">();</span>
<span class="n">RTD_TOP_2</span><span class="p">();</span>
<span class="n">RTD_Bottom_1</span><span class="p">();</span>
<span class="n">RTD_Bottom_2</span><span class="p">();</span>
<span class="n">RTD_North_1</span><span class="p">();</span>
<span class="n">RTD_North_2</span><span class="p">();</span>
<span class="n">RTD_South_1</span><span class="p">();</span>
<span class="n">RTD_South_2</span><span class="p">();</span>

<span class="o">//</span><span class="n">Flow</span> <span class="n">Switch</span>
<span class="n">fbFlowSwitch</span><span class="p">();</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-slits">FB_SLITS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-slits-scatter">
<h2>FB_SLITS_SCATTER<a class="headerlink" href="#fb-slits-scatter" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_SLITS_SCATTER</span> <span class="n">EXTENDS</span> <span class="n">FB_SLITS</span>
<span class="n">VAR_INPUT</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>



<span class="n">END_VAR</span>


<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-slits">FB_SLITS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-beamblock">
<h2>PRG_Beamblock<a class="headerlink" href="#prg-beamblock" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Beamblock</span>
<span class="n">VAR</span>
    <span class="n">fbBEAM_Motor_X</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbBEAM_Motor_Y</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbBEAM_Motor_Z</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbOUTCOUP_Motor_Y</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbBEAM_Motor_X</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbBEAM_Motor_Y</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbBEAM_Motor_Z</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbOUTCOUP_Motor_Y</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-bfs">
<h2>PRG_BFS<a class="headerlink" href="#prg-bfs" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_BFS</span>
<span class="n">VAR</span>
    <span class="n">arrDPTransitions</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">0..9</span><span class="p">,</span> <span class="mf">1..9</span><span class="p">]</span> <span class="n">OF</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="o">//</span> <span class="n">Note</span> <span class="n">one</span> <span class="n">more</span> <span class="n">row</span> <span class="n">than</span> <span class="n">columns</span> <span class="p">(</span><span class="n">Unknown</span> <span class="n">state</span><span class="p">)</span>
    <span class="o">//</span><span class="n">Park</span>  <span class="n">Up</span>     <span class="n">Center</span> <span class="n">Pinh</span><span class="o">.</span>  <span class="n">Diode</span>  <span class="n">Yag1</span>   <span class="n">Yag2</span>   <span class="n">Yag3</span>   <span class="n">Knife</span>
    <span class="p">[</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="o">//</span> <span class="n">Unknown</span> <span class="p">(</span><span class="n">This</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="n">included</span><span class="p">)</span>
     <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="o">//</span> <span class="n">Park</span>
     <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="o">//</span> <span class="n">Up</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Center</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Pinhole</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Diode</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Yag1</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Yag2</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Yag3</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">];</span> <span class="o">//</span> <span class="n">Knife</span>

     <span class="n">arrAdjStates</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..9</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>

     <span class="n">nStates</span> <span class="p">:</span> <span class="n">DINT</span> <span class="o">:=</span> <span class="mi">9</span><span class="p">;</span>
     <span class="n">iRootState</span> <span class="p">:</span> <span class="n">DINT</span> <span class="o">:=</span> <span class="mi">8</span><span class="p">;</span>

     <span class="n">fbAdjacent</span> <span class="p">:</span> <span class="n">FB_AdjacentStates</span><span class="p">;</span>

     <span class="n">iAdjacentStates</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>

    <span class="n">stQueue</span> <span class="p">:</span> <span class="n">ST_Queue</span><span class="p">;</span>
    <span class="n">fbQueue</span> <span class="p">:</span> <span class="n">FB_Queue</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">iResult</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">bResult</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">arrDiscovered</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..9</span><span class="p">]</span> <span class="n">OF</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="p">[</span><span class="mi">9</span><span class="p">(</span><span class="n">FALSE</span><span class="p">)];</span>

    <span class="n">arrPath</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..9</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>

    <span class="n">iCurrent</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>

    <span class="n">iTarget</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">Target</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
    <span class="n">Root</span> <span class="p">:</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>

    <span class="n">iCounter</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>

    <span class="n">fbBFS</span>   <span class="p">:</span>       <span class="n">FB_BFS</span><span class="p">;</span>

    <span class="n">arrStates</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..9</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stDPPark</span><span class="p">;</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stDPUp</span><span class="p">;</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stDPCenter</span><span class="p">;</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stDPPinhole</span><span class="p">;</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stDPDiode</span><span class="p">;</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stDPYag1</span><span class="p">;</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stDPYag2</span><span class="p">;</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stDPYag3</span><span class="p">;</span>
<span class="n">arrStates</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stDPKnife</span><span class="p">;</span>

<span class="n">Target</span> <span class="o">:=</span> <span class="n">stDPYag3</span><span class="p">;</span>
<span class="n">Root</span> <span class="o">:=</span> <span class="n">stDPPark</span><span class="p">;</span>
<span class="n">fbBFS</span><span class="p">(</span><span class="n">fbAdjacent</span><span class="o">:=</span><span class="n">fbAdjacent</span><span class="p">,</span>
      <span class="n">arrTransitions</span><span class="o">:=</span><span class="n">arrDPTransitions</span><span class="p">,</span>
      <span class="n">arrAdjStates</span><span class="o">:=</span><span class="n">arrAdjStates</span><span class="p">,</span>
      <span class="n">nAdjacentStates</span><span class="o">:=</span><span class="n">iAdjacentStates</span><span class="p">,</span>
      <span class="n">arrStates</span><span class="o">:=</span><span class="n">arrStates</span><span class="p">,</span>
      <span class="n">stQueue</span><span class="o">:=</span><span class="n">stQueue</span><span class="p">,</span>
      <span class="n">fbQueue</span><span class="o">:=</span><span class="n">fbQueue</span><span class="p">,</span>
      <span class="n">RootState</span><span class="o">:=</span><span class="n">Root</span><span class="p">,</span>
      <span class="n">arrPath</span><span class="o">:=</span><span class="n">arrPath</span><span class="p">,</span>
      <span class="n">Target</span><span class="o">:=</span><span class="n">Target</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-adjacentstates">FB_AdjacentStates</a></p></li>
<li><p><a class="reference internal" href="#fb-bfs">FB_BFS</a></p></li>
<li><p><a class="reference internal" href="#fb-queue">FB_Queue</a></p></li>
<li><p><a class="reference internal" href="#st-bfsassemblystate">ST_BFSAssemblyState</a></p></li>
<li><p><a class="reference internal" href="#st-queue">ST_Queue</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-camera">
<h2>PRG_Camera<a class="headerlink" href="#prg-camera" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Camera</span>
<span class="n">VAR</span>
    <span class="n">fbCAM_Motor_X</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbCAM_Motor_Y</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbCAM_Motor_X</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbCAM_Motor_Y</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-cryopump">
<h2>PRG_CryoPump<a class="headerlink" href="#prg-cryopump" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_CryoPump</span>
<span class="n">VAR</span>
    <span class="n">fbCryoPump_Motor_Y_10</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbCryoPump_Motor_Y_11</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>

    <span class="n">bEPS_OK_Y_10</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span><span class="n">Valve</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">Open</span> <span class="n">State</span> <span class="n">And</span> <span class="n">communication</span> <span class="n">ok</span>
    <span class="n">bEPS_OK_Y_11</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span><span class="n">Valve</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">Open</span> <span class="n">State</span> <span class="n">And</span> <span class="n">communication</span> <span class="n">ok</span>

    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Limit</span> <span class="n">switches</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[DRL02-E23 (EL7041)]^STM Status^Status^Digital input 1&#39;</span><span class="p">}</span>
    <span class="n">bLimitBackwardEnable_Y_10</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[DRL02-E21 (EL7041)]^STM Status^Status^Digital input 1&#39;</span><span class="p">}</span>
    <span class="n">bLimitBackwardEnable_Y_11</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">ETHERCAT</span> <span class="n">BRRIDGE</span> <span class="n">COM</span> <span class="n">STATUS</span><span class="o">*</span><span class="p">)</span>
    <span class="o">//</span><span class="mi">0</span><span class="p">:</span> <span class="n">Other</span> <span class="n">side</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">OP</span> <span class="n">state</span><span class="p">,</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">Error</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^SYNC Inputs^TxPDO state</span>
    <span class="s1">&#39;}</span>
    <span class="n">xEcatBridge_TxPDO_state</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="o">//</span><span class="mi">0</span><span class="p">:</span> <span class="n">External</span> <span class="n">device</span> <span class="n">connectd</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">External</span> <span class="n">device</span> <span class="ow">not</span> <span class="n">connected</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^SYNC Inputs^External device not connected</span>
    <span class="s1">&#39;}</span>
    <span class="n">xEcatBridge_External_device_not_connected</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="o">//</span><span class="mi">0</span> <span class="o">=</span> <span class="n">Data</span> <span class="n">valid</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">Data</span> <span class="n">invalid</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^WcState^WcState</span>
    <span class="s1">&#39;}</span>
    <span class="n">xEcatBridge_WcState</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="o">//</span><span class="n">Inputs</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Inputs^bCRYO_VGC_01_CLS&#39;</span><span class="p">}</span>
    <span class="n">bCRYO_VGC_01_CLS</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Inputs^bCRYO_VGC_01_OPN&#39;</span><span class="p">}</span>
    <span class="n">bCRYO_VGC_01_OPN</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Inputs^bCRYO_VGC_02_CLS&#39;</span><span class="p">}</span>
    <span class="n">bCRYO_VGC_02_CLS</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Inputs^bCRYO_VGC_02_OPN&#39;</span><span class="p">}</span>
    <span class="n">bCRYO_VGC_02_OPN</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="o">//</span><span class="n">Outputs</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Outputs^bMOTY10_IN&#39;</span><span class="p">}</span>
    <span class="n">bMOTY10_IN</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Outputs^bMOTY10_OUT&#39;</span><span class="p">}</span>
    <span class="n">bMOTY10_OUT</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Outputs^bMOTY11_IN&#39;</span><span class="p">}</span>
    <span class="n">bMOTY11_IN</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Outputs^bMOTY11_OUT&#39;</span><span class="p">}</span>
    <span class="n">bMOTY11_OUT</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span><span class="n">Linked</span> <span class="n">to</span> <span class="n">valve</span> <span class="n">state</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span><span class="n">Linked</span> <span class="n">to</span> <span class="n">valve</span> <span class="n">state</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="o">//</span><span class="n">Homing</span> <span class="n">routine</span> <span class="n">parameters</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">HIGH_LIMIT</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">HIGH_LIMIT</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbCryoPump_Motor_Y_10</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="p">);</span>
<span class="n">fbCryoPump_Motor_Y_11</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="p">);</span>

<span class="o">//</span><span class="n">Interface</span>
<span class="n">bMOTY10_IN</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">bLimitBackwardEnable_Y_10</span><span class="p">;</span>
<span class="n">bMOTY10_OUT</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">;</span>
<span class="n">bMOTY11_IN</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">bLimitBackwardEnable_Y_11</span><span class="p">;</span>
<span class="n">bMOTY11_OUT</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">;</span>
<span class="n">bEPS_OK_Y_10</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">bCRYO_VGC_01_CLS</span><span class="p">)</span> <span class="n">AND</span> <span class="n">bCRYO_VGC_01_OPN</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">xEcatBridge_External_device_not_connected</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">xEcatBridge_WcState</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">xEcatBridge_TxPDO_state</span><span class="p">);</span>
<span class="n">bEPS_OK_Y_11</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">bCRYO_VGC_02_CLS</span><span class="p">)</span> <span class="n">AND</span> <span class="n">bCRYO_VGC_02_OPN</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">xEcatBridge_External_device_not_connected</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">xEcatBridge_WcState</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">xEcatBridge_TxPDO_state</span><span class="p">);</span>


<span class="o">//</span><span class="n">Handle</span> <span class="n">EPS</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">bEPS_OK_Y_10</span> <span class="n">AND</span> <span class="n">bLimitBackwardEnable_Y_10</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">bEPS_OK_Y_11</span> <span class="n">AND</span> <span class="n">bLimitBackwardEnable_Y_11</span><span class="p">;</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-cryopumps">
<h2>PRG_Cryopumps<a class="headerlink" href="#prg-cryopumps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Cryopumps</span>
<span class="n">VAR</span>
    <span class="o">//</span> <span class="n">Motor</span> <span class="n">axes</span>
    <span class="n">stCP1Motor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stCP2Motor</span> <span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Define</span> <span class="n">axis</span> <span class="n">states</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span><span class="o">.</span> <span class="n">These</span> <span class="n">are</span> <span class="n">fed</span> <span class="n">to</span> <span class="n">a</span> <span class="n">FB_PositionState</span> <span class="n">manager</span> <span class="k">for</span> <span class="n">each</span> <span class="n">axis</span>
    <span class="o">//</span> <span class="n">Rotation</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stCP1PosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>             <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Y</span> <span class="n">axis</span> <span class="n">position</span> <span class="n">states</span>
    <span class="n">stCP2PosPark</span> <span class="p">:</span> <span class="n">DUT_PositionState</span> <span class="o">:=</span>             <span class="p">(</span><span class="n">sName</span><span class="o">:=</span> <span class="s1">&#39;PARK&#39;</span><span class="p">,</span>
                                             <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">,</span>
                                             <span class="n">fDelta</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">fVelocity</span><span class="o">:=</span><span class="mf">5.0</span><span class="p">,</span>
                                             <span class="n">fAccel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                            <span class="n">fDecel</span><span class="o">:=</span><span class="mf">1.0</span><span class="p">,</span>
                                             <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
                                             <span class="n">bLocked</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
                                             <span class="n">bValid</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>
<span class="n">END_VAR</span>


<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</section>
<section id="prg-cryostat">
<h2>PRG_CryoStat<a class="headerlink" href="#prg-cryostat" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_CryoStat</span>
<span class="n">VAR</span>
    <span class="n">fbCRYO_Motor_X</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbCRYO_Motor_Y</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbCRYO_Motor_Z</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbCRYO_Motor_rY</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbCRYO_Motor_X</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbCRYO_Motor_Y</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbCRYO_Motor_Z</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbCRYO_Motor_rY</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="p">);</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-diagnosticpaddle">
<h2>PRG_DiagnosticPaddle<a class="headerlink" href="#prg-diagnosticpaddle" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PROGRAM PRG_DiagnosticPaddle
(*  Program for the ChemRIXS diagnostic paddle. This program sets up a series of PositionStateManagers to implement
    the necessary logic to protect the assembly from running into the recirculation system tube and catcher. *)

    // TODO: Setup position state locks?
VAR_INPUT
    xMoveOK : BOOL := FALSE; // External interlock. Applied to bEnable of all PositionStateManagers.
END_VAR
VAR
    bInit : BOOL := FALSE; // Initialization variable
    //iCounter : UDINT; // loop counter

    // Setup Assembly manager to set bMoveOK for appropriate states
    fbDPAssemblyManager : FB_AssemblyPositionStatemanager;

    // Array of axes for protection FB
    arrDPAxes : ARRAY [1..3] OF DUT_MotionStage := [stDPXMotor, stDPYMotor, stDPZMotor];

    //  Setup diagnostic paddle adjacency matrix
    arrDPTransitions : ARRAY [0..9, 1..9] OF BOOL :=
    //Park  Up     Center Pinh.  Diode  Yag1   Yag2   Yag3   Knife
    [FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, // Unknown (This should always be included)
     TRUE,  TRUE,  FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, // Park
     TRUE,  TRUE,  TRUE,  FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, // Up
     TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  // Center
     FALSE, FALSE, TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  // Pinhole
     FALSE, FALSE, TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  // Diode
     FALSE, FALSE, TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  // Yag1
     FALSE, FALSE, TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  // Yag2
     FALSE, FALSE, TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  // Yag3
     FALSE, FALSE, TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE,  TRUE]; // Knife

    // Setup diagnostic paddle output matrix
    arrDPOutputs            : ARRAY [1..9, 1..3] OF DUT_PositionState :=
    //X axis                    Y axis                          Z axis                       Assembly state
    [stDPXPosPark,          stDPYPosPark,           stDPZPosPark,     // Park
     stDPXPosPark,          stDPYPosCenter,         stDPZPosPark,     // Up
     stDPXPosCenter,        stDPYPosCenter,         stDPZPosCenter,   // Center
     stDPXPosCenter,        stDPYPosPinhole,        stDPZPosCenter,   // Pinhole
     stDPXPosCenter,        stDPYPosDiode,          stDPZPosCenter,   // Diode
     stDPXPosCenter,        stDPYPosYag1,           stDPZPosCenter,   // Yag1
     stDPXPosCenter,        stDPYPosYag2,           stDPZPosCenter,   // Yag2
     stDPXPosCenter,        stDPYPosYag3,           stDPZPosCenter,   // Yag3
     stDPXPosCenter,        stDPYPosKnife,          stDPZPosCenter];  // Knife

    // TODO: Figure out a way to make this more useful, or remove it.
    arrDPStates                     : ARRAY[0..9] OF STRING := [&#39;UNKNOWN&#39;, &#39;PARK&#39;, &#39;UP&#39;, &#39;CENTER&#39;,
                                                    &#39;PINHOLE&#39;, &#39;DIODE&#39;, &#39;YAG1&#39;, &#39;YAG2&#39;,
                                                    &#39;YAG3&#39;, &#39;KNIFE&#39;];

    // Array of position states for PositionStateManagers (initialize later)
    arrDPXStates : ARRAY [1..15] OF DUT_PositionState := [stDPXPosPark,stDPXPosCenter,stDPXPosKnife];
    arrDPYStates : ARRAY [1..15] OF DUT_PositionState := [stDPYPosPark,stDPYPosCenter,stDPYPosPinhole,stDPYPosDiode,stDPYPosYag1,
                                                          stDPYPosYag2,stDPYPosYag3,stDPYPosKnife];
    arrDPZStates : ARRAY [1..15] OF DUT_PositionState := [stDPZPosPark,stDPZPosCenter];

    // Setup PositionStateManagers and set variables for each axis
    // X Axis
    // When changed, sets the destination and starts a move
    {attribute &#39;pytmc&#39; := &#39;
        pv: SET
        io: io
    &#39;}
    enumDPXSet: ENUM_DPX; // NOTE: Please copy this pragma exactly on your enumSet
    {attribute &#39;pytmc&#39; := &#39;
        pv:
           io: io
    &#39;}
    fbXStateManager: FB_PositionStateManager;

    // Y axis
    // When changed, sets the destination and starts a move
    {attribute &#39;pytmc&#39; := &#39;
        pv: SET
        io: io
    &#39;}
    enumDPYSet: ENUM_DPY; // NOTE: Please copy this pragma exactly on your enumSet
    {attribute &#39;pytmc&#39; := &#39;
        pv:
        io: io
    &#39;}
    fbYStateManager: FB_PositionStateManager;

    // Z axis
    // When changed, sets the destination and starts a move
    {attribute &#39;pytmc&#39; := &#39;
        pv: SET
        io: io
    &#39;}
    enumDPZSet: ENUM_DPZ; // NOTE: Please copy this pragma exactly on your enumSet
    {attribute &#39;pytmc&#39; := &#39;
        pv:
        io: io
    &#39;}
    fbZStateManager: FB_PositionStateManager;

    arrPosLocks : ARRAY [1..13] OF FB_PositionStateLock;

END_VAR
VAR_OUTPUT
    // Setup PositionStateManager Outputs
    // X Axis
    // If TRUE, we are in an error state
    bDPXError: BOOL; // NOTE: do not pragma these, already has pragma in manager
    // Error code
    nDPXErrorId: UDINT;
    // Message associated with bError = TRUE
    sDPXErrorMessage: STRING;
    // If TRUE, we are currently moving between states
    bDPXBusy: BOOL;
    // If TRUE, we asked for a move between states, it completed successfully, and there is no ongoing move
    bDPXDone: BOOL;
    // The current state readback
    {attribute &#39;pytmc&#39; := &#39;
        pv: GET
        io: i
    &#39;}
    enumDPXGet: ENUM_DPX; // NOTE: Please copy this pragma exactly on your enumGet

    // Y Axis
    // If TRUE, we are in an error state
    bDPYError: BOOL; // NOTE: do not pragma these, already has pragma in manager
    // Error code
    nDPYErrorId: UDINT;
    // Message associated with bError = TRUE
    sDPYErrorMessage: STRING;
    // If TRUE, we are currently moving between states
    bDPYBusy: BOOL;
    // If TRUE, we asked for a move between states, it completed successfully, and there is no ongoing move
    bDPYDone: BOOL;
    // The current state readback
    {attribute &#39;pytmc&#39; := &#39;
        pv: GET
        io: i
    &#39;}
    enumDPYGet: ENUM_DPY; // NOTE: Please copy this pragma exactly on your enumGet

    // Z Axis
    // If TRUE, we are in an error state
    bDPZError: BOOL; // NOTE: do not pragma these, already has pragma in manager
    // Error code
    nDPZErrorId: UDINT;
    // Message associated with bError = TRUE
    sDPZErrorMessage: STRING;
    // If TRUE, we are currently moving between states
    bDPZBusy: BOOL;
    // If TRUE, we asked for a move between states, it completed successfully, and there is no ongoing move
    bDPZDone: BOOL;
    // The current state readback
    {attribute &#39;pytmc&#39; := &#39;
        pv: GET
        io: i
    &#39;}
    enumDPZGet: ENUM_DPZ; // NOTE: Please copy this pragma exactly on your enumGet
END_VAR
IF NOT bInit THEN
    bInit := TRUE;
END_IF

// Manage the logic between the Diagnostic Paddle axes
fbDPAssemblyManager(arrOutputs:=arrDPOutputs,
                    arrTransitions:=arrDPTransitions,
                    arrAxes:=arrDPAxes,
                    arrAssemblyStates:=arrDPStates);

// Update positions based on motion requests
fbXStateManager(
    stMotionStage := stDPXMotor,
    arrStates := arrDPXStates,
    setState := enumDPXSet,
    bEnable := xMoveOK,
    bError =&gt; bDPXError,
    nErrorId =&gt; nDPXErrorId,
    sErrorMessage =&gt; sDPXErrorMessage,
    bBusy =&gt; bDPXBusy,
    bDone =&gt; bDPXDone,
    getState =&gt; enumDPXGet);

fbYStateManager(
    stMotionStage := stDPYMotor,
    arrStates := arrDPYStates,
    setState := enumDPYSet,
    bEnable := xMoveOK,
    bError =&gt; bDPYError,
    nErrorId =&gt; nDPYErrorId,
    sErrorMessage =&gt; sDPYErrorMessage,
    bBusy =&gt; bDPYBusy,
    bDone =&gt; bDPYDone,
    getState =&gt; enumDPYGet);

fbZStateManager(
    stMotionStage := stDPZMotor,
    arrStates := arrDPZStates,
    setState := enumDPZSet,
    bEnable := xMoveOK,
    bError =&gt; bDPZError,
    nErrorId =&gt; nDPZErrorId,
    sErrorMessage =&gt; sDPZErrorMessage,
    bBusy =&gt; bDPZBusy,
    bDone =&gt; bDPZDone,
    getState =&gt; enumDPZGet);

END_PROGRAM
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#enum-dpx">ENUM_DPX</a></p></li>
<li><p><a class="reference internal" href="#enum-dpy">ENUM_DPY</a></p></li>
<li><p><a class="reference internal" href="#enum-dpz">ENUM_DPZ</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-diagnosticpaddlemotors">
<h2>PRG_DiagnosticPaddleMotors<a class="headerlink" href="#prg-diagnosticpaddlemotors" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DiagnosticPaddleMotors</span>
<span class="n">VAR</span>
    <span class="n">fbDPX_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbDPY_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbDPZ_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbDPX_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="p">);</span>

<span class="o">////</span> <span class="n">Deal</span> <span class="k">with</span> <span class="n">bad</span> <span class="n">limit</span> <span class="n">switch</span> <span class="n">on</span> <span class="n">Y</span> <span class="n">stage</span>
<span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbDPY_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbDPZ_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-dpl-x-eps">
<h2>PRG_DPL_X_EPS<a class="headerlink" href="#prg-dpl-x-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DPL_X_EPS</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:X:EPS&#39;</span><span class="p">}</span>
    <span class="n">aDPL_X_EPS</span>              <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_EPSLimits</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:X:EPS:OVRD_MODE&#39;</span><span class="p">}</span>
    <span class="n">bEPS_Override</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:X:EPS:OVRD_COUNTDOWN&#39;</span><span class="p">}</span>
    <span class="n">tEPS_TimerCountDown</span> <span class="p">:</span> <span class="n">STRING</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">T</span><span class="c1">#0s);</span>
    <span class="n">fbResetTimer</span> <span class="p">:</span> <span class="n">FB_RestTimer</span><span class="p">;</span>

    <span class="n">bInit</span>           <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bFullRange</span>      <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">fbEPS</span>           <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbCheckEPS</span>      <span class="p">:</span> <span class="n">FB_CheckEPS</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">Set</span> <span class="n">Inital</span> <span class="n">Values</span>
    <span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">80</span><span class="p">;</span>

    <span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">30</span><span class="p">;</span>

    <span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">60</span><span class="p">;</span>
    <span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">80</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_RX in [124, 215&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">215</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;DPL_Z in [-10, 30]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fDPL_Z</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>

<span class="n">bFullRange</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">);</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aDPL_X_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;Full Range&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bFullRange</span><span class="p">);</span>

<span class="n">fbResetTimer</span><span class="p">(</span><span class="n">bInput</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">,</span> <span class="n">tElapseTime</span><span class="o">:=</span><span class="n">tEPS_OVRD_RESET_TIME</span><span class="p">,</span> <span class="n">tCountDown</span><span class="o">:=</span><span class="n">tEPS_TimerCountDown</span><span class="p">);</span>
<span class="n">fbCheckEPS</span><span class="p">(</span><span class="n">stMotor</span><span class="o">:=</span> <span class="n">M1</span><span class="p">,</span> <span class="n">fPosition</span><span class="o">:=</span><span class="n">fDPL_X</span><span class="p">,</span> <span class="n">aEPSLimits</span><span class="o">:=</span> <span class="n">aDPL_X_EPS</span><span class="p">,</span> <span class="n">stForwardMotorEPS</span><span class="o">:=</span><span class="n">M1</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">,</span> <span class="n">stBackwardMotorEPS</span><span class="o">:=</span> <span class="n">M1</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">,</span> <span class="n">bEPS_Override</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-checkeps">FB_CheckEPS</a></p></li>
<li><p><a class="reference internal" href="#fb-resttimer">FB_RestTimer</a></p></li>
<li><p><a class="reference internal" href="#f-inrange">F_InRange</a></p></li>
<li><p><a class="reference internal" href="#st-epslimits">ST_EPSLimits</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-dpl-y-eps">
<h2>PRG_DPL_Y_EPS<a class="headerlink" href="#prg-dpl-y-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DPL_Y_EPS</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:Y:EPS&#39;</span><span class="p">}</span>
    <span class="n">aDPL_Y_EPS</span>              <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_EPSLimits</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:Y:EPS:OVRD_MODE&#39;</span><span class="p">}</span>
    <span class="n">bEPS_Override</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:Y:EPS:OVRD_COUNTDOWN&#39;</span><span class="p">}</span>
    <span class="n">tEPS_TimerCountDown</span> <span class="p">:</span> <span class="n">STRING</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">T</span><span class="c1">#0s);</span>
    <span class="n">fbResetTimer</span> <span class="p">:</span> <span class="n">FB_RestTimer</span><span class="p">;</span>

    <span class="n">bInit</span>           <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bFullRange</span>      <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

       <span class="n">fbEPS</span>                <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbCheckEPS</span>      <span class="p">:</span> <span class="n">FB_CheckEPS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">Set</span> <span class="n">Inital</span> <span class="n">Values</span>
    <span class="n">aDPL_Y_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">aDPL_Y_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">80</span><span class="p">;</span>

    <span class="n">aDPL_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">40</span><span class="p">;</span>
    <span class="n">aDPL_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">80</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aDPL_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;DPL_Z in [-10,30];RCC in [-15,11]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fDPL_Z</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fRCC_Z</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">11</span><span class="p">));</span>

<span class="n">bFullRange</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">aDPL_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">;</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aDPL_Y_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;Full Range&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bFullRange</span><span class="p">);</span>

<span class="n">fbResetTimer</span><span class="p">(</span><span class="n">bInput</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">,</span> <span class="n">tElapseTime</span><span class="o">:=</span><span class="n">tEPS_OVRD_RESET_TIME</span><span class="p">,</span> <span class="n">tCountDown</span><span class="o">:=</span><span class="n">tEPS_TimerCountDown</span><span class="p">);</span>
<span class="n">fbCheckEPS</span><span class="p">(</span><span class="n">stMotor</span><span class="o">:=</span><span class="n">M2</span><span class="p">,</span> <span class="n">fPosition</span><span class="o">:=</span><span class="n">M2</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">,</span> <span class="n">aEPSLimits</span><span class="o">:=</span><span class="n">aDPL_Y_EPS</span><span class="p">,</span> <span class="n">stForwardMotorEPS</span><span class="o">:=</span><span class="n">M2</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">,</span> <span class="n">stBackwardMotorEPS</span><span class="o">:=</span> <span class="n">M2</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">,</span> <span class="n">bEPS_Override</span><span class="o">:=</span> <span class="n">bEPS_Override</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-checkeps">FB_CheckEPS</a></p></li>
<li><p><a class="reference internal" href="#fb-resttimer">FB_RestTimer</a></p></li>
<li><p><a class="reference internal" href="#f-inrange">F_InRange</a></p></li>
<li><p><a class="reference internal" href="#st-epslimits">ST_EPSLimits</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-dpl-z-eps">
<h2>PRG_DPL_Z_EPS<a class="headerlink" href="#prg-dpl-z-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DPL_Z_EPS</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:Z:EPS&#39;</span><span class="p">}</span>
    <span class="n">aDPL_Z_EPS</span>          <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">4</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_EPSLimits</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:Z:EPS:OVRD_MODE&#39;</span><span class="p">}</span>
    <span class="n">bEPS_Override</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:DPL:MMS:Z:EPS:OVRD_COUNTDOWN&#39;</span><span class="p">}</span>
    <span class="n">tEPS_TimerCountDown</span> <span class="p">:</span> <span class="n">STRING</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">T</span><span class="c1">#0s);</span>
    <span class="n">fbResetTimer</span> <span class="p">:</span> <span class="n">FB_RestTimer</span><span class="p">;</span>

    <span class="n">bInit</span>           <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bFullRange</span>      <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">fbEPS</span>           <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbCheckEPS</span>      <span class="p">:</span> <span class="n">FB_CheckEPS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">Set</span> <span class="n">Inital</span> <span class="n">Values</span>
    <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">10</span><span class="p">;</span>
    <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;DPL X in [10,30]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fDPL_X</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;RCC Y in [-34,10];RCC_Z in [-15,11]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fRCC_Y</span><span class="p">,</span> <span class="o">-</span><span class="mi">34</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fRCC_Z</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">11</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;RCC_Y in [-38,-34];RCC_Z in [-15,11];DPL_Y in [-1,40]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fRCC_Y</span><span class="p">,</span> <span class="o">-</span><span class="mi">38</span><span class="p">,</span> <span class="o">-</span><span class="mi">34</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fRCC_Z</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">11</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fDPL_Y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">));</span>

<span class="n">bFullRange</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">);</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aDPL_Z_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;Full Range&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bFullRange</span><span class="p">);</span>

<span class="n">fbResetTimer</span><span class="p">(</span><span class="n">bInput</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">,</span> <span class="n">tElapseTime</span><span class="o">:=</span><span class="n">tEPS_OVRD_RESET_TIME</span><span class="p">,</span> <span class="n">tCountDown</span><span class="o">:=</span><span class="n">tEPS_TimerCountDown</span><span class="p">);</span>
<span class="n">fbCheckEPS</span><span class="p">(</span><span class="n">stMotor</span><span class="o">:=</span><span class="n">M3</span><span class="p">,</span> <span class="n">fPosition</span><span class="o">:=</span><span class="n">fDPL_Z</span><span class="p">,</span> <span class="n">aEPSLimits</span><span class="o">:=</span> <span class="n">aDPL_Z_EPS</span><span class="p">,</span> <span class="n">stForwardMotorEPS</span><span class="o">:=</span><span class="n">M3</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">,</span> <span class="n">stBackwardMotorEPS</span><span class="o">:=</span> <span class="n">M3</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">,</span> <span class="n">bEPS_Override</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-checkeps">FB_CheckEPS</a></p></li>
<li><p><a class="reference internal" href="#fb-resttimer">FB_RestTimer</a></p></li>
<li><p><a class="reference internal" href="#f-inrange">F_InRange</a></p></li>
<li><p><a class="reference internal" href="#st-epslimits">ST_EPSLimits</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-eps">
<h2>PRG_EPS<a class="headerlink" href="#prg-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_EPS</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Update</span> <span class="n">Motor</span> <span class="n">Positions</span> <span class="n">before</span> <span class="n">Using</span> <span class="n">them</span> <span class="ow">in</span> <span class="n">EPS</span> <span class="n">Checks</span>
<span class="n">fDPL_X</span>  <span class="o">:=</span> <span class="n">M1</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>

<span class="n">fSDS_RX</span>     <span class="o">:=</span> <span class="n">M19</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>
<span class="n">fSDS_Y</span>      <span class="o">:=</span> <span class="n">M17</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>
<span class="n">fSDS_Z_ENC</span>  <span class="o">:=</span> <span class="n">M36</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>

<span class="n">fDPL_Z</span>              <span class="o">:=</span> <span class="n">M3</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>
<span class="n">fDPL_Y</span>              <span class="o">:=</span> <span class="n">M2</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>

<span class="n">fRCC_Z</span>              <span class="o">:=</span> <span class="n">M39</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>
<span class="n">fRCC_Y</span>              <span class="o">:=</span> <span class="n">M38</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>

<span class="n">PRG_SDS_Y_EPS</span><span class="p">();</span>
<span class="n">PRG_SDS_RX_EPS</span><span class="p">();</span>
<span class="n">PRG_SDS_ZENCODER_EPS</span><span class="p">();</span>

<span class="n">PRG_DPL_X_EPS</span><span class="p">();</span>
<span class="n">PRG_DPL_Y_EPS</span><span class="p">();</span>
<span class="n">PRG_DPL_Z_EPS</span><span class="p">();</span>

<span class="n">PRG_RCC_Y_EPS</span><span class="p">();</span>
<span class="n">PRG_RCC_Z_EPS</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#prg-dpl-x-eps">PRG_DPL_X_EPS</a></p></li>
<li><p><a class="reference internal" href="#prg-dpl-y-eps">PRG_DPL_Y_EPS</a></p></li>
<li><p><a class="reference internal" href="#prg-dpl-z-eps">PRG_DPL_Z_EPS</a></p></li>
<li><p><a class="reference internal" href="#prg-rcc-y-eps">PRG_RCC_Y_EPS</a></p></li>
<li><p><a class="reference internal" href="#prg-rcc-z-eps">PRG_RCC_Z_EPS</a></p></li>
<li><p><a class="reference internal" href="#prg-sds-rx-eps">PRG_SDS_RX_EPS</a></p></li>
<li><p><a class="reference internal" href="#prg-sds-y-eps">PRG_SDS_Y_EPS</a></p></li>
<li><p><a class="reference internal" href="#prg-sds-zencoder-eps">PRG_SDS_ZENCODER_EPS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-fiberlite">
<h2>PRG_FiberLite<a class="headerlink" href="#prg-fiberlite" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_FiberLite</span>
<span class="n">VAR</span>

<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Set</span> <span class="n">LED</span> <span class="n">output</span> <span class="n">scaling</span> <span class="p">(</span><span class="n">Fiber</span><span class="o">-</span><span class="n">Lite</span><span class="p">)</span>
<span class="n">bLedOutput1</span><span class="o">.</span><span class="n">iTermBits</span> <span class="o">:=</span> <span class="mi">14</span><span class="p">;</span>
<span class="n">bLedOutput1</span><span class="p">(</span><span class="n">fbSetIllPercent</span><span class="o">=&gt;</span><span class="p">);</span>

<span class="n">bLedOutput2</span><span class="o">.</span><span class="n">iTermBits</span> <span class="o">:=</span> <span class="mi">14</span><span class="p">;</span>
<span class="n">bLedOutput2</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</section>
<section id="prg-illumination">
<h2>PRG_Illumination<a class="headerlink" href="#prg-illumination" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Illumination</span>
<span class="p">(</span><span class="o">*</span>  <span class="n">Program</span> <span class="k">for</span> <span class="n">the</span> <span class="n">ChemRIXS</span> <span class="n">illumination</span> <span class="n">system</span><span class="o">.</span> <span class="o">*</span><span class="p">)</span>
<span class="n">VAR_INPUT</span>
    <span class="n">xMoveOK</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">External</span> <span class="n">interlock</span><span class="o">.</span> <span class="n">Applied</span> <span class="n">to</span> <span class="n">bEnable</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">PositionStateManagers</span><span class="o">.</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Initialization</span> <span class="n">variable</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

<span class="n">END_IF</span>

<span class="n">fbILMXStage</span><span class="p">(</span><span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="p">);</span>
<span class="n">fbILMYStage</span><span class="p">(</span><span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="p">);</span>
<span class="n">fbILMZStage</span><span class="p">(</span><span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-injectormotors">
<h2>PRG_InjectorMotors<a class="headerlink" href="#prg-injectormotors" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_InjectorMotors</span>
<span class="n">VAR</span>
    <span class="n">fbSDSX_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbSDSY_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbSDSZ_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbSDSRY_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbSDSShroud_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbSDSZEncoder</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>

    <span class="n">bEPS_OK_SDSZ_18</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span><span class="n">Valve</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">Open</span> <span class="n">State</span> <span class="n">And</span> <span class="n">communication</span> <span class="n">ok</span>

    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="o">//</span><span class="n">Limit</span> <span class="n">Switch</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^DRL02-E27 (EL7031)^STM Status^Status^Digital input 2&#39;</span><span class="p">}</span>
    <span class="n">bLimitBackwardEnable_SDSZ_18</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Inputs^bSDS_VGC_01_CLS&#39;</span><span class="p">}</span>
    <span class="n">bSDS_VGC_01_CLS</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Inputs^bSDS_VGC_01_OPN&#39;</span><span class="p">}</span>
    <span class="n">bSDS_VGC_01_OPN</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Outputs^bMOTSDSZ18_IN&#39;</span><span class="p">}</span>
    <span class="n">bMOTSDSZ18_IN</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[CRIX_VAC_INTF (EL6695-0002)]^IO Outputs^bMOTSDSZ18_OUT&#39;</span><span class="p">}</span>
    <span class="n">bMOTSDSZ18_OUT</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Hall</span> <span class="n">Effect</span> <span class="n">Limits</span> <span class="k">for</span> <span class="n">SDS</span> <span class="n">X</span> <span class="n">Stage</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^Term 173 (EL1124)^Channel 3^Input&#39;</span><span class="p">}</span>
    <span class="n">bHall_Forward</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nHall_Forward_Cycles</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 1 (EtherCAT)^Term 5 (EK1200)^Term 6 (EK1122-0080)^DRL02-EK0 (EK1101-0080)^Term 173 (EL1124)^Channel 4^Input&#39;</span><span class="p">}</span>
    <span class="n">bHall_Backward</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nHall_Backward_Cycles</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>

    <span class="n">nNumCyclesNeeded</span><span class="p">:</span> <span class="n">UINT</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="k">if</span> <span class="p">(</span><span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">X</span> <span class="n">Motor</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">ABSOLUTE_SET</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Y</span> <span class="n">motor</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Z</span> <span class="n">Motor</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Y</span> <span class="n">Rotation</span> <span class="n">Motor</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Shroud</span> <span class="n">Motor</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbSDSX_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="p">);</span>
<span class="n">fbSDSY_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="p">);</span>
<span class="n">fbSDSZ_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="p">);</span>
<span class="n">fbSDSRY_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="p">);</span>
<span class="n">fbSDSShroud_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="p">);</span>
<span class="n">fbSDSZEncoder</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="p">);</span>


<span class="n">bMOTSDSZ18_OUT</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">;</span>
<span class="n">bMOTSDSZ18_IN</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">bLimitBackwardEnable_SDSZ_18</span><span class="p">;</span>
<span class="n">bEPS_OK_SDSZ_18</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">bSDS_VGC_01_CLS</span><span class="p">)</span> <span class="n">AND</span> <span class="n">bSDS_VGC_01_OPN</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">PRG_CryoPump</span><span class="o">.</span><span class="n">xEcatBridge_External_device_not_connected</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">PRG_CryoPump</span><span class="o">.</span><span class="n">xEcatBridge_WcState</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">PRG_CryoPump</span><span class="o">.</span><span class="n">xEcatBridge_TxPDO_state</span><span class="p">);</span>


<span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">bEPS_OK_SDSZ_18</span> <span class="n">AND</span> <span class="n">bLimitBackwardEnable_SDSZ_18</span><span class="p">;</span>

<span class="o">//</span> <span class="n">X</span> <span class="n">Stage</span> <span class="n">Groundswitching</span> <span class="n">Limits</span> <span class="n">Logic</span>

<span class="o">//</span><span class="n">Cycle</span> <span class="n">counting</span> <span class="n">code</span> <span class="k">for</span> <span class="n">dealing</span> <span class="k">with</span> <span class="n">interference</span>
<span class="n">IF</span> <span class="n">bHall_Forward</span> <span class="n">THEN</span>
    <span class="n">nHall_Forward_Cycles</span> <span class="o">:=</span> <span class="n">MIN</span><span class="p">(</span><span class="n">nHall_Forward_Cycles</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nNumCyclesNeeded</span><span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">nHall_Forward_Cycles</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="n">bHall_Backward</span> <span class="n">THEN</span>
    <span class="n">nHall_Backward_Cycles</span> <span class="o">:=</span> <span class="n">MIN</span><span class="p">(</span><span class="n">nHall_Backward_Cycles</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nNumCyclesNeeded</span><span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">nHall_Backward_Cycles</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="o">:=</span> <span class="n">nHall_Forward_Cycles</span> <span class="o">&lt;</span> <span class="n">nNumCyclesNeeded</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">nHall_Backward_Cycles</span> <span class="o">&lt;</span> <span class="n">nNumCyclesNeeded</span><span class="p">;</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
<li><p><a class="reference internal" href="#prg-cryopump">PRG_CryoPump</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-main">
<h2>PRG_Main<a class="headerlink" href="#prg-main" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Main</span>
<span class="n">VAR</span>
    <span class="o">//</span><span class="n">stTestMotor1</span>  <span class="p">:</span>       <span class="n">DUT_SimMotor</span><span class="p">;</span>
    <span class="o">//</span><span class="n">fbTestMotor</span>           <span class="p">:</span>       <span class="n">FB_SIM_MOTOR</span><span class="p">;</span>
    <span class="n">bInit</span>                   <span class="p">:</span>       <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">DPState</span> <span class="p">:</span> <span class="n">INT</span><span class="p">;</span>
    <span class="n">arrStates</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..9</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ENUM_DiagPaddle</span><span class="p">;</span>
    <span class="n">bDPaddleOK</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Add</span> <span class="n">interlock</span> <span class="n">logic</span> <span class="n">to</span> <span class="n">this</span> <span class="n">later</span>
<span class="n">bDPaddleOK</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="o">//</span><span class="n">PRG_DiagnosticPaddle</span><span class="p">(</span><span class="n">xMoveOK</span><span class="o">:=</span><span class="n">bDPaddleOK</span><span class="p">);</span>

<span class="o">//</span><span class="n">PRG_QueueTest</span><span class="p">();</span>

<span class="o">//</span><span class="n">PRG_Test_AdjacentStates</span><span class="p">();</span>

<span class="o">//</span><span class="n">PRG_BFS</span><span class="p">();</span>

<span class="n">PRG_EPS</span><span class="p">();</span>
<span class="n">PRG_DiagnosticPaddleMotors</span><span class="p">();</span>

<span class="n">PRG_QuestarMotors</span><span class="p">();</span>

<span class="n">PRG_PointDetectorMotors</span><span class="p">();</span>

<span class="n">PRG_CryoStat</span><span class="p">();</span>
<span class="n">PRG_RCI</span><span class="p">();</span>
<span class="n">PRG_Camera</span><span class="p">();</span>
<span class="n">PRG_Beamblock</span><span class="p">();</span>
<span class="n">PRG_ObjectivesMotors</span><span class="p">();</span>
<span class="n">PRG_RCC</span><span class="p">();</span>
<span class="n">PRG_VLS</span><span class="p">();</span>
<span class="n">PRG_InjectorMotors</span><span class="p">();</span>
<span class="n">PRG_Illumination</span><span class="p">();</span>
<span class="n">PRG_CryoPump</span><span class="p">();</span>
<span class="n">PRG_FiberLite</span><span class="p">();</span>

<span class="n">PRG_PMPS</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#enum-diagpaddle">ENUM_DiagPaddle</a></p></li>
<li><p><a class="reference internal" href="#prg-bfs">PRG_BFS</a></p></li>
<li><p><a class="reference internal" href="#prg-beamblock">PRG_Beamblock</a></p></li>
<li><p><a class="reference internal" href="#prg-camera">PRG_Camera</a></p></li>
<li><p><a class="reference internal" href="#prg-cryopump">PRG_CryoPump</a></p></li>
<li><p><a class="reference internal" href="#prg-cryostat">PRG_CryoStat</a></p></li>
<li><p><a class="reference internal" href="#prg-diagnosticpaddle">PRG_DiagnosticPaddle</a></p></li>
<li><p><a class="reference internal" href="#prg-diagnosticpaddlemotors">PRG_DiagnosticPaddleMotors</a></p></li>
<li><p><a class="reference internal" href="#prg-eps">PRG_EPS</a></p></li>
<li><p><a class="reference internal" href="#prg-fiberlite">PRG_FiberLite</a></p></li>
<li><p><a class="reference internal" href="#prg-illumination">PRG_Illumination</a></p></li>
<li><p><a class="reference internal" href="#prg-injectormotors">PRG_InjectorMotors</a></p></li>
<li><p><a class="reference internal" href="#prg-objectivesmotors">PRG_ObjectivesMotors</a></p></li>
<li><p><a class="reference internal" href="#prg-pmps">PRG_PMPS</a></p></li>
<li><p><a class="reference internal" href="#prg-pointdetectormotors">PRG_PointDetectorMotors</a></p></li>
<li><p><a class="reference internal" href="#prg-questarmotors">PRG_QuestarMotors</a></p></li>
<li><p><a class="reference internal" href="#prg-queuetest">PRG_QueueTest</a></p></li>
<li><p><a class="reference internal" href="#prg-rcc">PRG_RCC</a></p></li>
<li><p><a class="reference internal" href="#prg-rci">PRG_RCI</a></p></li>
<li><p><a class="reference internal" href="#prg-test-adjacentstates">PRG_Test_AdjacentStates</a></p></li>
<li><p><a class="reference internal" href="#prg-vls">PRG_VLS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-objectivesmotors">
<h2>PRG_ObjectivesMotors<a class="headerlink" href="#prg-objectivesmotors" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_ObjectivesMotors</span>
<span class="n">VAR</span>
    <span class="n">fbOBJX_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbOBJY_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbOBJZ_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbOBJX_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbOBJY_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbOBJZ_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-pmps">
<h2>PRG_PMPS<a class="headerlink" href="#prg-pmps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_PMPS</span>
<span class="n">VAR</span>
     <span class="n">fbArbiterIO</span> <span class="p">:</span> <span class="n">FB_SubSysToArbiter_IO</span><span class="p">;</span>

    <span class="n">ff2_ff1_link</span><span class="p">:</span> <span class="n">FB_FastFault</span> <span class="o">:=</span> <span class="p">(</span><span class="n">i_xAutoReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;FF2 to FF1 Link&#39;</span><span class="p">,</span> <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;This is virtual FF2 fault, Please check the faulting device below&#39;</span><span class="p">,</span> <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#9999);</span>

<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span><span class="n">Fast</span> <span class="n">Fault</span> <span class="n">instantiation</span><span class="o">*</span><span class="p">)</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="o">.</span><span class="n">bAutoReset</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput2</span><span class="o">.</span><span class="n">bAutoReset</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">i_xVeto</span> <span class="o">:=</span> <span class="p">(</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">aVetoDevices</span><span class="p">[</span><span class="n">PMPS</span><span class="o">.</span><span class="n">K_Stopper</span><span class="o">.</span><span class="n">MR1K1_OUT</span><span class="p">]</span>
                                      <span class="n">AND</span> <span class="n">NOT</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">aVetoDevices</span><span class="p">[</span><span class="n">PMPS</span><span class="o">.</span><span class="n">K_Stopper</span><span class="o">.</span><span class="n">MR1K1_IN</span><span class="p">])</span>
                                       <span class="n">OR</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">aVetoDevices</span><span class="p">[</span><span class="n">PMPS</span><span class="o">.</span><span class="n">K_Stopper</span><span class="o">.</span><span class="n">ST1K2</span><span class="p">]);</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput2</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">i_xVeto</span> <span class="o">:=</span> <span class="p">(</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">aVetoDevices</span><span class="p">[</span><span class="n">PMPS</span><span class="o">.</span><span class="n">K_Stopper</span><span class="o">.</span><span class="n">MR1K1_OUT</span><span class="p">]</span>
                                      <span class="n">AND</span> <span class="n">NOT</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">aVetoDevices</span><span class="p">[</span><span class="n">PMPS</span><span class="o">.</span><span class="n">K_Stopper</span><span class="o">.</span><span class="n">MR1K1_IN</span><span class="p">])</span>
                                       <span class="n">OR</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">aVetoDevices</span><span class="p">[</span><span class="n">PMPS</span><span class="o">.</span><span class="n">K_Stopper</span><span class="o">.</span><span class="n">ST1K2</span><span class="p">]);</span>
<span class="p">(</span><span class="o">*</span> <span class="n">Arbiter</span> <span class="n">Instantiation</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbArbiterIO</span><span class="p">(</span><span class="n">Arbiter</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter1</span><span class="p">,</span> <span class="n">fbFFHWO</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="p">,</span> <span class="n">i_bVeto</span> <span class="o">:=</span> <span class="p">(</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">aVetoDevices</span><span class="p">[</span><span class="n">PMPS</span><span class="o">.</span><span class="n">K_Stopper</span><span class="o">.</span><span class="n">MR1K1_OUT</span><span class="p">]</span>
                                      <span class="n">AND</span> <span class="n">NOT</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">aVetoDevices</span><span class="p">[</span><span class="n">PMPS</span><span class="o">.</span><span class="n">K_Stopper</span><span class="o">.</span><span class="n">MR1K1_IN</span><span class="p">])</span>
                                       <span class="n">OR</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">aVetoDevices</span><span class="p">[</span><span class="n">PMPS</span><span class="o">.</span><span class="n">K_Stopper</span><span class="o">.</span><span class="n">ST1K2</span><span class="p">]);</span>
<span class="o">//</span><span class="n">routed</span> <span class="n">to</span> <span class="n">the</span> <span class="n">arbiter</span>
<span class="n">ff2_ff1_link</span><span class="p">(</span>
    <span class="n">io_fbFFHWO</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput2</span><span class="p">,</span>
    <span class="n">i_xOK</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="o">.</span><span class="n">q_xFastFaultOut</span><span class="p">);</span>

<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter1</span><span class="o">.</span><span class="n">AddRequest</span><span class="p">(</span><span class="n">nReqID</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#FAFA, stReqBp := PMPS_GVL.cstFullBeam, sDevName :=&#39;plc-crix-mot&#39;);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-pointdetectormotors">
<h2>PRG_PointDetectorMotors<a class="headerlink" href="#prg-pointdetectormotors" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_PointDetectorMotors</span>
<span class="n">VAR</span>
    <span class="n">fbPDETY_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbPDETTheta_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbPDETY_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbPDETTheta_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-questarmotors">
<h2>PRG_QuestarMotors<a class="headerlink" href="#prg-questarmotors" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_QuestarMotors</span>
<span class="n">VAR</span>
    <span class="n">fbQSTX_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbQSTY_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbQSTX_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbQSTY_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-queuetest">
<h2>PRG_QueueTest<a class="headerlink" href="#prg-queuetest" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_QueueTest</span>
<span class="n">VAR</span>
    <span class="n">stQueue</span> <span class="p">:</span> <span class="n">ST_Queue</span><span class="p">;</span>
    <span class="n">fbQueue</span> <span class="p">:</span> <span class="n">FB_Queue</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">iResult</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">bResult</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
    <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
    <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
    <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
    <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
    <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="n">fbQueue</span><span class="o">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">11</span><span class="p">);</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span> <span class="o">//</span> <span class="mi">1</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span> <span class="o">//</span> <span class="mi">5</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span> <span class="o">//</span> <span class="mi">10</span>
    <span class="n">iResult</span> <span class="o">:=</span> <span class="n">fbQueue</span><span class="o">.</span><span class="n">Dequeue</span><span class="p">();</span> <span class="o">//</span> <span class="n">element</span> <span class="mi">11</span><span class="p">;</span> <span class="n">should</span> <span class="n">fail</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-queue">FB_Queue</a></p></li>
<li><p><a class="reference internal" href="#st-queue">ST_Queue</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-rcc">
<h2>PRG_RCC<a class="headerlink" href="#prg-rcc" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_RCC</span>
<span class="n">VAR</span>
    <span class="n">fbRCC_Motor_X</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbRCC_Motor_Y</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbRCC_Motor_Z</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M39</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M39</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M39</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M39</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbRCC_Motor_X</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="p">);</span>
<span class="n">fbRCC_Motor_Y</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="p">);</span>
<span class="n">fbRCC_Motor_Z</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M39</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-rcc-y-eps">
<h2>PRG_RCC_Y_EPS<a class="headerlink" href="#prg-rcc-y-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_RCC_Y_EPS</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCC:MMS:Y:EPS&#39;</span><span class="p">}</span>
    <span class="n">aRCC_Y_EPS</span>          <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">4</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_EPSLimits</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCC:MMS:Y:EPS:OVRD_MODE&#39;</span><span class="p">}</span>
    <span class="n">bEPS_Override</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span>  <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCC:MMS:Y:EPS:OVRD_COUNTDOWN&#39;</span><span class="p">}</span>
    <span class="n">tEPS_TimerCountDown</span> <span class="p">:</span> <span class="n">STRING</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">T</span><span class="c1">#0s);</span>
    <span class="n">fbResetTimer</span> <span class="p">:</span> <span class="n">FB_RestTimer</span><span class="p">;</span>

    <span class="n">bInit</span>           <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bFullRange</span>      <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">fbEPS</span>           <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbCheckEPS</span>      <span class="p">:</span> <span class="n">FB_CheckEPS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">Set</span> <span class="n">Inital</span> <span class="n">Values</span>
    <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">38</span><span class="p">;</span>
    <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>

    <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">38</span><span class="p">;</span>
    <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">34</span><span class="p">;</span>

    <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">38</span><span class="p">;</span>
    <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">34</span><span class="p">;</span>

    <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">38</span><span class="p">;</span>
    <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">//</span> <span class="n">VARIBLE</span>

    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_RX in [124, 215];SDS_Z_ENC in [3.05, 3.8]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">215</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="mf">3.05</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;DPL_Z in [-10,30];RCC_Z in [-15,11]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fDPL_Z</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fRCC_Z</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">11</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_Z_ENC in [3.8, 4];SDS_Y - RCC_Y &lt;= nozzle_catcher_offset&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">fSDS_Y</span> <span class="o">-</span> <span class="n">fRCC_Y</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">fNozzleCatcherOffset</span><span class="p">);</span>

<span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="n">fSDS_Y</span> <span class="o">-</span> <span class="n">fNozzleCatcherOffset</span><span class="p">;</span> <span class="o">//</span> <span class="n">Variable</span> <span class="n">Limits</span>


<span class="n">bFullRange</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">);</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aRCC_Y_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;Full Range&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bFullRange</span><span class="p">);</span>

<span class="n">fbResetTimer</span><span class="p">(</span><span class="n">bInput</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">,</span> <span class="n">tElapseTime</span><span class="o">:=</span><span class="n">tEPS_OVRD_RESET_TIME</span><span class="p">,</span> <span class="n">tCountDown</span><span class="o">:=</span><span class="n">tEPS_TimerCountDown</span><span class="p">);</span>
<span class="n">fbCheckEPS</span><span class="p">(</span><span class="n">stMotor</span><span class="o">:=</span><span class="n">M38</span><span class="p">,</span> <span class="n">fPosition</span><span class="o">:=</span><span class="n">fRCC_Y</span><span class="p">,</span> <span class="n">aEPSLimits</span><span class="o">:=</span><span class="n">aRCC_Y_EPS</span><span class="p">,</span> <span class="n">stForwardMotorEPS</span><span class="o">:=</span><span class="n">M38</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">,</span> <span class="n">stBackwardMotorEPS</span><span class="o">:=</span> <span class="n">M38</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">,</span> <span class="n">bEPS_Override</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-checkeps">FB_CheckEPS</a></p></li>
<li><p><a class="reference internal" href="#fb-resttimer">FB_RestTimer</a></p></li>
<li><p><a class="reference internal" href="#f-inrange">F_InRange</a></p></li>
<li><p><a class="reference internal" href="#st-epslimits">ST_EPSLimits</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-rcc-z-eps">
<h2>PRG_RCC_Z_EPS<a class="headerlink" href="#prg-rcc-z-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_RCC_Z_EPS</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCC:MMS:Z:EPS&#39;</span><span class="p">}</span>
    <span class="n">aRCC_Z_EPS</span>          <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">3</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_EPSLimits</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCC:MMS:Z:EPS:OVRD_MODE&#39;</span><span class="p">}</span>
    <span class="n">bEPS_Override</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:RCC:MMS:Z:EPS:OVRD_COUNTDOWN&#39;</span><span class="p">}</span>
    <span class="n">tEPS_TimerCountDown</span> <span class="p">:</span> <span class="n">STRING</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">T</span><span class="c1">#0s);</span>
    <span class="n">fbResetTimer</span> <span class="p">:</span> <span class="n">FB_RestTimer</span><span class="p">;</span>
    <span class="n">bInit</span>           <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bFullRange</span>      <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">fbEPS</span>           <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbCheckEPS</span>      <span class="p">:</span> <span class="n">FB_CheckEPS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">Set</span> <span class="n">Inital</span> <span class="n">Values</span>
    <span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">;</span>
    <span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">11</span><span class="p">;</span>

    <span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">;</span>
    <span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">15</span><span class="p">;</span>

    <span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">;</span>
    <span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">15</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;DPL_Z in [-10,30];DPL_Y in [-1,40]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fDPL_Z</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fDPL_Y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;DPL_Z in [-10, 30];RCC_Y in [-34,10]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fDPL_Z</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fRCC_Y</span><span class="p">,</span> <span class="o">-</span><span class="mi">34</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span>

<span class="n">bFullRange</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">);</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aRCC_Z_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;Full Range&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bFullRange</span><span class="p">);</span>

<span class="n">fbResetTimer</span><span class="p">(</span><span class="n">bInput</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">,</span> <span class="n">tElapseTime</span><span class="o">:=</span><span class="n">tEPS_OVRD_RESET_TIME</span><span class="p">,</span> <span class="n">tCountDown</span><span class="o">:=</span> <span class="n">tEPS_TimerCountDown</span><span class="p">);</span>
<span class="n">fbCheckEPS</span><span class="p">(</span><span class="n">stMotor</span><span class="o">:=</span> <span class="n">M39</span><span class="p">,</span> <span class="n">fPosition</span><span class="o">:=</span><span class="n">fRCC_Z</span><span class="p">,</span> <span class="n">aEPSLimits</span><span class="o">:=</span><span class="n">aRCC_Z_EPS</span><span class="p">,</span> <span class="n">stForwardMotorEPS</span><span class="o">:=</span><span class="n">M39</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">,</span> <span class="n">stBackwardMotorEPS</span><span class="o">:=</span> <span class="n">M39</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">,</span> <span class="n">bEPS_Override</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-checkeps">FB_CheckEPS</a></p></li>
<li><p><a class="reference internal" href="#fb-resttimer">FB_RestTimer</a></p></li>
<li><p><a class="reference internal" href="#f-inrange">F_InRange</a></p></li>
<li><p><a class="reference internal" href="#st-epslimits">ST_EPSLimits</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-rci">
<h2>PRG_RCI<a class="headerlink" href="#prg-rci" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_RCI</span>
<span class="n">VAR</span>
    <span class="n">fbRCI_Motor_X</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbRCI_Motor_Y</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbRCI_Motor_Z</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbRCI_Motor_rX</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>

    <span class="n">iMagnetOutINT</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">INT</span><span class="p">;</span>
    <span class="n">iMagnetInINT</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">INT</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">CRIX</span><span class="p">:</span><span class="n">RCI</span><span class="p">:</span><span class="n">MAG_SET</span>
        <span class="n">EGU</span><span class="p">:</span> <span class="n">V</span>
    <span class="s1">&#39;}</span>
    <span class="n">fMagnetSet</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">CRIX</span><span class="p">:</span><span class="n">RCI</span><span class="p">:</span><span class="n">MAG_GET</span>
        <span class="n">EGU</span><span class="p">:</span> <span class="n">V</span>
    <span class="s1">&#39;}</span>
    <span class="n">fMagnetGet</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">fbGetMagnetVoltage</span><span class="p">:</span> <span class="n">FB_RCI_Analog_Input</span><span class="p">;</span> <span class="o">//</span> <span class="n">FB_AnalogInput</span><span class="p">;</span>
    <span class="n">fbSetMagnetVoltage</span><span class="p">:</span> <span class="n">FB_RCI_Analog_Output</span><span class="p">;</span> <span class="o">//</span> <span class="n">FB_AnalogOutput</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbRCI_Motor_X</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbRCI_Motor_Y</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbRCI_Motor_Z</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">fbRCI_Motor_rX</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="p">);</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>

<span class="n">fbSetMagnetVoltage</span><span class="p">(</span>
    <span class="n">fReal</span><span class="o">:=</span><span class="n">fMagnetSet</span><span class="p">,</span>
    <span class="n">fSafeMax</span><span class="o">:=</span><span class="mf">9.999</span><span class="p">,</span>
    <span class="n">fSafeMin</span><span class="o">:=-</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">iTermBits</span><span class="o">:=</span><span class="mi">16</span><span class="p">,</span>
    <span class="n">fTermMax</span><span class="o">:=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">fTermMin</span><span class="o">:=-</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">iRaw</span><span class="o">=&gt;</span><span class="n">iMagnetOutINT</span><span class="p">);</span>
<span class="n">fbGetMagnetVoltage</span><span class="p">(</span>
    <span class="n">iRaw</span><span class="o">:=</span><span class="n">iMagnetInINT</span><span class="p">,</span>
    <span class="n">iTermBits</span><span class="o">:=</span><span class="mi">16</span><span class="p">,</span>
    <span class="n">fTermMax</span><span class="o">:=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">fTermMin</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">fReal</span><span class="o">=&gt;</span><span class="n">fMagnetGet</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-rci-analog-input">FB_RCI_Analog_Input</a></p></li>
<li><p><a class="reference internal" href="#fb-rci-analog-output">FB_RCI_Analog_Output</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-sds-rx-eps">
<h2>PRG_SDS_RX_EPS<a class="headerlink" href="#prg-sds-rx-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_SDS_RX_EPS</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:RX:EPS&#39;</span><span class="p">}</span>
    <span class="n">aSDS_RX_EPS</span>     <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">5</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_EPSLimits</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:RX:EPS:OVRD_MODE&#39;</span><span class="p">}</span>
    <span class="n">bEPS_Override</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:RX:EPS:OVRD_COUNTDOWN&#39;</span><span class="p">}</span>
    <span class="n">tEPS_TimerCountDown</span> <span class="p">:</span> <span class="n">STRING</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">T</span><span class="c1">#0s);</span>
    <span class="n">fbResetTimer</span> <span class="p">:</span> <span class="n">FB_RestTimer</span><span class="p">;</span>

    <span class="n">bInit</span>           <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">bSDS_RX_FullRange</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">fbEPS</span>           <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbCheckEPS</span>      <span class="p">:</span> <span class="n">FB_CheckEPS</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">Set</span> <span class="n">Inital</span> <span class="n">Values</span>
    <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">124</span><span class="p">;</span>
    <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">218</span><span class="p">;</span>

    <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">215</span><span class="p">;</span>
    <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">218</span><span class="p">;</span>

    <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">215</span><span class="p">;</span>
    <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">218</span><span class="p">;</span>

    <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">124</span><span class="p">;</span>
    <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">134</span><span class="p">;</span>

    <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">124</span><span class="p">;</span>
    <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">134</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">EPS</span> <span class="n">conditions</span>
<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_Z_ENC in [3.05,3.4];SDS_Y in [30,38.5];RCC_Y in [-38,-34];DPL_X in [10,30]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="mf">3.4</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Y</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mf">38.5</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fRCC_Y</span><span class="p">,</span> <span class="o">-</span><span class="mi">38</span><span class="p">,</span> <span class="o">-</span><span class="mi">34</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fDPL_X</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>

<span class="n">bSDS_RX_FullRange</span> <span class="o">:=</span> <span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">;</span> <span class="o">//</span> <span class="n">FULL</span> <span class="n">RANGE</span> <span class="n">CONDITION</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_Z_ENC in [-1, 3.05]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.05</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">NOT</span> <span class="n">bSDS_RX_FullRange</span><span class="p">);</span> <span class="o">//</span> <span class="n">NOT</span> <span class="n">FULL</span> <span class="n">RANGE</span> <span class="n">COND</span><span class="o">.</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_Z_ENC in [3.05, 3.4];SDS_RX in [215, 220];Not Full Range&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="mf">3.05</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">220</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">NOT</span> <span class="n">bSDS_RX_FullRange</span><span class="p">);</span> <span class="o">//</span> <span class="n">NOT</span> <span class="n">FULL</span> <span class="n">RANGE</span> <span class="n">COND</span><span class="o">.</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_Z_ENC in [3.4, 4]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aSDS_RX_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_Z_ENC in [3.05,3.4];SDS_RX in [124, 134];Not Full Range&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="mf">3.05</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">134</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">NOT</span> <span class="n">bSDS_RX_FullRange</span><span class="p">);</span> <span class="o">//</span> <span class="n">NOT</span> <span class="n">FULL</span> <span class="n">RANGE</span> <span class="n">COND</span><span class="o">.</span>

<span class="n">fbResetTimer</span><span class="p">(</span><span class="n">bInput</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">,</span> <span class="n">tElapseTime</span><span class="o">:=</span><span class="n">tEPS_OVRD_RESET_TIME</span><span class="p">,</span> <span class="n">tCountDown</span><span class="o">:=</span><span class="n">tEPS_TimerCountDown</span><span class="p">);</span>
<span class="n">fbCheckEPS</span><span class="p">(</span><span class="n">stMotor</span><span class="o">:=</span><span class="n">M19</span><span class="p">,</span> <span class="n">fPosition</span><span class="o">:=</span> <span class="n">fSDS_RX</span><span class="p">,</span> <span class="n">aEPSLimits</span><span class="o">:=</span> <span class="n">aSDS_RX_EPS</span><span class="p">,</span> <span class="n">stForwardMotorEPS</span><span class="o">:=</span><span class="n">M19</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">,</span> <span class="n">stBackwardMotorEPS</span><span class="o">:=</span> <span class="n">M19</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">,</span> <span class="n">bEPS_Override</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-checkeps">FB_CheckEPS</a></p></li>
<li><p><a class="reference internal" href="#fb-resttimer">FB_RestTimer</a></p></li>
<li><p><a class="reference internal" href="#f-inrange">F_InRange</a></p></li>
<li><p><a class="reference internal" href="#st-epslimits">ST_EPSLimits</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-sds-y-eps">
<h2>PRG_SDS_Y_EPS<a class="headerlink" href="#prg-sds-y-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_SDS_Y_EPS</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:Y:EPS&#39;</span><span class="p">}</span>
    <span class="n">aSDS_Y_EPS</span>              <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">5</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_EPSLimits</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:Y:EPS:OVRD_MODE&#39;</span><span class="p">}</span>
    <span class="n">bEPS_Override</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:Y:EPS:OVRD_COUNTDOWN&#39;</span><span class="p">}</span>
    <span class="n">tEPS_TimerCountDown</span> <span class="p">:</span> <span class="n">STRING</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">T</span><span class="c1">#0s);</span>
    <span class="n">fbResetTimer</span> <span class="p">:</span> <span class="n">FB_RestTimer</span><span class="p">;</span>

    <span class="n">bInit</span>           <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bFullRange</span>      <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nIndex</span>          <span class="p">:</span> <span class="n">uint</span><span class="p">;</span>
    <span class="n">nEPSIndex</span>       <span class="p">:</span> <span class="n">uint</span><span class="p">;</span>

    <span class="n">fbEPS</span>           <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;;</span>
    <span class="n">fbCheckEPS</span>      <span class="p">:</span> <span class="n">FB_CheckEPS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">SDS</span> <span class="n">Y</span> <span class="n">EPS</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">Set</span> <span class="n">Inital</span> <span class="n">Values</span>
    <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">45</span><span class="p">;</span>

    <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mf">37.5</span><span class="p">;</span>
    <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mf">38.5</span><span class="p">;</span>

    <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mf">38.5</span><span class="p">;</span>

    <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mf">38.5</span><span class="p">;</span>

    <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">45</span><span class="p">;</span>


    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">EPS</span> <span class="n">conditions</span>
<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span> <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_Z_ENC in [-1,3.05]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.05</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span> <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_Z_ENC in [3.05, 3.4];SDS_RX in [215, 220]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="mf">3.05</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">220</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span> <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_Z_ENC in [3.05, 3.8];SDS_RX in [124, 215]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="mf">3.05</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">215</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span> <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;SDS_Z_ENC in [3.8, 4];(SDS_Y - RCC) &lt;= nozzle_catcher_offset&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">fSDS_Y</span> <span class="o">-</span> <span class="n">fRCC_Y</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">fNozzleCatcherOffset</span><span class="p">);</span>

<span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="n">fNozzleCatcherOffset</span> <span class="o">+</span> <span class="n">fRCC_Y</span><span class="p">;</span>


<span class="n">bFullRange</span> <span class="o">:=</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">)</span> <span class="n">AND</span><span class="p">(</span><span class="n">NOT</span> <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="o">.</span><span class="n">bEPS_OK</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span> <span class="n">aSDS_Y_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;Full Range&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bFullRange</span><span class="p">);</span> <span class="o">//</span> <span class="n">FULL</span> <span class="n">RANGE</span>


<span class="n">fbResetTimer</span><span class="p">(</span><span class="n">bInput</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">,</span> <span class="n">tElapseTime</span><span class="o">:=</span><span class="n">tEPS_OVRD_RESET_TIME</span><span class="p">,</span> <span class="n">tCountDown</span><span class="o">:=</span><span class="n">tEPS_TimerCountDown</span><span class="p">);</span>
<span class="n">fbCheckEPS</span><span class="p">(</span><span class="n">stMotor</span><span class="o">:=</span><span class="n">M17</span><span class="p">,</span> <span class="n">fPosition</span><span class="o">:=</span><span class="n">fSDS_Y</span><span class="p">,</span> <span class="n">aEPSLimits</span><span class="o">:=</span><span class="n">aSDS_Y_EPS</span><span class="p">,</span> <span class="n">stForwardMotorEPS</span><span class="o">:=</span><span class="n">M17</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">,</span> <span class="n">stBackwardMotorEPS</span><span class="o">:=</span> <span class="n">M17</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">,</span> <span class="n">bEPS_Override</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-checkeps">FB_CheckEPS</a></p></li>
<li><p><a class="reference internal" href="#fb-resttimer">FB_RestTimer</a></p></li>
<li><p><a class="reference internal" href="#f-inrange">F_InRange</a></p></li>
<li><p><a class="reference internal" href="#st-epslimits">ST_EPSLimits</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-sds-zencoder-eps">
<h2>PRG_SDS_ZENCODER_EPS<a class="headerlink" href="#prg-sds-zencoder-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_SDS_ZENCODER_EPS</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:ZENC:EPS&#39;</span><span class="p">}</span>
    <span class="n">aSDS_Z_ENC_EPS</span>  <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">5</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_EPSLimits</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:ZENC:EPS:OVRD_MODE&#39;</span><span class="p">}</span>
    <span class="n">bEPS_Override</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: CRIX:SDS:MMS:ZENC:EPS:OVRD_COUNTDOWN&#39;</span><span class="p">}</span>
    <span class="n">tEPS_TimerCountDown</span> <span class="p">:</span> <span class="n">STRING</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">T</span><span class="c1">#0s);</span>
    <span class="n">fbResetTimer</span> <span class="p">:</span> <span class="n">FB_RestTimer</span><span class="p">;</span>

    <span class="n">bInit</span>       <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bSDS_vert_transport_state</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bFullRange</span>      <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bUnknownState</span>   <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">fbEPS</span>           <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbCheckEPS</span>      <span class="p">:</span> <span class="n">FB_CheckEPS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>

    <span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mf">3.4</span><span class="p">;</span>

    <span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mf">3.05</span><span class="p">;</span>
    <span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mf">3.4</span><span class="p">;</span>

    <span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mf">3.05</span><span class="p">;</span>
    <span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mf">3.4</span><span class="p">;</span>

    <span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mf">3.05</span><span class="p">;</span>
    <span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>

    <span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fBwd_Limits</span> <span class="o">:=</span> <span class="mf">3.8</span><span class="p">;</span>
    <span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fFwd_Limits</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">bSDS_vert_transport_state</span> <span class="o">:=</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Y</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mf">38.5</span><span class="p">)</span> <span class="n">AND</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">134</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fDPL_X</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fRCC_Y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">34</span><span class="p">);</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_RX in [215, 220];SDS_Y in [37.5, 38.5]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">220</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Y</span><span class="p">,</span> <span class="mf">37.5</span><span class="p">,</span> <span class="mf">38.5</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_RX in [134, 220];SDS_Y in [30, 38.5]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">220</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Y</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mf">37.5</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_RX in [124, 134];SDS_Z_ENC in [3.05, 3.45];NOT SDS VERT. TRANSPORT STATE&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">134</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="mf">3.05</span><span class="p">,</span> <span class="mf">3.45</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">NOT</span> <span class="n">bSDS_vert_transport_state</span><span class="p">);</span> <span class="o">//</span> <span class="n">NOT</span> <span class="n">INJECTOR</span> <span class="n">Vertical</span> <span class="n">Tansport</span> <span class="n">Condition</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_RX in [124, 134];SDS_Y in [30, 38.5];RCC_Y in [-38,-34];DPL_X in [10,30]&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">134</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Y</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mf">38.5</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fRCC_Y</span><span class="p">,</span> <span class="o">-</span><span class="mi">38</span><span class="p">,</span> <span class="o">-</span><span class="mi">34</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fDPL_X</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>

<span class="n">fbEPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">aSDS_Z_ENC_EPS</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">stEPS</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s1">&#39;SDS_RX in [124, 134];SDS_Z_ENC in [3.75, 4]; NOT SDS VERT. TRANSPORT State&#39;</span><span class="p">);</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_RX</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">134</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F_InRange</span><span class="p">(</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>
<span class="n">fbEPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">NOT</span> <span class="n">bSDS_vert_transport_state</span><span class="p">);</span> <span class="o">//</span> <span class="n">NOT</span> <span class="n">INJECTOR</span> <span class="n">Vertical</span> <span class="n">Transport</span> <span class="n">Condition</span>


<span class="n">fbResetTimer</span><span class="p">(</span><span class="n">bInput</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">,</span> <span class="n">tElapseTime</span><span class="o">:=</span><span class="n">tEPS_OVRD_RESET_TIME</span><span class="p">,</span> <span class="n">tCountDown</span><span class="o">:=</span><span class="n">tEPS_TimerCountDown</span><span class="p">);</span>
<span class="n">fbCheckEPS</span><span class="p">(</span><span class="n">stMotor</span><span class="o">:=</span><span class="n">M18</span><span class="p">,</span> <span class="n">fPosition</span><span class="o">:=</span><span class="n">fSDS_Z_ENC</span><span class="p">,</span> <span class="n">stForwardMotorEPS</span><span class="o">:=</span> <span class="n">M18</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">,</span> <span class="n">stBackwardMotorEPS</span><span class="o">:=</span><span class="n">M18</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">,</span> <span class="n">aEPSLimits</span><span class="o">:=</span><span class="n">aSDS_Z_ENC_EPS</span><span class="p">,</span> <span class="n">bEPS_Override</span><span class="o">:=</span><span class="n">bEPS_Override</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-checkeps">FB_CheckEPS</a></p></li>
<li><p><a class="reference internal" href="#fb-resttimer">FB_RestTimer</a></p></li>
<li><p><a class="reference internal" href="#f-inrange">F_InRange</a></p></li>
<li><p><a class="reference internal" href="#st-epslimits">ST_EPSLimits</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-sl2k2-scatter">
<h2>PRG_SL2K2_SCATTER<a class="headerlink" href="#prg-sl2k2-scatter" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_SL2K2_SCATTER</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">SL2K2</span><span class="p">:</span><span class="n">SCATTER</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbSL2K2</span><span class="p">:</span> <span class="n">FB_SLITS</span><span class="p">;</span>
    <span class="o">//</span><span class="n">GET</span> <span class="n">PMPS</span> <span class="n">Move</span> <span class="n">Ok</span> <span class="n">bit</span>
    <span class="o">//</span> <span class="n">Default</span> <span class="kc">True</span> <span class="n">until</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">properly</span> <span class="n">linked</span> <span class="n">to</span> <span class="n">PMPS</span> <span class="n">bit</span>
    <span class="n">bMoveOk</span><span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">SL2K2</span><span class="p">:</span><span class="n">SCATTER</span><span class="p">:</span><span class="n">GO</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">bExecuteMotion</span> <span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bTest</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="o">//</span><span class="k">for</span> <span class="n">testing</span> <span class="n">purposes</span> <span class="n">only</span><span class="o">.</span> <span class="n">comment</span><span class="o">-</span><span class="n">out</span><span class="o">/</span><span class="n">delete</span> <span class="n">once</span> <span class="n">done</span><span class="o">.</span>
    <span class="n">mcPower</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..4</span><span class="p">]</span> <span class="n">OF</span> <span class="n">MC_POWER</span><span class="p">;</span>


    <span class="p">(</span><span class="o">*</span><span class="n">Offsets</span><span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">Absolute</span> <span class="n">encoder</span> <span class="n">value</span> <span class="n">at</span> <span class="n">the</span> <span class="n">HLS</span> <span class="o">+</span> <span class="n">Absolure</span> <span class="n">eoncoder</span> <span class="n">value</span> <span class="n">at</span> <span class="n">the</span> <span class="n">centered</span> <span class="n">beam</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">rEncoderOffsetTop</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">15</span><span class="p">;</span> <span class="p">(</span><span class="o">*</span> <span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rEncoderOffsetBottom</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">15</span><span class="p">;</span> <span class="p">(</span><span class="o">*</span> <span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rEncoderOffsetNorth</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">15</span><span class="p">;(</span><span class="o">*</span> <span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rEncoderOffsetSouth</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">15</span><span class="p">;(</span><span class="o">*</span> <span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>

<span class="n">END_VAR</span>
<span class="n">fbSL2K2</span><span class="o">.</span><span class="n">bMoveOk</span> <span class="o">:=</span> <span class="n">bMoveOk</span><span class="p">;</span>

<span class="o">//</span><span class="k">for</span> <span class="n">testing</span> <span class="n">purposes</span> <span class="n">only</span><span class="o">.</span> <span class="n">comment</span><span class="o">-</span><span class="n">out</span><span class="o">/</span><span class="n">delete</span> <span class="n">once</span> <span class="n">done</span><span class="o">.</span>
<span class="n">If</span> <span class="p">(</span><span class="n">bTest</span><span class="p">)</span> <span class="n">THEN</span>
<span class="n">mcPower</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">axis</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M50</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span> <span class="n">Enable</span><span class="o">:=</span><span class="n">bTest</span><span class="p">,</span> <span class="n">enable_positive</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M50</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">,</span> <span class="n">enable_negative</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M50</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="p">);</span>
<span class="n">mcPower</span><span class="p">[</span><span class="mi">2</span><span class="p">](</span><span class="n">axis</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M51</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span> <span class="n">Enable</span><span class="o">:=</span><span class="n">bTest</span><span class="p">,</span> <span class="n">enable_positive</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M51</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">,</span> <span class="n">enable_negative</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M51</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="p">);</span>
<span class="n">mcPower</span><span class="p">[</span><span class="mi">3</span><span class="p">](</span><span class="n">axis</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M52</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span> <span class="n">Enable</span><span class="o">:=</span><span class="n">bTest</span><span class="p">,</span> <span class="n">enable_positive</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M52</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">,</span> <span class="n">enable_negative</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M52</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="p">);</span>
<span class="n">mcPower</span><span class="p">[</span><span class="mi">4</span><span class="p">](</span><span class="n">axis</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M53</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span> <span class="n">Enable</span><span class="o">:=</span><span class="n">bTest</span><span class="p">,</span> <span class="n">enable_positive</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M53</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">,</span> <span class="n">enable_negative</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M53</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="p">);</span>
<span class="n">ELSE</span>

<span class="o">//</span><span class="n">Homing</span> <span class="n">routine</span> <span class="n">parameters</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M51</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M50</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="o">-</span><span class="mf">30.6</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M52</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M53</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="o">-</span><span class="mf">30.51</span><span class="p">;</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M51</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">HIGH_LIMIT</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M50</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">LOW_LIMIT</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M52</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">HIGH_LIMIT</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M53</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">LOW_LIMIT</span><span class="p">;</span>


<span class="n">fbSL2K2</span><span class="o">.</span><span class="n">rEncoderOffsetTop</span> <span class="o">:=</span> <span class="n">rEncoderOffsetTop</span><span class="p">;</span>
<span class="n">fbSL2K2</span><span class="o">.</span><span class="n">rEncoderOffsetBottom</span> <span class="o">:=</span> <span class="n">rEncoderOffsetBottom</span><span class="p">;</span>
<span class="n">fbSL2K2</span><span class="o">.</span><span class="n">rEncoderOffsetNorth</span> <span class="o">:=</span> <span class="n">rEncoderOffsetNorth</span><span class="p">;</span>
<span class="n">fbSL2K2</span><span class="o">.</span><span class="n">rEncoderOffsetSouth</span> <span class="o">:=</span> <span class="n">rEncoderOffsetSouth</span><span class="p">;</span>

<span class="n">fbSL2K2</span><span class="p">(</span><span class="n">stTopBlade</span><span class="o">:=</span>  <span class="n">Main</span><span class="o">.</span><span class="n">M51</span><span class="p">,</span>
        <span class="n">stBottomBlade</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M50</span><span class="p">,</span>
        <span class="n">stNorthBlade</span><span class="o">:=</span>  <span class="n">Main</span><span class="o">.</span><span class="n">M52</span><span class="p">,</span>
        <span class="n">stSouthBlade</span><span class="o">:=</span>  <span class="n">Main</span><span class="o">.</span><span class="n">M53</span><span class="p">,</span>
        <span class="n">bExecuteMotion</span><span class="o">:=</span><span class="n">bExecuteMotion</span><span class="p">,</span>
        <span class="n">io_fbFFHWO</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput2</span><span class="p">,</span>
        <span class="n">fbArbiter</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter1</span><span class="p">);</span>

<span class="o">//</span><span class="n">fbSL2K2</span><span class="o">.</span><span class="n">M_CheckPMPS</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>



<span class="n">END_IF</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-slits">FB_SLITS</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-test-adjacentstates">
<h2>PRG_Test_AdjacentStates<a class="headerlink" href="#prg-test-adjacentstates" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Test_AdjacentStates</span>
<span class="n">VAR</span>
    <span class="n">arrDPTransitions</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">0..9</span><span class="p">,</span> <span class="mf">1..9</span><span class="p">]</span> <span class="n">OF</span> <span class="n">BOOL</span> <span class="o">:=</span>
    <span class="o">//</span><span class="n">Park</span>  <span class="n">Up</span>     <span class="n">Center</span> <span class="n">Pinh</span><span class="o">.</span>  <span class="n">Diode</span>  <span class="n">Yag1</span>   <span class="n">Yag2</span>   <span class="n">Yag3</span>   <span class="n">Knife</span>
    <span class="p">[</span><span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="o">//</span> <span class="n">Unknown</span> <span class="p">(</span><span class="n">This</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="n">included</span><span class="p">)</span>
     <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="o">//</span> <span class="n">Park</span>
     <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="o">//</span> <span class="n">Up</span>
     <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Center</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Pinhole</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Diode</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Yag1</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Yag2</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="o">//</span> <span class="n">Yag3</span>
     <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">,</span>  <span class="n">TRUE</span><span class="p">];</span> <span class="o">//</span> <span class="n">Knife</span>

     <span class="n">arrAdjStates</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1..9</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_BFSAssemblyState</span><span class="p">;</span>

     <span class="n">nStates</span> <span class="p">:</span> <span class="n">DINT</span> <span class="o">:=</span> <span class="mi">9</span><span class="p">;</span>
     <span class="n">iRootState</span> <span class="p">:</span> <span class="n">DINT</span> <span class="o">:=</span> <span class="mi">8</span><span class="p">;</span>

     <span class="n">fbAdjacent</span> <span class="p">:</span> <span class="n">FB_AdjacentStates</span><span class="p">;</span>

     <span class="n">nAdjacentStates</span> <span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">fbAdjacent</span><span class="p">(</span><span class="n">arrTransitionMatrix</span><span class="o">:=</span><span class="n">arrDPTransitions</span><span class="p">,</span>
           <span class="n">arrAdjacentStates</span><span class="o">:=</span><span class="n">arrAdjStates</span><span class="p">,</span>
           <span class="n">arrStates</span><span class="o">:=</span><span class="n">arrDPStates</span><span class="p">,</span>
           <span class="n">iRootState</span><span class="o">:=</span><span class="n">iRootState</span><span class="p">,</span>
           <span class="n">nAdjacentStates</span><span class="o">=&gt;</span><span class="n">nAdjacentStates</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-adjacentstates">FB_AdjacentStates</a></p></li>
<li><p><a class="reference internal" href="#st-bfsassemblystate">ST_BFSAssemblyState</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-vls">
<h2>PRG_VLS<a class="headerlink" href="#prg-vls" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_VLS</span>
<span class="n">VAR</span>
    <span class="n">fbVLS_SLITS_TOP</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbVLS_SLITS_BOTTOM</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbVLS_SLITS_RIGHT</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbVLS_SLITS_LEFT</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbVLS_Mirror_P</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbVLS_Grating_P</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbVLS_CAM_P</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbVLS_CAM_D</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>


    <span class="n">rGrating_Pitch</span> <span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
    <span class="n">rMirror_Pitch</span> <span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="o">//</span><span class="n">SLITS</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="o">//</span><span class="n">Homing</span> <span class="n">routine</span> <span class="n">parameters</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">LOW_LIMIT</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">LOW_LIMIT</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">LOW_LIMIT</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">LOW_LIMIT</span><span class="p">;</span>

    <span class="o">//</span><span class="n">Focusing</span> <span class="n">Mirror</span> <span class="n">Pitch</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="o">//</span><span class="n">Homing</span> <span class="n">routine</span> <span class="n">parameters</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="o">-</span><span class="mf">0.2288</span><span class="p">;</span> <span class="o">//</span> <span class="n">old</span> <span class="n">homing</span> <span class="n">position</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.473</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">LOW_LIMIT</span><span class="p">;</span>

    <span class="o">//</span><span class="n">Grating</span> <span class="n">Pitch</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="o">//</span><span class="n">Homing</span> <span class="n">routine</span> <span class="n">parameters</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="o">-</span><span class="mf">1.74</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">LOW_LIMIT</span><span class="p">;</span>

    <span class="o">//</span><span class="n">Cam</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="o">//</span><span class="n">Homing</span> <span class="n">routine</span> <span class="n">parameters</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="mf">0.8923</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">HIGH_LIMIT</span><span class="p">;</span><span class="o">//</span><span class="mi">0</span> <span class="n">where</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">horizontal</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">:=</span> <span class="o">-</span><span class="mf">15.5</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">LOW_LIMIT</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">the</span> <span class="n">mirror</span> <span class="ow">and</span> <span class="n">grating</span> <span class="n">pitch</span> <span class="n">values</span>
<span class="o">//</span><span class="n">OLD</span> <span class="n">EQUATION</span><span class="p">:</span>
<span class="o">//</span><span class="n">Mirror</span> <span class="n">Pitch</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="o">=</span>   <span class="mf">33.85</span> <span class="o">+</span> <span class="mf">18.09</span><span class="n">x</span>  <span class="o">-</span> <span class="mf">0.2479</span><span class="n">x2</span>
<span class="o">//</span><span class="n">rMirror_Pitch</span> <span class="o">:=</span><span class="mf">33.85</span> <span class="o">+</span> <span class="p">(</span><span class="mf">18.09</span><span class="o">*</span><span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">(</span><span class="o">*</span><span class="n">mm</span><span class="o">*</span><span class="p">)</span>  <span class="p">)</span><span class="o">-</span> <span class="p">(</span><span class="mf">0.2479</span> <span class="o">*</span> <span class="n">EXPT</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>

<span class="o">//</span><span class="n">NEW</span> <span class="n">EQUATION</span><span class="p">:</span>
<span class="n">rMirror_Pitch</span> <span class="o">:=</span><span class="mf">27.667</span> <span class="o">+</span> <span class="p">(</span><span class="mf">18.1</span><span class="o">*</span><span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">(</span><span class="o">*</span><span class="n">mm</span><span class="o">*</span><span class="p">)</span>  <span class="p">)</span><span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.7569</span> <span class="o">*</span> <span class="n">EXPT</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>

<span class="o">//</span><span class="n">Grating</span> <span class="n">Pitch</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span>  <span class="mf">22.56</span> <span class="o">-</span> <span class="mf">16.25</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.334</span><span class="n">x2</span>
<span class="n">rGrating_Pitch</span> <span class="o">:=</span> <span class="mf">22.56</span> <span class="o">-</span> <span class="p">(</span><span class="mf">16.25</span><span class="o">*</span><span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">(</span><span class="o">*</span><span class="n">mm</span><span class="o">*</span><span class="p">)</span>  <span class="p">)</span><span class="o">+</span> <span class="p">(</span><span class="mf">0.334</span> <span class="o">*</span> <span class="n">EXPT</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>




<span class="n">fbVLS_SLITS_TOP</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="p">);</span>
<span class="n">fbVLS_SLITS_BOTTOM</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="p">);</span>
<span class="n">fbVLS_SLITS_RIGHT</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="p">);</span>
<span class="n">fbVLS_SLITS_LEFT</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="p">);</span>
<span class="n">fbVLS_Mirror_P</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="p">);</span>
<span class="n">fbVLS_Grating_P</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="p">);</span>
<span class="n">fbVLS_CAM_P</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="p">);</span>
<span class="n">fbVLS_CAM_D</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lcls-plc-crixs-motion_PLC_CRIX_MOT_epics.html" class="btn btn-neutral float-left" title="Data Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>